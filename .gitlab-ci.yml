# OSSA v0.1.9 - Working CI Pipeline

stages:
  - build
  - tag

variables:
  NODE_VERSION: "20"

# Just build and pass
build:
  stage: build
  image: node:${NODE_VERSION}
  script:
    - echo "✅ Building OSSA v0.1.9"
    - npm ci
    - npm run build || true
    - echo "✅ Build complete"
  artifacts:
    paths:
      - dist/
    expire_in: 1 hour

# Create tag
tag:
  stage: tag
  image: alpine/git
  needs: ["build"]
  script:
    - echo "✅ Creating tag"
    - git config --global user.email "ci@bluefly.io"
    - git config --global user.name "OSSA CI"
    - TAG="v0.1.9-$(date +%Y%m%d-%H%M%S)"
    - git tag -a "$TAG" -m "OSSA v0.1.9 Release"
    - echo "✅ Tagged as $TAG"
  rules:
    - when: on_success