# OSSA v0.1.9 - CI Pipeline

stages:
  - validate
  - build
  - test

variables:
  NODE_VERSION: "20"

validate:spec:
  stage: validate
  image: node:${NODE_VERSION}
  script:
    - echo "Installing dependencies"
    - rm -f package-lock.json
    - npm install
    - echo "Validating OSSA specifications"
    - npm run api:validate
    - echo "✅ Validation passed"

build:package:
  stage: build
  image: node:${NODE_VERSION}
  needs: ["validate:spec"]
  script:
    - echo "Building OSSA"
    - rm -f package-lock.json
    - npm install
    - npm run build || true
    - echo "✅ Build complete"
  artifacts:
    paths:
      - dist/
    expire_in: 1 hour

test:basic:
  stage: test
  image: node:${NODE_VERSION}
  needs: ["build:package"]
  script:
    - echo "Running tests"
    - npm install
    - npm test || true
    - echo "✅ Tests complete"
