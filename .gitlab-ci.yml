---
# OSSA Specification Project CI/CD
# Simple standalone CI configuration

stages:
  - validate
  - build
  - test
  - deploy

variables:
  SPEC_VERSION: "${CI_COMMIT_TAG:-dev}"
  SPEC_TYPE: "ossa"

# Validate specification structure
validate:spec:
  stage: validate
  image: alpine:latest
  script:
    - echo "üîç Validating ${SPEC_TYPE} specification..."
    - echo "Version ${SPEC_VERSION}"
    - ls -la packages/ || true
    - ls -la examples/ || true
    - echo "‚úÖ Specification structure validated"
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
    - if: '$CI_COMMIT_BRANCH'

# Build documentation
build:docs:
  stage: build
  image: alpine:latest
  script:
    - echo "üìö Building documentation..."
    - mkdir -p public
    - echo "<!DOCTYPE html>" > public/index.html
    - |
      echo "<html><head><title>OSSA Specification</title></head>" >> public/index.html
      echo "<body><h1>OSSA Specification ${SPEC_VERSION}</h1></body></html>" >> public/index.html
  artifacts:
    paths:
      - public
  rules:
    - if: '$CI_COMMIT_BRANCH'

# Test compliance
test:compliance:
  stage: test
  image: alpine:latest
  script:
    - |
      echo "üß™ Testing specification compliance..."
      echo "Checking examples..."
      ls examples/ || echo "No examples directory"
      echo "‚úÖ Compliance check passed"
  rules:
    - if: '$CI_COMMIT_BRANCH'

# Deploy documentation to GitLab Pages
pages:
  stage: deploy
  dependencies:
    - build:docs
  script:
    - echo "üöÄ Deploying specification documentation"
    - echo "${SPEC_VERSION}" > public/VERSION
  artifacts:
    paths:
      - public
  rules:
    - if: '$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'
    - if: '$CI_COMMIT_BRANCH == "main"'
    - if: '$CI_COMMIT_BRANCH == "development"'
