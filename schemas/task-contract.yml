# OAAS Task Contract Schema v1.0
# OAAS-compliant task specification format for multi-agent workflows
# Framework-agnostic task definitions with validation, dependencies, and metrics

$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://openapi-ai-agents.org/schemas/task-contract/v1.0"
title: "OAAS Task Contract Schema"
description: "Standardized task specification format for OAAS-compliant workflows"

type: object
required:
  - apiVersion
  - kind
  - metadata
  - spec

properties:
  apiVersion:
    type: string
    const: "openapi-ai-agents/v1.0"
    description: "OAAS task contract specification version"
    
  kind:
    type: string
    const: "TaskContract"
    description: "Resource type for task contract specifications"
    
  metadata:
    type: object
    required:
      - name
      - version
    properties:
      name:
        type: string
        pattern: '^[a-z0-9-]+$'
        minLength: 3
        maxLength: 50
        description: "Task contract identifier (lowercase, alphanumeric, hyphens)"
      version:
        type: string
        pattern: '^[0-9]+\.[0-9]+\.[0-9]+$'
        description: "Task contract version (semantic versioning)"
      description:
        type: string
        maxLength: 1000
        description: "Detailed task contract description"
      labels:
        type: object
        additionalProperties:
          type: string
        description: "Key-value labels for task organization"
      annotations:
        type: object
        additionalProperties:
          type: string
        description: "Additional metadata including framework compatibility"
      created:
        type: string
        format: date-time
        description: "Contract creation timestamp"
      expires:
        type: string
        format: date-time
        description: "Optional contract expiration timestamp"
    additionalProperties: false
    
  spec:
    type: object
    required:
      - task
      - requirements
      - success_criteria
    properties:
      task:
        type: object
        required:
          - name
          - type
          - priority
        properties:
          name:
            type: string
            description: "Task display name"
          type:
            type: string
            enum: ["research", "analysis", "generation", "validation", "synthesis", "coordination", "monitoring", "custom"]
            description: "Task type classification"
          priority:
            type: integer
            minimum: 1
            maximum: 10
            description: "Task priority (1=lowest, 10=highest)"
          complexity:
            type: string
            enum: ["simple", "moderate", "complex", "expert"]
            description: "Task complexity level"
          estimated_duration:
            type: integer
            minimum: 1
            description: "Estimated task duration in seconds"
          max_duration:
            type: integer
            minimum: 1
            description: "Maximum allowed task duration in seconds"
          tags:
            type: array
            items:
              type: string
              pattern: '^[a-z0-9_-]+$'
            description: "Task classification tags"
        additionalProperties: false
        
      requirements:
        type: object
        required:
          - input
          - output
        properties:
          input:
            $ref: "#/$defs/InputRequirements"
          output:
            $ref: "#/$defs/OutputRequirements"
          dependencies:
            $ref: "#/$defs/TaskDependencies"
          resources:
            $ref: "#/$defs/ResourceRequirements"
          constraints:
            $ref: "#/$defs/TaskConstraints"
        additionalProperties: false
        
      success_criteria:
        type: object
        required:
          - acceptance_criteria
        properties:
          acceptance_criteria:
            type: array
            minItems: 1
            items:
              $ref: "#/$defs/AcceptanceCriterion"
          performance_metrics:
            $ref: "#/$defs/PerformanceMetrics"
          quality_gates:
            type: array
            items:
              $ref: "#/$defs/QualityGate"
          validation_rules:
            type: array
            items:
              $ref: "#/$defs/ValidationRule"
        additionalProperties: false
        
      execution:
        type: object
        properties:
          strategy:
            type: string
            enum: ["single_agent", "multi_agent", "orchestrated", "delegated"]
            description: "Task execution strategy"
          agent_requirements:
            $ref: "#/$defs/AgentRequirements"
          retry_policy:
            $ref: "#/$defs/RetryPolicy"
          fallback_strategy:
            $ref: "#/$defs/FallbackStrategy"
          monitoring:
            $ref: "#/$defs/TaskMonitoring"
        additionalProperties: false
        
      governance:
        type: object
        properties:
          compliance_requirements:
            type: array
            items:
              type: string
              enum: ["ISO_42001_2023", "NIST_AI_RMF_1_0", "EU_AI_Act", "SOX", "HIPAA", "GDPR"]
          risk_level:
            type: string
            enum: ["low", "medium", "high", "critical"]
          audit_requirements:
            $ref: "#/$defs/AuditRequirements"
          approval_required:
            type: boolean
            default: false
          approvers:
            type: array
            items:
              type: string
        additionalProperties: false
        
      framework_specific:
        type: object
        properties:
          langchain:
            $ref: "#/$defs/LangChainTaskSpec"
          crewai:
            $ref: "#/$defs/CrewAITaskSpec"
          autogen:
            $ref: "#/$defs/AutoGenTaskSpec"
          openai:
            $ref: "#/$defs/OpenAITaskSpec"
          anthropic:
            $ref: "#/$defs/AnthropicTaskSpec"
          custom:
            type: object
            additionalProperties: true
            description: "Custom framework task specifications"
        additionalProperties: false
        
    additionalProperties: false

# Schema definitions for reusable components
$defs:
  InputRequirements:
    type: object
    required:
      - schema
    properties:
      schema:
        type: object
        description: "JSON Schema defining input structure"
      validation:
        type: object
        properties:
          required_fields:
            type: array
            items:
              type: string
          field_validators:
            type: object
            additionalProperties:
              type: object
          custom_validators:
            type: array
            items:
              type: string
      transformation:
        type: object
        properties:
          preprocessing_rules:
            type: array
            items:
              type: object
              properties:
                source_field:
                  type: string
                target_field:
                  type: string
                transformation:
                  type: string
          normalization:
            type: object
            properties:
              enabled:
                type: boolean
                default: false
              strategy:
                type: string
                enum: ["lowercase", "uppercase", "trim", "custom"]
      examples:
        type: array
        items:
          type: object
        description: "Example input objects for testing and validation"
    additionalProperties: false
    
  OutputRequirements:
    type: object
    required:
      - schema
    properties:
      schema:
        type: object
        description: "JSON Schema defining output structure"
      format:
        type: string
        enum: ["json", "text", "markdown", "html", "xml", "csv", "binary"]
        default: "json"
      structure:
        type: object
        properties:
          required_fields:
            type: array
            items:
              type: string
          optional_fields:
            type: array
            items:
              type: string
          metadata_fields:
            type: array
            items:
              type: string
      quality_requirements:
        type: object
        properties:
          completeness_threshold:
            type: number
            minimum: 0
            maximum: 1
            description: "Minimum completeness score (0-1)"
          accuracy_threshold:
            type: number
            minimum: 0
            maximum: 1
            description: "Minimum accuracy score (0-1)"
          confidence_threshold:
            type: number
            minimum: 0
            maximum: 1
            description: "Minimum confidence score (0-1)"
      examples:
        type: array
        items:
          type: object
        description: "Example output objects showing expected format"
    additionalProperties: false
    
  TaskDependencies:
    type: object
    properties:
      prerequisite_tasks:
        type: array
        items:
          type: object
          required:
            - task_id
            - type
          properties:
            task_id:
              type: string
              description: "ID of prerequisite task"
            type:
              type: string
              enum: ["hard", "soft", "conditional"]
            condition:
              type: string
              description: "Condition for conditional dependencies"
            output_mapping:
              type: object
              description: "How to map prerequisite outputs to this task's inputs"
      concurrent_tasks:
        type: array
        items:
          type: string
        description: "Tasks that can run concurrently with this task"
      blocking_tasks:
        type: array
        items:
          type: string
        description: "Tasks that cannot run while this task is executing"
      resource_dependencies:
        type: array
        items:
          type: object
          properties:
            resource_type:
              type: string
              enum: ["compute", "storage", "network", "api", "database", "external_service"]
            resource_id:
              type: string
            access_level:
              type: string
              enum: ["read", "write", "exclusive"]
    additionalProperties: false
    
  ResourceRequirements:
    type: object
    properties:
      compute:
        type: object
        properties:
          cpu_cores:
            type: integer
            minimum: 1
          memory_mb:
            type: integer
            minimum: 64
          gpu_required:
            type: boolean
            default: false
          gpu_memory_mb:
            type: integer
            minimum: 1024
      storage:
        type: object
        properties:
          disk_space_mb:
            type: integer
            minimum: 1
          temporary_storage_mb:
            type: integer
            minimum: 1
          persistent_storage:
            type: boolean
            default: false
      network:
        type: object
        properties:
          bandwidth_mbps:
            type: integer
            minimum: 1
          latency_max_ms:
            type: integer
            minimum: 1
          external_access_required:
            type: boolean
            default: false
      api_limits:
        type: object
        properties:
          max_requests_per_minute:
            type: integer
            minimum: 1
          max_tokens_per_request:
            type: integer
            minimum: 1
          cost_budget:
            type: number
            minimum: 0
            description: "Maximum cost budget in USD"
    additionalProperties: false
    
  TaskConstraints:
    type: object
    properties:
      time_constraints:
        type: object
        properties:
          start_after:
            type: string
            format: date-time
          complete_before:
            type: string
            format: date-time
          execution_window:
            type: object
            properties:
              start_time:
                type: string
                pattern: '^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$'
              end_time:
                type: string
                pattern: '^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$'
              timezone:
                type: string
              days_of_week:
                type: array
                items:
                  type: string
                  enum: ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"]
      security_constraints:
        type: object
        properties:
          data_classification:
            type: string
            enum: ["public", "internal", "confidential", "restricted"]
          access_controls:
            type: array
            items:
              type: string
          encryption_required:
            type: boolean
            default: false
          audit_logging:
            type: boolean
            default: true
      compliance_constraints:
        type: array
        items:
          type: object
          properties:
            framework:
              type: string
            requirements:
              type: array
              items:
                type: string
            validation_required:
              type: boolean
              default: false
    additionalProperties: false
    
  AcceptanceCriterion:
    type: object
    required:
      - name
      - description
      - validation_method
    properties:
      name:
        type: string
        description: "Acceptance criterion name"
      description:
        type: string
        description: "Detailed description of what must be achieved"
      validation_method:
        type: string
        enum: ["manual", "automated", "hybrid"]
      success_condition:
        type: string
        description: "Condition expression defining success"
      weight:
        type: number
        minimum: 0
        maximum: 1
        description: "Relative weight of this criterion (0-1)"
      mandatory:
        type: boolean
        default: true
        description: "Whether this criterion is mandatory for task success"
    additionalProperties: false
    
  PerformanceMetrics:
    type: object
    properties:
      latency:
        type: object
        properties:
          target_ms:
            type: integer
            minimum: 1
          max_ms:
            type: integer
            minimum: 1
      throughput:
        type: object
        properties:
          target_per_second:
            type: number
            minimum: 0
          max_per_second:
            type: number
            minimum: 0
      accuracy:
        type: object
        properties:
          target_score:
            type: number
            minimum: 0
            maximum: 1
          measurement_method:
            type: string
      resource_efficiency:
        type: object
        properties:
          cpu_target_percent:
            type: number
            minimum: 0
            maximum: 100
          memory_target_mb:
            type: integer
            minimum: 1
          cost_target_usd:
            type: number
            minimum: 0
      quality_scores:
        type: object
        properties:
          completeness_target:
            type: number
            minimum: 0
            maximum: 1
          relevance_target:
            type: number
            minimum: 0
            maximum: 1
          coherence_target:
            type: number
            minimum: 0
            maximum: 1
    additionalProperties: false
    
  QualityGate:
    type: object
    required:
      - name
      - type
      - threshold
    properties:
      name:
        type: string
        description: "Quality gate name"
      type:
        type: string
        enum: ["automated_test", "code_review", "performance_test", "security_scan", "compliance_check"]
      threshold:
        type: number
        description: "Threshold value for pass/fail"
      blocking:
        type: boolean
        default: true
        description: "Whether failure blocks task completion"
      remediation_actions:
        type: array
        items:
          type: string
        description: "Actions to take when quality gate fails"
    additionalProperties: false
    
  ValidationRule:
    type: object
    required:
      - name
      - rule_type
      - expression
    properties:
      name:
        type: string
        description: "Validation rule name"
      rule_type:
        type: string
        enum: ["schema", "business", "security", "performance", "custom"]
      expression:
        type: string
        description: "Rule expression or validation logic"
      severity:
        type: string
        enum: ["error", "warning", "info"]
        default: "error"
      custom_message:
        type: string
        description: "Custom validation error message"
    additionalProperties: false
    
  AgentRequirements:
    type: object
    properties:
      required_capabilities:
        type: array
        items:
          type: string
        description: "Capabilities the executing agent must have"
      preferred_frameworks:
        type: array
        items:
          type: string
          enum: ["langchain", "crewai", "autogen", "openai", "anthropic", "mcp", "custom"]
      minimum_experience_level:
        type: string
        enum: ["basic", "intermediate", "advanced", "expert"]
      specialization_required:
        type: array
        items:
          type: string
      certification_required:
        type: array
        items:
          type: string
      performance_requirements:
        type: object
        properties:
          min_success_rate:
            type: number
            minimum: 0
            maximum: 1
          max_response_time:
            type: integer
            minimum: 1
          min_confidence_score:
            type: number
            minimum: 0
            maximum: 1
    additionalProperties: false
    
  RetryPolicy:
    type: object
    properties:
      max_attempts:
        type: integer
        minimum: 1
        maximum: 10
        default: 3
      backoff_strategy:
        type: string
        enum: ["fixed", "exponential", "linear"]
        default: "exponential"
      initial_delay:
        type: integer
        minimum: 100
        default: 1000
        description: "Initial retry delay in milliseconds"
      max_delay:
        type: integer
        minimum: 1000
        default: 30000
        description: "Maximum retry delay in milliseconds"
      retry_conditions:
        type: array
        items:
          type: string
          enum: ["timeout", "network_error", "rate_limit", "temporary_failure", "resource_unavailable"]
      escalation_policy:
        type: object
        properties:
          escalate_after_attempts:
            type: integer
            minimum: 1
          escalation_target:
            type: string
          notification_required:
            type: boolean
            default: false
    additionalProperties: false
    
  FallbackStrategy:
    type: object
    properties:
      enabled:
        type: boolean
        default: false
      trigger_conditions:
        type: array
        items:
          type: string
          enum: ["max_retries_exceeded", "timeout", "quality_threshold_not_met", "resource_unavailable"]
      fallback_actions:
        type: array
        items:
          type: object
          properties:
            action_type:
              type: string
              enum: ["use_alternative_agent", "reduce_quality_requirements", "request_manual_intervention", "return_partial_results"]
            configuration:
              type: object
              additionalProperties: true
    additionalProperties: false
    
  TaskMonitoring:
    type: object
    properties:
      real_time_metrics:
        type: boolean
        default: true
      checkpoint_intervals:
        type: integer
        minimum: 1
        description: "Checkpoint interval in seconds"
      progress_reporting:
        type: object
        properties:
          enabled:
            type: boolean
            default: true
          frequency:
            type: integer
            minimum: 1
            description: "Progress report frequency in seconds"
          include_intermediate_results:
            type: boolean
            default: false
      alerting:
        type: object
        properties:
          enabled:
            type: boolean
            default: false
          alert_conditions:
            type: array
            items:
              type: string
              enum: ["execution_timeout", "quality_degradation", "resource_threshold_exceeded", "error_rate_high"]
          notification_channels:
            type: array
            items:
              type: string
    additionalProperties: false
    
  AuditRequirements:
    type: object
    properties:
      audit_level:
        type: string
        enum: ["none", "basic", "detailed", "comprehensive"]
        default: "basic"
      log_inputs:
        type: boolean
        default: true
      log_outputs:
        type: boolean
        default: true
      log_intermediate_steps:
        type: boolean
        default: false
      retention_days:
        type: integer
        minimum: 1
        default: 30
      encryption_required:
        type: boolean
        default: false
      access_controls:
        type: array
        items:
          type: string
    additionalProperties: false
    
  # Framework-specific task specifications
  LangChainTaskSpec:
    type: object
    properties:
      chain_type:
        type: string
        enum: ["llm", "sequential", "transformation", "router", "constitutional"]
      prompt_template:
        type: string
      memory_type:
        type: string
        enum: ["buffer", "summary", "conversation_knowledge_graph", "conversation_token_buffer"]
      tools:
        type: array
        items:
          type: string
      callbacks:
        type: array
        items:
          type: string
    additionalProperties: false
    
  CrewAITaskSpec:
    type: object
    properties:
      task_type:
        type: string
        enum: ["simple", "delegated", "hierarchical"]
      expected_output:
        type: string
      context:
        type: array
        items:
          type: string
      async_execution:
        type: boolean
        default: false
      human_input:
        type: boolean
        default: false
    additionalProperties: false
    
  AutoGenTaskSpec:
    type: object
    properties:
      conversation_type:
        type: string
        enum: ["two_agent", "group_chat", "sequential_chat"]
      max_consecutive_auto_reply:
        type: integer
        minimum: 1
      code_execution_config:
        type: object
        properties:
          work_dir:
            type: string
          use_docker:
            type: boolean
          timeout:
            type: integer
    additionalProperties: false
    
  OpenAITaskSpec:
    type: object
    properties:
      assistant_instructions:
        type: string
      tools:
        type: array
        items:
          type: string
          enum: ["code_interpreter", "file_search", "function"]
      model:
        type: string
      temperature:
        type: number
        minimum: 0
        maximum: 2
      file_ids:
        type: array
        items:
          type: string
    additionalProperties: false
    
  AnthropicTaskSpec:
    type: object
    properties:
      model:
        type: string
      max_tokens:
        type: integer
        minimum: 1
      system:
        type: string
      tools:
        type: array
        items:
          type: object
      tool_choice:
        type: object
    additionalProperties: false

additionalProperties: false