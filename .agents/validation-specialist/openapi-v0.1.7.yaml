openapi: 3.1.0
info:
  title: OSSA v0.1.7 Validation Specialist Agent
  version: 1.1.0
  description: |
    Comprehensive validation specialist with universal framework support and advanced specification validation.
    
    This agent provides enterprise-grade validation services for agent specifications, OpenAPI schemas,
    compliance frameworks, and cross-format validation with automated certification capabilities.
  contact:
    name: Open Standards for Scalable Agents Community
    url: https://github.com/ossa-community
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
  
servers:
  - url: http://localhost:8083
    description: Development server
  - url: https://validation-specialist.ossa.local
    description: Local testing environment
  - url: https://validation-specialist.ossa.io
    description: Production server

security:
  - oauth2_pkce: []
  - apiKey: []
  - bearerAuth: []

paths:
  /health:
    get:
      summary: Health check endpoint
      description: Returns the current health status of the validation specialist
      operationId: getHealth
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
              example:
                status: "healthy"
                uptime: 12345
                version: "1.1.0"
                dependencies:
                  validation_engines: "healthy"
                  schema_cache: "healthy"
                  certificate_store: "healthy"
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  /capabilities:
    get:
      summary: Get agent capabilities
      description: Returns comprehensive capabilities and configuration of the validation specialist
      operationId: getCapabilities
      responses:
        '200':
          description: Agent capabilities
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentCapabilities'

  /validate/ossa:
    post:
      summary: Validate OSSA agent specification
      description: Comprehensive validation of OSSA v0.1.7 agent specifications with schema, semantic, and compliance validation
      operationId: validateOssaSpec
      requestBody:
        required: true
        content:
          application/yaml:
            schema:
              type: string
              description: OSSA agent specification in YAML format
            example: |
              apiVersion: open-standards-scalable-agents/v0.1.7
              kind: Agent
              metadata:
                name: "example-agent"
                version: "1.0.0"
              spec:
                conformance:
                  tier: "core"
          application/json:
            schema:
              type: object
              description: OSSA agent specification in JSON format
          multipart/form-data:
            schema:
              type: object
              properties:
                specification:
                  type: string
                  format: binary
                  description: OSSA specification file
      responses:
        '200':
          description: Validation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationResult'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /validate/openapi:
    post:
      summary: Validate OpenAPI specification
      description: Validate OpenAPI 3.0.x or 3.1.x specifications with comprehensive schema and security validation
      operationId: validateOpenApiSpec
      parameters:
        - name: version
          in: query
          description: Target OpenAPI version
          schema:
            type: string
            enum: ["3.0.0", "3.0.1", "3.0.2", "3.0.3", "3.1.0"]
            default: "3.1.0"
        - name: strict_mode
          in: query
          description: Enable strict validation mode
          schema:
            type: boolean
            default: true
      requestBody:
        required: true
        content:
          application/yaml:
            schema:
              type: string
          application/json:
            schema:
              type: object
          multipart/form-data:
            schema:
              type: object
              properties:
                specification:
                  type: string
                  format: binary
      responses:
        '200':
          description: OpenAPI validation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OpenApiValidationResult'

  /validate/dual-format:
    post:
      summary: Cross-format validation
      description: Validate specifications across multiple formats (YAML/JSON) and ensure consistency
      operationId: validateDualFormat
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [primary_spec, secondary_spec]
              properties:
                primary_spec:
                  type: object
                  properties:
                    format:
                      type: string
                      enum: ["yaml", "json"]
                    content:
                      type: string
                secondary_spec:
                  type: object
                  properties:
                    format:
                      type: string
                      enum: ["yaml", "json"] 
                    content:
                      type: string
                validation_rules:
                  type: array
                  items:
                    type: string
                  example: ["schema_consistency", "semantic_equivalence", "format_compliance"]
      responses:
        '200':
          description: Cross-format validation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DualFormatValidationResult'

  /validate/batch:
    post:
      summary: Batch validation
      description: Validate multiple specifications in a single request with async processing
      operationId: batchValidate
      parameters:
        - name: async
          in: query
          description: Process asynchronously
          schema:
            type: boolean
            default: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [specifications]
              properties:
                specifications:
                  type: array
                  items:
                    type: object
                    required: [id, type, content]
                    properties:
                      id:
                        type: string
                        description: Unique specification identifier
                      type:
                        type: string
                        enum: ["ossa", "openapi", "jsonschema", "yaml"]
                      format:
                        type: string
                        enum: ["yaml", "json"]
                        default: "yaml"
                      content:
                        type: string
                      validation_options:
                        type: object
                        additionalProperties: true
                  maxItems: 100
                batch_options:
                  type: object
                  properties:
                    stop_on_first_error:
                      type: boolean
                      default: false
                    parallel_processing:
                      type: boolean
                      default: true
                    max_parallel_workers:
                      type: integer
                      minimum: 1
                      maximum: 10
                      default: 5
      responses:
        '200':
          description: Batch validation results (sync processing)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchValidationResult'
        '202':
          description: Batch validation accepted (async processing)
          content:
            application/json:
              schema:
                type: object
                properties:
                  batch_id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: ["processing"]
                  estimated_completion:
                    type: string
                    format: date-time

  /validate/batch/{batchId}:
    get:
      summary: Get batch validation status
      description: Retrieve status and results of async batch validation
      operationId: getBatchValidationStatus
      parameters:
        - name: batchId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Batch validation status and results
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/BatchValidationResult'
                  - type: object
                    properties:
                      batch_id:
                        type: string
                        format: uuid
                      status:
                        type: string
                        enum: ["processing", "completed", "failed"]
        '404':
          description: Batch not found

  /certify:
    post:
      summary: Agent certification
      description: Perform comprehensive certification assessment for OSSA agents
      operationId: certifyAgent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [agent_spec, certification_level]
              properties:
                agent_spec:
                  type: string
                  description: OSSA agent specification (YAML or JSON)
                certification_level:
                  type: string
                  enum: ["basic", "standard", "premium", "enterprise"]
                  description: Desired certification level
                compliance_frameworks:
                  type: array
                  items:
                    type: string
                    enum: ["ISO_42001", "NIST_AI_RMF", "EU_AI_Act", "SOC2", "HIPAA"]
                  description: Required compliance frameworks
                automated_assessment:
                  type: boolean
                  default: true
                  description: Enable automated assessment
                include_recommendations:
                  type: boolean
                  default: true
                  description: Include improvement recommendations
      responses:
        '200':
          description: Certification assessment results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CertificationResult'
        '400':
          description: Invalid certification request

  /reports/validation:
    get:
      summary: List validation reports
      description: Retrieve list of available validation reports with filtering and pagination
      operationId: listValidationReports
      parameters:
        - name: type
          in: query
          description: Filter by report type
          schema:
            type: string
            enum: ["validation", "certification", "compliance", "performance"]
        - name: date_from
          in: query
          description: Filter reports from date
          schema:
            type: string
            format: date
        - name: date_to
          in: query
          description: Filter reports to date
          schema:
            type: string
            format: date
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: List of validation reports
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportList'

    post:
      summary: Generate validation report
      description: Generate custom validation report based on specified criteria
      operationId: generateValidationReport
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [report_type, criteria]
              properties:
                report_type:
                  type: string
                  enum: ["validation_summary", "compliance_audit", "performance_analysis", "certification_status", "trend_analysis"]
                criteria:
                  type: object
                  properties:
                    date_range:
                      type: object
                      properties:
                        start:
                          type: string
                          format: date
                        end:
                          type: string
                          format: date
                    agent_filters:
                      type: array
                      items:
                        type: string
                    validation_types:
                      type: array
                      items:
                        type: string
                    compliance_frameworks:
                      type: array
                      items:
                        type: string
                output_format:
                  type: string
                  enum: ["json", "html", "pdf", "csv"]
                  default: "json"
                include_charts:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Generated validation report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationReport'
            text/html:
              schema:
                type: string
            application/pdf:
              schema:
                type: string
                format: binary
            text/csv:
              schema:
                type: string

  /reports/{reportId}:
    get:
      summary: Get specific validation report
      description: Retrieve a specific validation report by ID
      operationId: getValidationReport
      parameters:
        - name: reportId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: format
          in: query
          description: Response format
          schema:
            type: string
            enum: ["json", "html", "pdf"]
            default: "json"
      responses:
        '200':
          description: Validation report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationReport'
            text/html:
              schema:
                type: string
            application/pdf:
              schema:
                type: string
                format: binary
        '404':
          description: Report not found

  /a2a/discover:
    get:
      summary: Agent-to-agent discovery
      description: OSSA Agent-to-Agent (A2A) protocol discovery endpoint
      operationId: a2aDiscover
      security: []
      responses:
        '200':
          description: Agent discovery information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/A2ADiscovery'

  /mcp:
    get:
      summary: MCP server capabilities
      description: Model Context Protocol server capabilities and tools
      operationId: getMcpCapabilities
      responses:
        '200':
          description: MCP server information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpCapabilities'

  /mcp/tools/call:
    post:
      summary: Call MCP tool
      description: Execute an MCP tool with specified parameters
      operationId: callMcpTool
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/McpToolCall'
      responses:
        '200':
          description: Tool execution result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpToolResult'

  /metrics:
    get:
      summary: Prometheus metrics
      description: Prometheus-format metrics endpoint
      operationId: getPrometheusMetrics
      security: []
      responses:
        '200':
          description: Prometheus metrics
          content:
            text/plain:
              schema:
                type: string

components:
  securitySchemes:
    oauth2_pkce:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: /oauth2/authorize
          tokenUrl: /oauth2/token
          scopes:
            validation:read: Read validation data
            validation:write: Perform validations
            certification:read: Read certification data
            certification:write: Issue certifications
            reports:read: Read validation reports
            reports:write: Generate validation reports
            admin: Administrative access
    
    apiKey:
      type: apiKey
      in: header
      name: X-API-Key
    
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    HealthStatus:
      type: object
      required: [status, uptime, version]
      properties:
        status:
          type: string
          enum: ["healthy", "unhealthy", "degraded"]
        uptime:
          type: number
          description: Service uptime in seconds
        version:
          type: string
        dependencies:
          type: object
          additionalProperties:
            type: string
            enum: ["healthy", "unhealthy", "unknown"]

    AgentCapabilities:
      type: object
      required: [name, version, conformance, capabilities, validation_engines]
      properties:
        name:
          type: string
          example: "validation-specialist"
        version:
          type: string
          example: "1.1.0"
        conformance:
          $ref: '#/components/schemas/ConformanceInfo'
        capabilities:
          type: object
          properties:
            primary:
              type: array
              items:
                type: string
            secondary:
              type: array
              items:
                type: string
        validation_engines:
          type: object
          additionalProperties: true
        framework_adapters:
          type: object
          additionalProperties: true

    ConformanceInfo:
      type: object
      required: [tier, level]
      properties:
        tier:
          type: string
          enum: ["core", "governed", "advanced"]
        level:
          type: string
          enum: ["development", "production", "enterprise"]
        certification:
          type: object
          additionalProperties: true

    ValidationResult:
      type: object
      required: [valid, version, validation_time]
      properties:
        valid:
          type: boolean
          description: Overall validation status
        version:
          type: string
          description: OSSA version validated against
        validation_time:
          type: string
          format: date-time
        compliance_score:
          type: number
          minimum: 0
          maximum: 100
          description: Compliance percentage score
        errors:
          type: array
          items:
            $ref: '#/components/schemas/ValidationError'
        warnings:
          type: array
          items:
            $ref: '#/components/schemas/ValidationWarning'
        recommendations:
          type: array
          items:
            $ref: '#/components/schemas/ValidationRecommendation'
        schema_validation:
          $ref: '#/components/schemas/SchemaValidationResult'
        semantic_validation:
          $ref: '#/components/schemas/SemanticValidationResult'
        compliance_validation:
          $ref: '#/components/schemas/ComplianceValidationResult'

    ValidationError:
      type: object
      required: [code, message, path]
      properties:
        code:
          type: string
          description: Error code
        message:
          type: string
          description: Human-readable error message
        path:
          type: string
          description: JSONPath to the error location
        severity:
          type: string
          enum: ["critical", "high", "medium", "low"]
        suggestion:
          type: string
          description: Suggested fix

    ValidationWarning:
      type: object
      required: [code, message, path]
      properties:
        code:
          type: string
        message:
          type: string
        path:
          type: string
        impact:
          type: string
          enum: ["high", "medium", "low"]

    ValidationRecommendation:
      type: object
      required: [category, description]
      properties:
        category:
          type: string
          enum: ["performance", "security", "compliance", "best_practice"]
        description:
          type: string
        priority:
          type: string
          enum: ["high", "medium", "low"]
        effort:
          type: string
          enum: ["low", "medium", "high"]

    SchemaValidationResult:
      type: object
      properties:
        valid:
          type: boolean
        schema_version:
          type: string
        errors:
          type: array
          items:
            $ref: '#/components/schemas/ValidationError'
        validated_fields:
          type: integer
        schema_coverage:
          type: number
          minimum: 0
          maximum: 100

    SemanticValidationResult:
      type: object
      properties:
        valid:
          type: boolean
        consistency_score:
          type: number
          minimum: 0
          maximum: 100
        semantic_errors:
          type: array
          items:
            $ref: '#/components/schemas/ValidationError'
        capability_mappings:
          type: object
          additionalProperties: true

    ComplianceValidationResult:
      type: object
      properties:
        compliant:
          type: boolean
        frameworks:
          type: array
          items:
            type: object
            properties:
              framework:
                type: string
              status:
                type: string
                enum: ["compliant", "non_compliant", "partially_compliant"]
              score:
                type: number
                minimum: 0
                maximum: 100
              gaps:
                type: array
                items:
                  type: string

    OpenApiValidationResult:
      type: object
      required: [valid, openapi_version]
      properties:
        valid:
          type: boolean
        openapi_version:
          type: string
        specification_type:
          type: string
          enum: ["openapi", "swagger"]
        validation_time:
          type: string
          format: date-time
        errors:
          type: array
          items:
            $ref: '#/components/schemas/ValidationError'
        warnings:
          type: array
          items:
            $ref: '#/components/schemas/ValidationWarning'
        security_analysis:
          type: object
          properties:
            security_schemes:
              type: integer
            security_requirements:
              type: integer
            security_score:
              type: number
              minimum: 0
              maximum: 100
        documentation_coverage:
          type: number
          minimum: 0
          maximum: 100

    DualFormatValidationResult:
      type: object
      required: [formats_match, consistency_score]
      properties:
        formats_match:
          type: boolean
        consistency_score:
          type: number
          minimum: 0
          maximum: 100
        primary_format_valid:
          type: boolean
        secondary_format_valid:
          type: boolean
        differences:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
              primary_value:
                type: string
              secondary_value:
                type: string
              difference_type:
                type: string
                enum: ["value", "structure", "type", "missing"]
        semantic_equivalence:
          type: boolean
        conversion_possible:
          type: boolean

    BatchValidationResult:
      type: object
      required: [total_specifications, processed, results]
      properties:
        total_specifications:
          type: integer
        processed:
          type: integer
        successful:
          type: integer
        failed:
          type: integer
        results:
          type: array
          items:
            type: object
            properties:
              specification_id:
                type: string
              status:
                type: string
                enum: ["success", "error", "skipped"]
              validation_result:
                oneOf:
                  - $ref: '#/components/schemas/ValidationResult'
                  - $ref: '#/components/schemas/OpenApiValidationResult'
              error:
                type: string
        processing_time_ms:
          type: number
        summary_statistics:
          type: object
          properties:
            average_compliance_score:
              type: number
            total_errors:
              type: integer
            total_warnings:
              type: integer

    CertificationResult:
      type: object
      required: [certified, certification_level, assessment_date]
      properties:
        certified:
          type: boolean
        certification_level:
          type: string
          enum: ["basic", "standard", "premium", "enterprise"]
        assessment_date:
          type: string
          format: date-time
        certificate_id:
          type: string
          description: Unique certificate identifier (if certified)
        valid_until:
          type: string
          format: date
          description: Certificate expiry date
        overall_score:
          type: number
          minimum: 0
          maximum: 100
        certification_criteria:
          type: array
          items:
            type: object
            properties:
              criterion:
                type: string
              status:
                type: string
                enum: ["passed", "failed", "warning"]
              score:
                type: number
              details:
                type: string
        compliance_status:
          type: array
          items:
            type: object
            properties:
              framework:
                type: string
              compliant:
                type: boolean
              certification_ready:
                type: boolean
        recommendations:
          type: array
          items:
            $ref: '#/components/schemas/ValidationRecommendation'

    ReportList:
      type: object
      required: [reports, pagination]
      properties:
        reports:
          type: array
          items:
            type: object
            properties:
              report_id:
                type: string
                format: uuid
              type:
                type: string
              title:
                type: string
              created_date:
                type: string
                format: date-time
              size_bytes:
                type: integer
              format:
                type: string
        pagination:
          type: object
          properties:
            page:
              type: integer
            limit:
              type: integer
            total:
              type: integer
            has_next:
              type: boolean

    ValidationReport:
      type: object
      required: [report_id, type, generated_date, summary]
      properties:
        report_id:
          type: string
          format: uuid
        type:
          type: string
        title:
          type: string
        generated_date:
          type: string
          format: date-time
        summary:
          type: object
          properties:
            total_validations:
              type: integer
            success_rate:
              type: number
            average_compliance_score:
              type: number
            critical_issues:
              type: integer
        data:
          type: object
          additionalProperties: true
        charts:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
              title:
                type: string
              data:
                type: object

    A2ADiscovery:
      type: object
      required: [agent_id, name, version, capabilities]
      properties:
        agent_id:
          type: string
          format: uuid
        name:
          type: string
          example: "validation-specialist"
        version:
          type: string
          example: "1.1.0"
        ossa_version:
          type: string
          example: "0.1.7"
        capabilities:
          type: array
          items:
            type: string
        endpoints:
          type: object
          additionalProperties:
            type: string
        health_status:
          type: string
          enum: ["healthy", "unhealthy", "degraded"]
        validation_engines:
          type: array
          items:
            type: string

    McpCapabilities:
      type: object
      required: [protocol_version, server_name, tools]
      properties:
        protocol_version:
          type: string
          example: "2024-11-05"
        server_name:
          type: string
          example: "validation-specialist-mcp"
        tools:
          type: array
          items:
            $ref: '#/components/schemas/McpTool'

    McpTool:
      type: object
      required: [name, description]
      properties:
        name:
          type: string
        description:
          type: string
        inputSchema:
          type: object

    McpToolCall:
      type: object
      required: [name, arguments]
      properties:
        name:
          type: string
        arguments:
          type: object
          additionalProperties: true

    McpToolResult:
      type: object
      required: [success]
      properties:
        success:
          type: boolean
        result:
          oneOf:
            - type: object
            - type: array
            - type: string
            - type: number
            - type: boolean
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string

    ErrorResponse:
      type: object
      required: [error, message]
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true
        timestamp:
          type: string
          format: date-time
        request_id:
          type: string
          format: uuid

  examples:
    OssaValidationRequest:
      summary: OSSA agent specification validation
      value: |
        apiVersion: open-standards-scalable-agents/v0.1.7
        kind: Agent
        metadata:
          name: "example-agent"
          version: "1.0.0"
          description: "Example OSSA agent"
        spec:
          conformance:
            tier: "core"
            level: "production"
          class: "specialist"
          capabilities:
            primary:
              - "data_processing"
              - "content_analysis"

    ValidationSuccess:
      summary: Successful validation response
      value:
        valid: true
        version: "0.1.7"
        validation_time: "2025-09-04T21:30:00Z"
        compliance_score: 95.5
        errors: []
        warnings:
          - code: "W001"
            message: "Consider adding more detailed capability descriptions"
            path: "$.spec.capabilities.primary[0]"
            impact: "low"

webhooks:
  validationComplete:
    post:
      requestBody:
        description: Validation completion notification
        content:
          application/json:
            schema:
              type: object
              properties:
                validation_id:
                  type: string
                  format: uuid
                status:
                  type: string
                  enum: ["completed", "failed"]
                result:
                  $ref: '#/components/schemas/ValidationResult'
      responses:
        '200':
          description: Webhook received successfully

tags:
  - name: Health
    description: Service health and status endpoints
  - name: Validation
    description: Specification validation endpoints
  - name: Certification
    description: Agent certification services
  - name: Reports
    description: Validation reporting and analytics
  - name: MCP
    description: Model Context Protocol integration
  - name: A2A
    description: Agent-to-Agent communication protocol