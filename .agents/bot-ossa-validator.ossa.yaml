apiVersion: ossa/v0.3.5
kind: Agent
metadata:
  name: bot-ossa-validator
  namespace: openstandardagents.org
  version: 1.0.0
  title: OSSA Validator Agent
  description: Validates OSSA manifests against the schema specification. Ensures compliance with OSSA v0.3.0 standards and best practices.
  labels:
    component: validation
    domain: ossa
    tier: automation
  annotations:
    maintainer: devops@bluefly.io
    documentation: https://gitlab.com/blueflyio/ossa/openstandardagents.org/-/wikis/agents/ossa-validator
    service-account: bot-ossa-validator
spec:
  capabilities:
  - schema-validation
  - manifest-linting
  - compliance-checking
  - migration-assistance
  llm:
    model:
      primary: claude-sonnet-4-20250514
      fallback:
      - claude-3-5-sonnet-20241022
    execution_profile: quality
    token_limits:
      max_input: 50000
      max_output: 4096
  safety:
    content_filtering:
      enabled: true
    guardrails:
    - id: schema-compliance
      description: All manifests must validate against OSSA schema
      action: block
  observability:
    tracing:
      enabled: true
      exporter: otlp
    metrics:
      enabled: true
      custom:
      - name: validations_run
        type: counter
      - name: validation_errors
        type: counter
      - name: schemas_checked
        type: histogram
    logging:
      level: info
  tools:
  - name: ossa-cli
    type: builtin
    config:
      commands:
      - validate
      - lint
      - migrate
      - diff
  - name: json-schema
    type: builtin
    config:
      draft: 2020-12
  - name: gitlab-api
    type: mcp
    config:
      server: gitlab-mcp
      operations:
      - get_file_content
      - post_mr_comment
      - get_mr_changes
  commands:
    validate:
      description: Validate OSSA manifest against schema
      parameters:
        strict:
          type: boolean
          default: false
          description: Enable strict validation mode
        version:
          type: string
          default: 0.3.0
          description: OSSA schema version to validate against
        path:
          type: string
          description: Path to manifest file
      handler: 'Validate the OSSA manifest(s) against the schema:

        1. Schema compliance check

        2. Required fields validation

        3. Type checking

        4. Enum value validation

        5. Cross-reference validation


        Report findings as:

        - ❌ ERROR: Schema violations (blocking)

        - ⚠️ WARNING: Best practice issues

        - ℹ️ INFO: Suggestions for improvement

        '
    lint:
      description: Lint OSSA manifest for style and best practices
      handler: 'Check manifest for:

        1. Naming conventions

        2. Description quality

        3. Label consistency

        4. Documentation completeness

        5. Security configuration

        '
    diff:
      description: Show schema differences between versions
      parameters:
        from_version:
          type: string
        to_version:
          type: string
      handler: 'Compare OSSA schema versions and highlight:

        1. New required fields

        2. Deprecated fields

        3. Type changes

        4. Migration requirements

        '
    migrate:
      description: Suggest migration path for outdated manifests
      parameters:
        target_version:
          type: string
          default: 0.3.0
      handler: 'Analyze manifest and provide migration guidance:

        1. Identify outdated fields

        2. Suggest new required fields

        3. Provide migration snippets

        4. Warn about breaking changes

        '
  triggers:
  - type: webhook
    source: gitlab
    events:
    - merge_request.opened
    - merge_request.updated
    filter:
      changes_include:
      - '**/*.ossa.yaml'
      - '**/*.ossa.yml'
      - .agents/**/*
      - .gitlab/agents/**/*
      - spec/**/*
  outputs:
    schema:
      type: object
      properties:
        valid:
          type: boolean
        errors:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
              message:
                type: string
              severity:
                type: string
                enum:
                - error
                - warning
                - info
        warnings:
          type: array
          items:
            type: string
        schema_version:
          type: string
        manifest_version:
          type: string
  completion:
    default_signal: complete
    signals:
    - signal: continue
      condition: validation_count < max_validations
      priority: 1
    - signal: blocked
      condition: validation_errors > 10
      priority: 2
    - signal: checkpoint
      condition: validation_count % 20 == 0
      priority: 3
    max_iterations: 50
    timeout_seconds: 600
  checkpointing:
    enabled: true
    interval: iteration
    interval_value: 20
    retention:
      days: 7
      max_checkpoints: 30
    storage:
      backend: agent-brain
      location: s3://checkpoints/@bot-ossa-validator/{session_id}
extensions:
  opentelemetry:
    enabled: true
    service_name: bot-ossa-validator
    service_version: 1.0.0
    traces:
      enabled: true
      exporter: otlp
      endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:-http://localhost:4317}
      sample_rate: 1.0
    metrics:
      enabled: true
      exporter: otlp
      endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:-http://localhost:4317}
      collection_interval_seconds: 60
    logs:
      enabled: true
      exporter: otlp
      endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:-http://localhost:4317}
      level: info
    langsmith:
      enabled: true
      api_key_env: LANGSMITH_API_KEY
      project_name: ossa-validator
    resource_attributes:
      agent.id: bot-ossa-validator
      agent.version: 1.0.0
      framework: ossa
  experts:
    registry:
    - id: strict-validation-expert
      name: Strict Schema Validation Expert
      model:
        provider: anthropic
        model: claude-opus-4-5-20251101
      specializations:
      - strict_validation
      - schema_compliance
      - breaking_changes
      cost_tier: premium
    - id: quick-validation-expert
      name: Quick Validation Expert
      model:
        provider: google
        model: gemini-2.0-flash
      specializations:
      - quick_validation
      - basic_checks
      - high_volume
      cost_tier: economy
    selection_strategy: agent_controlled
  moe:
    primary:
      metric: validation_accuracy
      target: 0.99
      measurement:
        type: ratio
        numerator: correct_validations
        denominator: total_validations
    secondary:
    - metric: validation_latency_p95
      target: 5
      unit: seconds
  bat:
    selection_criteria:
    - dimension: validation_complexity
      required: true
      options:
      - value: complex
        technologies:
        - claude-opus
        - gpt-4-turbo
        cost_tier: premium
        use_case: Complex OSS Validator tasks
      - value: standard
        technologies:
        - claude-sonnet
        - gpt-4o
        cost_tier: standard
        use_case: Standard OSS Validator tasks
      - value: simple
        technologies:
        - gemini-flash
        - claude-haiku
        cost_tier: economy
        use_case: Quick OSS Validator checks
  feedback:
    learning:
      enabled: true
      strategy: reinforcement
      data_sources:
      - validation_outcomes
      - validation_results
  infrastructure:
  - type: agent_mesh
    endpoint: mesh.blueflyagents.com:3005
    capabilities:
    - agent_coordination
    - validation_tracking
