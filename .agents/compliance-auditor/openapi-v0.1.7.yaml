openapi: 3.1.0
info:
  title: OSSA Compliance Auditor Agent
  version: 1.1.0
  description: |
    Enterprise compliance auditor agent with universal framework compatibility.
    Supports ISO 42001, NIST AI RMF, and EU AI Act compliance auditing.
  termsOfService: https://ossa.standards/terms
  contact:
    name: OSSA Community
    url: https://ossa.standards/support
    email: support@ossa.standards
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
    identifier: Apache-2.0

servers:
  - url: https://api.ossa.local/compliance-auditor/v1
    description: Local development server
  - url: https://compliance-auditor.ossa.prod/v1
    description: Production server

security:
  - OAuth2PKCE: ["audit:read", "audit:write", "compliance:check"]
  - ApiKey: []
  - mTLS: []

paths:
  /health:
    get:
      summary: Health check endpoint
      description: Returns the health status of the compliance auditor agent
      operationId: getHealth
      tags: [System]
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
        '503':
          description: Service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /capabilities:
    get:
      summary: Get agent capabilities
      description: Returns detailed information about agent capabilities and supported frameworks
      operationId: getCapabilities
      tags: [Discovery]
      responses:
        '200':
          description: Agent capabilities
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentCapabilities'

  /audit:
    post:
      summary: Start compliance audit
      description: Initiates a comprehensive compliance audit against specified frameworks
      operationId: startAudit
      tags: [Audit]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuditRequest'
      responses:
        '202':
          description: Audit started successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditResponse'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get audit status
      description: Retrieves the status and results of ongoing or completed audits
      operationId: getAuditStatus
      tags: [Audit]
      parameters:
        - name: auditId
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Audit status retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditStatus'

  /compliance/check:
    post:
      summary: Perform compliance check
      description: Validates system or process compliance against specific frameworks
      operationId: checkCompliance
      tags: [Compliance]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComplianceCheckRequest'
      responses:
        '200':
          description: Compliance check completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComplianceResult'
        '400':
          description: Invalid compliance check request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /risk/assess:
    post:
      summary: Perform risk assessment
      description: Conducts comprehensive risk assessment for AI systems
      operationId: assessRisk
      tags: [Risk]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RiskAssessmentRequest'
      responses:
        '200':
          description: Risk assessment completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RiskAssessmentResult'
        '202':
          description: Risk assessment started (async)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AsyncOperationResponse'

  /reports:
    get:
      summary: List available reports
      description: Returns a list of available audit and compliance reports
      operationId: listReports
      tags: [Reports]
      parameters:
        - name: framework
          in: query
          schema:
            type: string
            enum: [iso_42001, nist_ai_rmf, eu_ai_act]
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Reports list retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportsList'

    post:
      summary: Generate custom report
      description: Creates a custom compliance or audit report
      operationId: generateReport
      tags: [Reports]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReportRequest'
      responses:
        '201':
          description: Report generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportResponse'

  /mcp:
    get:
      summary: MCP server discovery
      description: Returns MCP server capabilities and available tools
      operationId: getMCPCapabilities
      tags: [MCP]
      responses:
        '200':
          description: MCP capabilities
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MCPCapabilities'

  /a2a/discover:
    get:
      summary: Agent-to-agent discovery
      description: Returns agent discovery information for orchestration
      operationId: discoverAgent
      tags: [Orchestration]
      responses:
        '200':
          description: Agent discovery information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentDiscovery'

components:
  securitySchemes:
    OAuth2PKCE:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: https://auth.ossa.standards/oauth2/authorize
          tokenUrl: https://auth.ossa.standards/oauth2/token
          scopes:
            audit:read: Read audit information
            audit:write: Perform audits
            compliance:check: Check compliance status
            risk:assess: Perform risk assessments
            reports:generate: Generate reports
    ApiKey:
      type: apiKey
      in: header
      name: X-API-Key
    mTLS:
      type: mutualTLS

  schemas:
    HealthStatus:
      type: object
      required: [status, timestamp, version]
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        version:
          type: string
        uptime:
          type: integer
          description: Uptime in seconds
        dependencies:
          type: object
          additionalProperties:
            type: object
            properties:
              status:
                type: string
                enum: [healthy, unhealthy]
              latency_ms:
                type: number

    AgentCapabilities:
      type: object
      required: [name, version, capabilities, frameworks]
      properties:
        name:
          type: string
        version:
          type: string
        capabilities:
          type: object
          properties:
            primary:
              type: array
              items:
                type: string
            secondary:
              type: array
              items:
                type: string
        frameworks:
          type: object
          properties:
            mcp:
              $ref: '#/components/schemas/MCPSupport'
            langchain:
              $ref: '#/components/schemas/LangChainSupport'
            crewai:
              $ref: '#/components/schemas/CrewAISupport'
            autogen:
              $ref: '#/components/schemas/AutoGenSupport'

    MCPSupport:
      type: object
      properties:
        enabled:
          type: boolean
        version:
          type: string
        tools:
          type: array
          items:
            type: string

    LangChainSupport:
      type: object
      properties:
        enabled:
          type: boolean
        adapter_class:
          type: string
        chain_integration:
          type: boolean

    CrewAISupport:
      type: object
      properties:
        enabled:
          type: boolean
        role:
          type: string
        goal:
          type: string

    AutoGenSupport:
      type: object
      properties:
        enabled:
          type: boolean
        agent_type:
          type: string

    AuditRequest:
      type: object
      required: [frameworks, scope]
      properties:
        frameworks:
          type: array
          items:
            type: string
            enum: [iso_42001, nist_ai_rmf, eu_ai_act]
        scope:
          type: object
          properties:
            systems:
              type: array
              items:
                type: string
            processes:
              type: array
              items:
                type: string
            controls:
              type: array
              items:
                type: string
        priority:
          type: string
          enum: [low, medium, high, critical]
          default: medium
        async:
          type: boolean
          default: false

    AuditResponse:
      type: object
      required: [audit_id, status, estimated_completion]
      properties:
        audit_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, running, completed, failed]
        estimated_completion:
          type: string
          format: date-time
        progress:
          type: number
          minimum: 0
          maximum: 100

    AuditStatus:
      type: object
      required: [audit_id, status, progress]
      properties:
        audit_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, running, completed, failed]
        progress:
          type: number
          minimum: 0
          maximum: 100
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        results:
          $ref: '#/components/schemas/AuditResults'

    AuditResults:
      type: object
      properties:
        overall_score:
          type: number
          minimum: 0
          maximum: 100
        framework_results:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/FrameworkResult'
        recommendations:
          type: array
          items:
            $ref: '#/components/schemas/Recommendation'

    FrameworkResult:
      type: object
      properties:
        compliance_score:
          type: number
          minimum: 0
          maximum: 100
        status:
          type: string
          enum: [compliant, non_compliant, partially_compliant]
        gaps:
          type: array
          items:
            $ref: '#/components/schemas/ComplianceGap'

    ComplianceGap:
      type: object
      properties:
        control_id:
          type: string
        description:
          type: string
        severity:
          type: string
          enum: [low, medium, high, critical]
        remediation:
          type: string

    Recommendation:
      type: object
      properties:
        priority:
          type: string
          enum: [low, medium, high, critical]
        description:
          type: string
        effort:
          type: string
          enum: [low, medium, high]
        timeline:
          type: string

    ComplianceCheckRequest:
      type: object
      required: [framework, target]
      properties:
        framework:
          type: string
          enum: [iso_42001, nist_ai_rmf, eu_ai_act]
        target:
          type: object
          properties:
            type:
              type: string
              enum: [system, process, control]
            identifier:
              type: string
            metadata:
              type: object

    ComplianceResult:
      type: object
      required: [compliant, score]
      properties:
        compliant:
          type: boolean
        score:
          type: number
          minimum: 0
          maximum: 100
        details:
          type: array
          items:
            $ref: '#/components/schemas/ComplianceDetail'
        evidence:
          type: array
          items:
            $ref: '#/components/schemas/Evidence'

    ComplianceDetail:
      type: object
      properties:
        control_id:
          type: string
        status:
          type: string
          enum: [pass, fail, not_applicable]
        evidence_required:
          type: boolean
        automated:
          type: boolean

    Evidence:
      type: object
      properties:
        type:
          type: string
          enum: [document, log, configuration, testimony]
        source:
          type: string
        timestamp:
          type: string
          format: date-time
        hash:
          type: string
          description: Cryptographic hash for integrity

    RiskAssessmentRequest:
      type: object
      required: [system_description]
      properties:
        system_description:
          type: string
        risk_categories:
          type: array
          items:
            type: string
            enum: [operational, security, compliance, reputational]
        assessment_type:
          type: string
          enum: [initial, periodic, incident_triggered]
          default: initial

    RiskAssessmentResult:
      type: object
      required: [overall_risk_score, risk_level]
      properties:
        overall_risk_score:
          type: number
          minimum: 0
          maximum: 1
        risk_level:
          type: string
          enum: [low, medium, high, critical]
        category_scores:
          type: object
          additionalProperties:
            type: number
        mitigation_strategies:
          type: array
          items:
            $ref: '#/components/schemas/MitigationStrategy'

    MitigationStrategy:
      type: object
      properties:
        risk_category:
          type: string
        strategy:
          type: string
        effectiveness:
          type: number
          minimum: 0
          maximum: 1
        cost:
          type: string
          enum: [low, medium, high]

    ReportsList:
      type: object
      properties:
        reports:
          type: array
          items:
            $ref: '#/components/schemas/ReportSummary'
        total_count:
          type: integer

    ReportSummary:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        type:
          type: string
          enum: [audit, compliance, risk, custom]
        created_at:
          type: string
          format: date-time
        framework:
          type: string

    ReportRequest:
      type: object
      required: [type, format]
      properties:
        type:
          type: string
          enum: [audit_summary, compliance_status, risk_assessment, gap_analysis]
        format:
          type: string
          enum: [json, pdf, xml, html]
        filters:
          type: object
        include_evidence:
          type: boolean
          default: false

    ReportResponse:
      type: object
      required: [report_id, download_url]
      properties:
        report_id:
          type: string
        download_url:
          type: string
          format: uri
        expires_at:
          type: string
          format: date-time

    MCPCapabilities:
      type: object
      properties:
        protocol_version:
          type: string
        server_info:
          type: object
        tools:
          type: array
          items:
            $ref: '#/components/schemas/MCPTool'

    MCPTool:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        input_schema:
          type: object

    AgentDiscovery:
      type: object
      required: [agent_id, capabilities, endpoints]
      properties:
        agent_id:
          type: string
        name:
          type: string
        capabilities:
          type: array
          items:
            type: string
        endpoints:
          type: object
        health_check_interval:
          type: integer
        last_seen:
          type: string
          format: date-time

    AsyncOperationResponse:
      type: object
      required: [operation_id, status]
      properties:
        operation_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, running, completed, failed]
        status_url:
          type: string
          format: uri

    ErrorResponse:
      type: object
      required: [error, message]
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: object
        timestamp:
          type: string
          format: date-time
        request_id:
          type: string