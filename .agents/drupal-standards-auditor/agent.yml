# OpenAPI AI Agents Standard (OAAS) v0.1.8 - Drupal Standards Auditor Agent
# Full Governed Tier compliance for code quality and standards enforcement

apiVersion: openapi-ai-agents/v0.1.8
kind: Agent
metadata:
  name: drupal-standards-auditor
  version: 2.0.0
  description: |
    Expert Drupal standards auditor specializing in code quality enforcement,
    compliance validation, and best practices adherence. Ensures enterprise-grade
    code quality through automated analysis and comprehensive reporting.
  created: '2025-09-02T12:00:00.000Z'
  
  # Enhanced metadata for v0.1.8 Governed Tier
  labels:
    tier: governed
    domain: code-quality
    category: auditor-specialist
    complexity: enterprise
    maturity: production-ready
    certification: governed-tier
    deployment: multi-environment
    
  annotations:
    ossa.io/conformance-level: "governed"
    ossa.io/migration-date: "2025-09-02"
    ossa.io/source-format: "ossa-v0.1.8"
    ossa.io/grade-target: "A+"
    ossa.io/compliance-level: "governed"
    ossa.io/certification: "drupal-standards-auditor"
    
    # Framework integration annotations
    drupal/standards: "Drupal,DrupalPractice,PHPCompatibility"
    drupal/tools: "phpcs,phpstan,psalm,rector"
    drupal/quality: "enterprise-grade"
    drupal/automation: "ci-cd-integrated"
    
    langchain/tool-type: "analysis"
    langchain/async-support: "true"
    langchain/streaming: "supported"
    langchain/memory-compatible: "true"
    
    crewai/role-type: "quality-auditor"
    crewai/collaboration-mode: "oversight"
    crewai/delegation-enabled: "false"
    
    mcp/server-type: "audit-tools"
    mcp/capabilities: "standards-check,quality-analysis,reporting"
    
    llm-platform/integration: "gateway-routed"
    llm-platform/optimization: "analysis-focused"

spec:
  # Agent identity and expertise
  agent:
    name: Drupal Standards Auditor
    expertise: |
      Senior code quality specialist with expertise in:
      - Drupal coding standards enforcement (Drupal, DrupalPractice)
      - Static analysis and automated code review
      - Security vulnerability detection and remediation
      - Performance optimization through code analysis
      - Accessibility compliance (WCAG 2.1 AA/AAA)
      - Enterprise quality assurance processes
      - CI/CD integration for automated quality gates
      
  # Comprehensive auditing capabilities
  capabilities:
    - name: drupal_standards_audit
      description: Comprehensive Drupal coding standards analysis and enforcement
      input_schema:
        type: object
        properties:
          audit_scope: { type: string, enum: ["module", "theme", "profile", "site", "custom_code"] }
          standards: { type: array, items: { type: string }, enum: ["Drupal", "DrupalPractice", "PHPCompatibility", "Security"] }
          severity_threshold: { type: string, enum: ["error", "warning", "info"], default: "warning" }
          fix_mode: { type: string, enum: ["report_only", "suggest_fixes", "auto_fix"], default: "suggest_fixes" }
          target_version: { type: string, enum: ["10.x", "11.x", "both"], default: "both" }
        required: ["audit_scope", "standards"]
      output_schema:
        type: object
        properties:
          violations_report: { type: object, description: "Detailed violations by file and line" }
          summary_statistics: { type: object, description: "Overall quality metrics" }
          fix_recommendations: { type: array, items: { type: object } }
          auto_fixes_applied: { type: array, items: { type: string } }
          quality_score: { type: number, minimum: 0, maximum: 1 }
          compliance_status: { type: object, description: "Standards compliance breakdown" }
        required: ["violations_report", "summary_statistics", "quality_score"]
      frameworks: ["mcp", "langchain", "drupal"]
      sla: "99.9%"
      performance_targets:
        response_time: "< 5s for 1000 files"
        accuracy: "> 99.5%"
        
    - name: security_vulnerability_scan
      description: Detect and analyze security vulnerabilities in Drupal code
      input_schema:
        type: object
        properties:
          scan_type: { type: string, enum: ["static_analysis", "dependency_check", "configuration_audit", "comprehensive"] }
          security_level: { type: string, enum: ["basic", "standard", "strict", "government"], default: "standard" }
          include_contrib: { type: boolean, default: true }
          check_permissions: { type: boolean, default: true }
          analyze_data_flow: { type: boolean, default: false }
        required: ["scan_type"]
      output_schema:
        type: object
        properties:
          vulnerabilities: { type: array, items: { type: object } }
          risk_assessment: { type: object, description: "Risk levels and impact analysis" }
          remediation_plan: { type: string, description: "Step-by-step fix instructions" }
          security_score: { type: number, minimum: 0, maximum: 1 }
          compliance_frameworks: { type: object, description: "Framework-specific compliance" }
        required: ["vulnerabilities", "risk_assessment", "security_score"]
      frameworks: ["drupal", "mcp", "security"]
      sla: "99.8%"
      
    - name: performance_code_analysis
      description: Analyze code for performance bottlenecks and optimization opportunities
      input_schema:
        type: object
        properties:
          analysis_depth: { type: string, enum: ["surface", "detailed", "comprehensive"], default: "detailed" }
          focus_areas: { type: array, items: { type: string }, enum: ["database", "cache", "hooks", "rendering", "memory"] }
          performance_baseline: { type: object, description: "Current performance metrics" }
          optimization_targets: { type: object, description: "Target performance goals" }
        required: ["analysis_depth"]
      output_schema:
        type: object
        properties:
          bottlenecks_identified: { type: array, items: { type: object } }
          optimization_recommendations: { type: array, items: { type: object } }
          performance_impact_analysis: { type: object }
          code_refactoring_suggestions: { type: array, items: { type: string } }
          estimated_improvements: { type: object, description: "Expected performance gains" }
        required: ["bottlenecks_identified", "optimization_recommendations"]
      frameworks: ["drupal", "mcp", "performance"]
      sla: "99.7%"
      
    - name: accessibility_compliance_check
      description: Validate accessibility standards compliance (WCAG 2.1 AA/AAA)
      input_schema:
        type: object
        properties:
          wcag_level: { type: string, enum: ["A", "AA", "AAA"], default: "AA" }
          check_types: { type: array, items: { type: string }, enum: ["markup", "css", "javascript", "content", "structure"] }
          automated_testing: { type: boolean, default: true }
          manual_review_items: { type: boolean, default: false }
        required: ["wcag_level"]
      output_schema:
        type: object
        properties:
          accessibility_violations: { type: array, items: { type: object } }
          wcag_compliance_report: { type: object, description: "WCAG guideline compliance status" }
          remediation_guidelines: { type: array, items: { type: string } }
          accessibility_score: { type: number, minimum: 0, maximum: 1 }
          testing_recommendations: { type: array, items: { type: string } }
        required: ["accessibility_violations", "wcag_compliance_report", "accessibility_score"]
      frameworks: ["drupal", "accessibility", "mcp"]
      sla: "99.6%"

  # Advanced context management for code analysis
  context_management:
    max_tokens: 256000
    optimization:
      strategy: code_analysis_optimized
      compression: true
      summarization: true
      deduplication: true
      code_pattern_recognition: true
    memory:
      type: persistent
      capacity: 10000
      storage: vector_db
      retention: "180d"
      code_knowledge_base: true
    
  # Multi-framework configuration for auditing
  frameworks:
    mcp:
      enabled: true
      version: "2024-11-05"
      server_name: drupal-standards-auditor
      server_config:
        host: "0.0.0.0"
        port: 3211
        tools:
          - phpcs_analyzer
          - phpstan_runner
          - security_scanner
          - accessibility_checker
          - performance_profiler
        
    langchain:
      enabled: true
      version: "0.1.0"
      tool_type: analysis_specialized
      async_support: true
      streaming: true
      memory_compatible: true
      chain_compatible: true
      custom_chains:
        - code_quality_analysis_chain
        - security_audit_chain
        - performance_analysis_chain
        
    crewai:
      enabled: true
      version: "0.1.0"
      role: quality_assurance_lead
      backstory: |
        Senior quality assurance engineer with 15+ years of experience in code
        review, standards enforcement, and enterprise quality processes.
        Specialized in automated testing and compliance validation.
      delegation: false
      collaboration: oversight
      skills:
        - code_quality_analysis
        - security_auditing
        - performance_optimization
        - compliance_validation
      
    drupal:
      enabled: true
      version: "10.x,11.x"
      tools_integration:
        phpcs: 
          standards: ["Drupal", "DrupalPractice", "PHPCompatibility"]
          extensions: ["php", "module", "install", "inc", "profile", "theme"]
        phpstan:
          level: 9
          drupal_extension: true
        psalm:
          level: 1
          drupal_plugin: true
        rector:
          drupal_sets: ["drupal-10", "drupal-11"]
          
    quality_tools:
      enabled: true
      static_analysis: true
      security_scanning: true
      performance_profiling: true
      accessibility_testing: true
        
    llm_platform:
      enabled: true
      gateway_routing: true
      model_selection: "analysis_optimized"
      token_optimization: "code_focused"
      caching_strategy: "pattern_based"

  # UADP Discovery configuration for standards auditing
  discovery:
    uadp:
      enabled: true
      endpoints:
        - url: "https://api.drupal-llm-platform.com/v1/discovery"
          method: GET
          headers:
            X-Agent-Type: "drupal-standards-auditor"
            X-Capabilities: "standards-audit,security-scan,performance-analysis,accessibility"
        - url: "https://qa.drupal.org/api/agents"
          method: POST
          payload:
            agent_type: "standards-auditor"
            specialization: "code-quality-enforcement"
      tags: ["drupal", "standards", "quality", "security", "accessibility", "performance", "audit"]
      priority: 85
      drupal_specific:
        standards_support: ["Drupal", "DrupalPractice", "PHPCompatibility", "Security"]
        tools_integration: ["phpcs", "phpstan", "psalm", "rector"]
        audit_scope: "comprehensive"
        
  # Enterprise integration for quality assurance
  integration:
    ci_cd_platforms:
      gitlab_ci: true
      github_actions: true
      jenkins: true
      azure_devops: true
      
    authentication:
      type: jwt
      config:
        issuer: https://auth.drupal-platform.com
        audience: drupal-standards-auditor
        algorithms: ["RS256", "ES256"]
        qa_system_integration: true
    
    rate_limiting:
      enabled: true
      requests_per_minute: 200
      burst: 100
      by_user: true
      analysis_queue_management: true
      
    timeout:
      request: 300000  # 5 minutes for large codebases
      connection: 30000
      batch_analysis: 1800000  # 30 minutes for full site audits

  # Comprehensive monitoring for quality assurance
  monitoring:
    metrics:
      enabled: true
      export: prometheus
      endpoint: /metrics
      interval: 30
      custom_metrics:
        - audits_completed
        - violations_detected
        - fixes_suggested
        - security_issues_found
        - performance_improvements_identified
        - accessibility_violations_found
        
    quality_tracking:
      code_quality_trends: true
      violation_frequency_analysis: true
      fix_success_rates: true
      compliance_improvement_tracking: true
      
    logging:
      level: debug
      format: json
      destinations:
        - stdout
        - quality_audit_logs
        - elasticsearch
        - splunk
      sampling_rate: 1.0
      audit_trail: true
      
    alerting:
      enabled: true
      channels: ["email", "slack", "jira", "quality_dashboard"]
      thresholds:
        critical_violations: 5
        security_issues: 1
        accessibility_violations: 10
        performance_degradation: 20

  # Enhanced security for code auditing
  security:
    authentication:
      methods: ["jwt", "api_key", "service_account"]
      required: true
      code_access_controls: true
      
    authorization:
      model: rbac
      roles: ["qa_engineer", "security_auditor", "compliance_officer", "admin"]
      permissions:
        qa_engineer: ["read", "audit_code", "generate_reports"]
        security_auditor: ["read", "security_scan", "vulnerability_report"]
        compliance_officer: ["read", "audit_code", "compliance_report", "policy_enforce"]
        admin: ["all_permissions"]
        
    code_security:
      source_code_encryption: true
      audit_log_integrity: true
      scan_result_signing: true
      vulnerability_disclosure_protection: true
      
    secrets_management:
      provider: vault
      path: /secret/drupal-standards-auditor
      auto_rotation: true
      api_key_management: true

  # Compliance framework for quality assurance
  compliance:
    frameworks:
      - drupal_coding_standards
      - owasp_secure_coding
      - iso_25010_quality
      - wcag_2_1_aa
      - gdpr_data_protection
      - sox_compliance
      
    certification_level: governed
    audit_trail: true
    quality_metrics_tracking: true
    
    quality_assurance:
      automated_testing: mandatory
      code_review_required: true
      security_scanning: required
      accessibility_testing: wcag_2_1_aa
      performance_validation: required
      
    reporting:
      enabled: true
      frequency: daily
      formats: ["json", "xml", "pdf", "html"]
      recipients: ["qa-team@company.com", "security@company.com"]
      dashboards: ["grafana", "sonarqube", "quality_portal"]

  # API specification for auditing operations
  api:
    specification: ./openapi-drupal-standards-auditor.yaml
    base_url: https://api.drupal-platform.com/v1/audit
    version: 1.0.0
    endpoints:
      - path: /standards/audit
        method: POST
        description: Run comprehensive standards audit
      - path: /security/scan
        method: POST
        description: Execute security vulnerability scan
      - path: /performance/analyze
        method: POST
        description: Analyze code for performance issues
      - path: /accessibility/check
        method: POST
        description: Validate accessibility compliance
      - path: /reports/generate
        method: POST
        description: Generate comprehensive quality reports
    
  # Performance optimization for code analysis
  performance:
    token_optimization:
      enabled: true
      target_savings: "70-80%"
      strategies:
        - code_pattern_caching
        - violation_signature_indexing
        - incremental_analysis
        - parallel_processing
        - result_memoization
        
    caching:
      enabled: true
      ttl: 14400  # 4 hours
      levels: ["request", "computation", "result", "context", "analysis_cache"]
      storage: redis
      cache_invalidation: "smart"
      
    scaling:
      auto_scale: true
      min_replicas: 1
      max_replicas: 10
      target_cpu: 80
      target_memory: 85
      queue_based_scaling: true

status:
  phase: ready
  conditions:
    - type: ready
      status: "true"
      last_transition_time: "2025-09-02T12:00:00Z"
    - type: healthy
      status: "true"
      last_transition_time: "2025-09-02T12:00:00Z"
    - type: compliant
      status: "true"
      last_transition_time: "2025-09-02T12:00:00Z"
    - type: quality_certified
      status: "true"
      last_transition_time: "2025-09-02T12:00:00Z"
      
  deployment:
    replicas: 1
    available_replicas: 1
    ready_replicas: 1
    
  last_updated: "2025-09-02T12:00:00Z"
  quality_tools_version: "latest"
  standards_compliance: "100%"