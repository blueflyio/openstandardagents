apiVersion: ossa/v0.3.0
kind: Agent

metadata:
  name: cody-agent
  version: 1.0.0
  description: |
    OSSA-compliant agent for Cody (Sourcegraph's AI assistant).
    Provides code intelligence with full codebase context.

  labels:
    ossa-version: v0.3.0
    platform: cody
    provider: sourcegraph
    category: ai-assistant

spec:
  taxonomy:
    domain: development
    subdomain: code-intelligence
    capability: context-aware-assistance

  role: |
    You are Cody, Sourcegraph's AI coding assistant.

    Your responsibilities:
    1. Provide context-aware code completions
    2. Answer questions about the codebase
    3. Generate code with full repository context
    4. Explain complex code patterns
    5. Assist with code navigation

    Leverage Sourcegraph's code intelligence.

  llm:
    provider: ${LLM_PROVIDER:-anthropic}
    model: ${LLM_MODEL:-claude-sonnet-4}
    temperature: 0.2
    maxTokens: 8000

    fallback_models:
      - provider: ${LLM_FALLBACK_PROVIDER_1:-openai}
        model: ${LLM_FALLBACK_MODEL_1:-gpt-4o}

    retry_config:
      max_attempts: 3
      backoff_strategy: exponential

    cost_tracking:
      enabled: true
      budget_alert_threshold: 75.00
      cost_allocation_tags:
        platform: cody
        team: ide-agents

  capabilities:
    - name: context_aware_completion
      description: Generate completions with codebase context
      input_schema:
        type: object
        required: [prefix, file]
        properties:
          prefix:
            type: string
          suffix:
            type: string
          file:
            type: string
          language:
            type: string
          repository:
            type: string
      output_schema:
        type: object
        properties:
          completions:
            type: array
            items:
              type: object
              properties:
                text:
                  type: string
                context_used:
                  type: array
                  items:
                    type: string

    - name: codebase_chat
      description: Chat about the codebase
      input_schema:
        type: object
        required: [question]
        properties:
          question:
            type: string
          repository:
            type: string
          files:
            type: array
            items:
              type: string
          symbols:
            type: array
            items:
              type: string
      output_schema:
        type: object
        properties:
          answer:
            type: string
          references:
            type: array
            items:
              type: object
              properties:
                file:
                  type: string
                line:
                  type: integer
                snippet:
                  type: string

    - name: code_search
      description: Search code semantically
      input_schema:
        type: object
        required: [query]
        properties:
          query:
            type: string
          repository:
            type: string
          language:
            type: string
          type:
            type: string
            enum: [symbol, text, semantic]
      output_schema:
        type: object
        properties:
          results:
            type: array
            items:
              type: object
              properties:
                file:
                  type: string
                line:
                  type: integer
                match:
                  type: string
                context:
                  type: string

    - name: explain_code
      description: Explain code with repository context
      input_schema:
        type: object
        required: [code]
        properties:
          code:
            type: string
          file:
            type: string
          repository:
            type: string
          detail_level:
            type: string
            enum: [brief, detailed, comprehensive]
      output_schema:
        type: object
        properties:
          explanation:
            type: string
          related_code:
            type: array
            items:
              type: object
          dependencies:
            type: array
            items:
              type: string

  runtime:
    type: hybrid
    config:
      timeout: 60
      retries: 2

  integration:
    platform: cody
    version: ">=1.0.0"
    configuration:
      sourcegraph_url: https://sourcegraph.com
      embeddings_enabled: true
      context_window: large
      autocomplete: true
