# OpenAPI AI Agents Standard (OAAS) v0.1.1 - Claude Code Analyzer Agent
# Specialized agent for code analysis, security scanning, and quality optimization

apiVersion: "openapi-ai-agents/v0.1.1"
kind: "Agent"
metadata:
  name: "claude-code-analyzer"
  version: "1.0.0"
  created: "2025-08-26"
  updated: "2025-08-26"
  description: "Claude Code specialized agent for comprehensive code analysis, security scanning, performance optimization, and quality assessment"

  # Universal Framework Compatibility Annotations
  annotations:
    # OAAS Core Compliance
    oaas/version: "0.1.1"
    oaas/certification-level: "silver"
    oaas/compliance-frameworks: "iso-42001,nist-ai-rmf"
    oaas/token-optimization: "enabled"
    oaas/protocol-bridges: "mcp,openai,custom"

    # Claude Code Specific
    claude-code/agent-type: "analyzer"
    claude-code/specialization: "code-quality,security,performance"
    claude-code/integration-method: "direct-api"

    # Universal Framework Support
    oaas/framework-support: "mcp,openai,langchain,anthropic"

    # MCP Integration (Primary for Claude Code)
    mcp/server-compatible: "true"
    mcp/claude-desktop: "optimized"
    mcp/tool-type: "structured"
    mcp/streaming: "supported"

    # OpenAI Integration
    openai/function-calling: "supported"
    openai/assistant-type: "code_analysis"

    # LangChain Integration
    langchain/tool-type: "structured"
    langchain/async-support: "true"

    # Performance and Optimization
    performance/token-optimization: "35-45-percent"
    performance/caching: "semantic"
    performance/response-time: "sub-500ms"

  labels:
    domain: "code-analysis"
    category: "claude-code-agent"
    complexity: "production"
    maturity: "stable"
    certification: "silver"

spec:
  # Required OAAS agent section
  agent:
    name: "Claude Code Analyzer"
    expertise: "Specialized Claude Code agent providing comprehensive code analysis, security scanning, performance optimization, and quality assessment capabilities"

  description: "Specialized Claude Code agent providing comprehensive code analysis, security scanning, performance optimization, and quality assessment capabilities"

  # OAAS-compliant capabilities (flat array format)
  capabilities:
    - name: "code_quality_analysis"
      description: "Analyze code quality, patterns, conventions, and maintainability metrics"
      frameworks: ["mcp", "openai", "langchain"]
      input_schema: "./schemas/code-analysis.input.json"
      output_schema: "./schemas/code-analysis.output.json"
      compliance: ["iso-42001"]
      performance:
        response_time_ms: { target: 300, max: 500 }
        throughput_rps: { target: 100, max: 200 }

    - name: "security_vulnerability_scan"
      description: "Scan code for security vulnerabilities, OWASP compliance, and potential threats"
      frameworks: ["mcp", "openai", "langchain"]
      input_schema: "./schemas/security-scan.input.json"
      output_schema: "./schemas/security-scan.output.json"
      compliance: ["iso-42001", "nist-ai-rmf"]
      performance:
        response_time_ms: { target: 500, max: 1000 }
        accuracy: { target: 95, min: 90 }

    - name: "performance_optimization"
      description: "Identify performance bottlenecks and suggest optimizations"
      frameworks: ["mcp", "openai"]
      input_schema: "./schemas/performance.input.json"
      output_schema: "./schemas/performance.output.json"
      compliance: ["iso-42001"]

    - name: "dependency_analysis"
      description: "Analyze dependencies for security, licensing, and version compatibility"
      frameworks: ["mcp", "langchain"]

    - name: "code_metrics_calculation"
      description: "Calculate cyclomatic complexity, maintainability index, and other metrics"
      frameworks: ["mcp", "openai"]

    - name: "best_practices_validation"
      description: "Validate against language-specific and framework best practices"
      frameworks: ["mcp", "langchain"]

  protocols:
    supported: ["openapi", "mcp", "uadp"]
    primary: "mcp"
    bridges:
      mcp:
        enabled: true
        version: "2024-11-05"
        server_config:
          command: "node"
          args: ["dist/mcp-server.js"]
          env:
            LOG_LEVEL: "info"
            AGENT_TYPE: "analyzer"
        tools:
          - name: "analyze_code"
            description: "Analyze code quality and patterns"
            input_schema:
              type: "object"
              properties:
                code: { type: "string", description: "Source code to analyze" }
                language: { type: "string", description: "Programming language" }
                analysis_type: { type: "string", enum: ["quality", "security", "performance", "all"] }
          - name: "scan_vulnerabilities"
            description: "Scan for security vulnerabilities"
            input_schema:
              type: "object"
              properties:
                codebase_path: { type: "string", description: "Path to codebase" }
                scan_depth: { type: "string", enum: ["surface", "deep", "comprehensive"] }
          - name: "calculate_metrics"
            description: "Calculate code complexity metrics"
            input_schema:
              type: "object"
              properties:
                code: { type: "string" }
                metrics: { type: "array", items: { type: "string" } }
        resources:
          - name: "analysis_rules"
            type: "file"
            path: "./data/analysis-rules.json"
          - name: "security_patterns"
            type: "file"
            path: "./data/security-patterns.json"

      openapi:
        enabled: true
        specification: "./openapi.yaml"
        base_url: "http://localhost:3003/api/v1/agents/analyzer"

  # Resource requirements
  resource_requirements:
    memory: "1Gi"
    cpu: "500m"
    storage: "5Gi"
    network: "1Gbps"

  scaling:
    min_replicas: 1
    max_replicas: 3
    target_cpu: 70
    target_memory: 80

  # Security configuration
  security:
    authentication:
      methods: ["api_key", "jwt"]
      required: true
    authorization:
      model: "rbac"
      roles: ["developer", "security_analyst", "admin"]
    data_classification: "confidential"
    rate_limiting:
      requests_per_minute: 50
      burst_allowance: 10
      per_user_limit: 30
    encryption:
      at_rest: true
      in_transit: "tls_1_3"
    audit_logging: true

  # Performance optimization
  performance:
    token_optimization:
      enabled: true
      target_savings: "35-45%"
      strategies:
        - "context_compression"
        - "result_caching"
        - "pattern_recognition"
        - "incremental_analysis"
    caching:
      enabled: true
      ttl: 1800  # 30 minutes
      levels: ["request", "analysis_result", "metrics"]
    monitoring:
      metrics: true
      tracing: true
      health_checks: true

  # Compliance and governance
  compliance:
    frameworks:
      - "iso-42001"
      - "nist-ai-rmf"
    certification_level: "silver"
    audit_trail: true
    data_governance: true

  # API specification reference
  api:
    specification: "./openapi.yaml"
    base_url: "http://localhost:3003/api/v1/agents/analyzer"
    version: "1.0.0"

  # Context paths for knowledge
  context_paths:
    - path: "./data/analysis-rules.json"
      description: "Code analysis rules and patterns"
      type: "knowledge_base"
    - path: "./data/security-patterns.json"
      description: "Security vulnerability patterns and rules"
      type: "security_knowledge"
    - path: "./data/performance-patterns.json"
      description: "Performance optimization patterns"
      type: "performance_knowledge"

  # Framework configurations
  frameworks:
    mcp:
      enabled: true
      server_type: "claude_code_analyzer"
      tools: ["analyze_code", "scan_vulnerabilities", "calculate_metrics"]
      resources: ["analysis_rules", "security_patterns"]
      streaming: true

    openai:
      enabled: true
      assistant_type: "code_analysis"
      functions: ["analyze_code", "scan_vulnerabilities", "calculate_metrics"]
      model_preferences: ["gpt-4", "gpt-4-turbo"]

    langchain:
      enabled: true
      tool_type: "structured"
      async_support: true
      chains: ["code_analysis", "security_scan"]

  # Monitoring and observability
  monitoring:
    health_check: "/health"
    metrics_endpoint: "/metrics"
    logging_level: "info"
    alerting:
      enabled: true
      channels: ["webhook"]
      thresholds:
        error_rate: 0.05
        response_time: 500
        availability: 0.995

status:
  phase: "ready"
  conditions:
    - type: "ready"
      status: "true"
      last_transition_time: "2025-08-26T20:50:00Z"
    - type: "healthy"
      status: "true"
      last_transition_time: "2025-08-26T20:50:00Z"
  last_updated: "2025-08-26T20:50:00Z"