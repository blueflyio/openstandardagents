{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://openstandardagents.org/schemas/v0.3.3/messaging/message.json",
  "title": "OSSA Message Schema",
  "description": "Schema for Agent-to-Agent messages in OSSA v0.3.3",
  "type": "object",
  "required": [
    "id",
    "channel",
    "sender",
    "timestamp",
    "type",
    "payload"
  ],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique message identifier (UUID v4)",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$",
      "examples": [
        "550e8400-e29b-41d4-a716-446655440000"
      ]
    },
    "channel": {
      "type": "string",
      "description": "Target channel name (supports wildcards for subscriptions)",
      "pattern": "^agents\\.(([a-z0-9-]+|\\*)\\.)+([a-z0-9-]+|#)$",
      "minLength": 3,
      "maxLength": 256,
      "examples": [
        "agents.tasks.assigned",
        "agents.code-reviewer.completed",
        "agents.broadcast.shutdown"
      ]
    },
    "sender": {
      "type": "string",
      "description": "Sender agent ID (OSSA URI format)",
      "pattern": "^ossa://agents/[a-z0-9-]+$",
      "examples": [
        "ossa://agents/task-orchestrator",
        "ossa://agents/code-reviewer"
      ]
    },
    "timestamp": {
      "type": "string",
      "description": "Message creation timestamp (ISO 8601 UTC)",
      "format": "date-time",
      "examples": [
        "2025-12-18T14:32:15.123Z"
      ]
    },
    "type": {
      "type": "string",
      "description": "Message type identifier (PascalCase)",
      "pattern": "^[A-Z][a-zA-Z0-9]*$",
      "minLength": 1,
      "maxLength": 64,
      "examples": [
        "TaskAssigned",
        "TaskCompleted",
        "StatusUpdate",
        "ErrorOccurred"
      ]
    },
    "payload": {
      "type": "object",
      "description": "Message content (structure validated by type schema)",
      "additionalProperties": true,
      "examples": [
        {
          "taskId": "task-001",
          "description": "Review PR #132"
        }
      ]
    },
    "metadata": {
      "$ref": "#/definitions/MessageMetadata",
      "description": "Optional message metadata"
    },
    "qos": {
      "$ref": "#/definitions/QualityOfService",
      "description": "Delivery guarantees (defaults to at-least-once)"
    }
  },
  "additionalProperties": false,
  "definitions": {
    "MessageMetadata": {
      "type": "object",
      "description": "Message metadata for routing and processing",
      "properties": {
        "correlationId": {
          "type": "string",
          "description": "Correlation ID for request-response patterns",
          "minLength": 1,
          "maxLength": 256
        },
        "replyTo": {
          "type": "string",
          "description": "Channel name for response messages",
          "pattern": "^agents\\.([a-z0-9-]+\\.)+[a-z0-9-]+$"
        },
        "priority": {
          "type": "string",
          "enum": ["low", "normal", "high", "critical"],
          "default": "normal",
          "description": "Message priority for routing and processing"
        },
        "ttl": {
          "type": "integer",
          "description": "Time-to-live in seconds (message expires after this duration)",
          "minimum": 1,
          "maximum": 86400
        },
        "contentType": {
          "type": "string",
          "description": "MIME type of payload content",
          "default": "application/json",
          "examples": [
            "application/json",
            "application/xml",
            "text/plain"
          ]
        },
        "contentEncoding": {
          "type": "string",
          "description": "Encoding of payload content",
          "default": "utf-8",
          "examples": [
            "utf-8",
            "base64",
            "gzip"
          ]
        },
        "headers": {
          "type": "object",
          "description": "Custom headers for tracing, authentication, etc.",
          "additionalProperties": {
            "type": "string"
          },
          "examples": [
            {
              "traceparent": "00-4bf92f3577b34da6a3ce929d0e0e4736-00f067aa0ba902b7-01",
              "user-agent": "OSSA/0.3.3"
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "QualityOfService": {
      "type": "object",
      "description": "Message delivery guarantees",
      "properties": {
        "deliveryMode": {
          "type": "string",
          "enum": ["at-most-once", "at-least-once", "exactly-once"],
          "default": "at-least-once",
          "description": "Delivery guarantee level"
        },
        "persistent": {
          "type": "boolean",
          "default": true,
          "description": "Whether message survives broker restarts"
        },
        "ordered": {
          "type": "boolean",
          "default": true,
          "description": "Whether message order is preserved within channel"
        }
      },
      "additionalProperties": false
    }
  },
  "examples": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "channel": "agents.tasks.assigned",
      "sender": "ossa://agents/task-orchestrator",
      "timestamp": "2025-12-18T14:32:15.123Z",
      "type": "TaskAssigned",
      "payload": {
        "taskId": "task-001",
        "assignedTo": "ossa://agents/code-reviewer",
        "description": "Review PR #132",
        "priority": "high",
        "deadline": "2025-12-18T18:00:00Z"
      },
      "metadata": {
        "correlationId": "pr-132",
        "replyTo": "agents.orchestrator.responses",
        "priority": "high",
        "ttl": 3600,
        "headers": {
          "traceparent": "00-4bf92f3577b34da6a3ce929d0e0e4736-00f067aa0ba902b7-01"
        }
      },
      "qos": {
        "deliveryMode": "at-least-once",
        "persistent": true,
        "ordered": true
      }
    }
  ]
}
