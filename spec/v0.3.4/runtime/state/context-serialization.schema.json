{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://openstandardagents.org/schemas/v0.3.4/runtime/state/context-serialization.json",
  "title": "Context Serialization",
  "description": "Standard format for serializing and deserializing agent conversation context for persistence and portability",
  "type": "object",
  "required": ["version", "agent_id", "context"],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Serialization format version"
    },
    "agent_id": {
      "type": "string",
      "format": "uri",
      "pattern": "^agent://[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
      "description": "Agent identifier"
    },
    "session_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique session identifier"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Serialization timestamp"
    },
    "context": {
      "$ref": "#/definitions/Context"
    },
    "metadata": {
      "$ref": "#/definitions/Metadata"
    }
  },
  "definitions": {
    "Context": {
      "type": "object",
      "description": "Complete agent context state",
      "required": ["messages", "state"],
      "properties": {
        "messages": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Message"
          },
          "description": "Conversation message history"
        },
        "state": {
          "$ref": "#/definitions/State"
        },
        "variables": {
          "type": "object",
          "description": "Context variables",
          "additionalProperties": true
        },
        "artifacts": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Artifact"
          },
          "description": "Conversation artifacts (files, images, etc.)"
        },
        "tools_state": {
          "type": "object",
          "description": "State of tools/functions used",
          "additionalProperties": true
        },
        "memory": {
          "$ref": "#/definitions/Memory"
        }
      }
    },
    "Message": {
      "type": "object",
      "required": ["id", "role", "content", "timestamp"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Message identifier"
        },
        "role": {
          "type": "string",
          "enum": ["system", "user", "assistant", "function", "tool"],
          "description": "Message role"
        },
        "content": {
          "type": "string",
          "description": "Message content"
        },
        "name": {
          "type": "string",
          "description": "Agent or function name"
        },
        "function_call": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "arguments": {
              "type": "string"
            }
          },
          "description": "Function call metadata"
        },
        "tool_calls": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "type": {
                "type": "string"
              },
              "function": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "arguments": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "description": "Tool calls in message"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Message timestamp"
        },
        "metadata": {
          "type": "object",
          "description": "Additional message metadata",
          "additionalProperties": true
        }
      }
    },
    "State": {
      "type": "object",
      "description": "Agent runtime state",
      "properties": {
        "phase": {
          "type": "string",
          "description": "Current execution phase",
          "examples": ["planning", "executing", "reviewing", "completed"]
        },
        "step": {
          "type": "integer",
          "minimum": 0,
          "description": "Current step number"
        },
        "status": {
          "type": "string",
          "enum": ["active", "paused", "waiting", "completed", "failed"],
          "description": "Agent status"
        },
        "current_task": {
          "type": "string",
          "description": "Current task description"
        },
        "pending_tasks": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Queue of pending tasks"
        },
        "completed_tasks": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of completed tasks"
        },
        "errors": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              },
              "timestamp": {
                "type": "string",
                "format": "date-time"
              }
            }
          },
          "description": "Error history"
        },
        "metrics": {
          "$ref": "#/definitions/Metrics"
        },
        "custom_state": {
          "type": "object",
          "description": "Agent-specific state",
          "additionalProperties": true
        }
      }
    },
    "Artifact": {
      "type": "object",
      "required": ["id", "type", "uri"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Artifact identifier"
        },
        "type": {
          "type": "string",
          "enum": ["file", "image", "document", "code", "data", "url"],
          "description": "Artifact type"
        },
        "uri": {
          "type": "string",
          "format": "uri",
          "description": "Artifact location"
        },
        "mime_type": {
          "type": "string",
          "description": "MIME type"
        },
        "size_bytes": {
          "type": "integer",
          "minimum": 0,
          "description": "Size in bytes"
        },
        "checksum": {
          "type": "string",
          "description": "Artifact checksum (SHA-256)"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Creation timestamp"
        },
        "metadata": {
          "type": "object",
          "description": "Artifact metadata",
          "additionalProperties": true
        }
      }
    },
    "Memory": {
      "type": "object",
      "description": "Agent memory state",
      "properties": {
        "short_term": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/MemoryItem"
          },
          "description": "Short-term working memory"
        },
        "long_term": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/MemoryItem"
          },
          "description": "Long-term persistent memory"
        },
        "episodic": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/MemoryItem"
          },
          "description": "Episodic memory (past experiences)"
        },
        "semantic": {
          "type": "object",
          "description": "Semantic memory (facts and knowledge)",
          "additionalProperties": true
        },
        "procedural": {
          "type": "object",
          "description": "Procedural memory (how to do things)",
          "additionalProperties": true
        }
      }
    },
    "MemoryItem": {
      "type": "object",
      "required": ["id", "content", "timestamp"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Memory item identifier"
        },
        "content": {
          "type": "string",
          "description": "Memory content"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When memory was created"
        },
        "importance": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Importance score (0-1)"
        },
        "access_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of times accessed"
        },
        "last_accessed": {
          "type": "string",
          "format": "date-time",
          "description": "Last access timestamp"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Memory tags for retrieval"
        },
        "embedding": {
          "type": "array",
          "items": {
            "type": "number"
          },
          "description": "Vector embedding for semantic search"
        }
      }
    },
    "Metrics": {
      "type": "object",
      "description": "Execution metrics",
      "properties": {
        "total_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Total tokens used"
        },
        "prompt_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Prompt tokens used"
        },
        "completion_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Completion tokens used"
        },
        "total_cost": {
          "type": "number",
          "minimum": 0,
          "description": "Total cost in USD"
        },
        "execution_time_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Total execution time"
        },
        "tool_calls": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of tool calls"
        },
        "api_calls": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of API calls"
        }
      }
    },
    "Metadata": {
      "type": "object",
      "description": "Serialization metadata",
      "properties": {
        "format": {
          "type": "string",
          "enum": ["json", "msgpack", "protobuf"],
          "default": "json",
          "description": "Serialization format"
        },
        "compression": {
          "type": "string",
          "enum": ["none", "gzip", "brotli"],
          "default": "none",
          "description": "Compression method"
        },
        "encryption": {
          "type": "boolean",
          "default": false,
          "description": "Whether data is encrypted"
        },
        "size_bytes": {
          "type": "integer",
          "minimum": 0,
          "description": "Serialized size in bytes"
        },
        "checksum": {
          "type": "string",
          "description": "Checksum for integrity verification"
        },
        "runtime": {
          "type": "string",
          "description": "Runtime that created this serialization",
          "examples": ["ag2", "autogen", "langchain", "crewai"]
        },
        "runtime_version": {
          "type": "string",
          "description": "Runtime version"
        }
      }
    }
  }
}
