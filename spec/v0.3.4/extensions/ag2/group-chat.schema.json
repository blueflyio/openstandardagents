{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://openstandardagents.org/schemas/v0.3.4/extensions/ag2/group-chat.json",
  "title": "AG2 Group Chat Extension",
  "description": "AG2 (AutoGen) group chat configuration for multi-agent conversations and collaborative problem solving",
  "type": "object",
  "required": ["participants", "manager"],
  "properties": {
    "participants": {
      "type": "array",
      "minItems": 2,
      "items": {
        "type": "string",
        "format": "uri",
        "pattern": "^agent://[a-z0-9]([-a-z0-9]*[a-z0-9])?$"
      },
      "description": "Agent URIs participating in group chat"
    },
    "manager": {
      "type": "string",
      "format": "uri",
      "pattern": "^agent://[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
      "description": "Group chat manager agent URI (orchestrates conversation)"
    },
    "max_round": {
      "type": "integer",
      "minimum": 1,
      "maximum": 100,
      "default": 10,
      "description": "Maximum number of conversation rounds"
    },
    "admin_name": {
      "type": "string",
      "default": "Admin",
      "description": "Name of admin agent (for human-in-the-loop)"
    },
    "messages": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Message"
      },
      "description": "Initial message history"
    },
    "speaker_selection_method": {
      "type": "string",
      "enum": [
        "auto",
        "manual",
        "round_robin",
        "random"
      ],
      "default": "auto",
      "description": "How next speaker is selected"
    },
    "allow_repeat_speaker": {
      "type": "boolean",
      "default": true,
      "description": "Whether same agent can speak consecutively"
    },
    "select_speaker_message_template": {
      "type": "string",
      "description": "Template for speaker selection prompt (used in auto mode)"
    },
    "select_speaker_prompt_template": {
      "type": "string",
      "description": "Prompt template for LLM-based speaker selection"
    },
    "select_speaker_auto_llm_config": {
      "type": "object",
      "description": "LLM config for automatic speaker selection",
      "additionalProperties": true
    },
    "select_speaker_auto_verbose": {
      "type": "boolean",
      "default": false,
      "description": "Verbose logging for speaker selection"
    },
    "transitions": {
      "type": "object",
      "description": "Allowed speaker transitions (graph-based flow control)",
      "additionalProperties": {
        "type": "array",
        "items": {
          "type": "string"
        }
      },
      "examples": [
        {
          "agent://planner": ["agent://coder", "agent://reviewer"],
          "agent://coder": ["agent://reviewer", "agent://tester"],
          "agent://reviewer": ["agent://coder", "agent://approver"]
        }
      ]
    },
    "enable_clear_history": {
      "type": "boolean",
      "default": false,
      "description": "Whether to allow clearing conversation history"
    },
    "send_introductions": {
      "type": "boolean",
      "default": false,
      "description": "Send introduction messages at start"
    },
    "conversation_termination": {
      "$ref": "#/definitions/ConversationTermination"
    },
    "context_variables": {
      "type": "object",
      "description": "Shared context variables accessible by all participants",
      "additionalProperties": true
    },
    "summary_method": {
      "type": "string",
      "enum": ["last_msg", "reflection_with_llm", "custom"],
      "default": "last_msg",
      "description": "How to generate conversation summary"
    },
    "summary_prompt": {
      "type": "string",
      "description": "Custom prompt for LLM-based summary generation"
    }
  },
  "definitions": {
    "Message": {
      "type": "object",
      "required": ["role", "content"],
      "properties": {
        "role": {
          "type": "string",
          "enum": ["system", "user", "assistant", "function"],
          "description": "Message role"
        },
        "content": {
          "type": "string",
          "description": "Message content"
        },
        "name": {
          "type": "string",
          "description": "Agent name who sent message"
        },
        "function_call": {
          "type": "object",
          "description": "Function call metadata",
          "properties": {
            "name": {
              "type": "string"
            },
            "arguments": {
              "type": "string"
            }
          }
        },
        "metadata": {
          "type": "object",
          "description": "Additional message metadata",
          "additionalProperties": true
        }
      }
    },
    "ConversationTermination": {
      "type": "object",
      "description": "Conditions for terminating group conversation",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "max_rounds",
            "keyword",
            "function_result",
            "timeout",
            "consensus",
            "custom"
          ],
          "description": "Termination trigger type"
        },
        "max_rounds": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum conversation rounds"
        },
        "keyword": {
          "type": "string",
          "description": "Termination keyword or phrase"
        },
        "timeout_ms": {
          "type": "integer",
          "minimum": 1000,
          "description": "Maximum conversation duration"
        },
        "consensus_threshold": {
          "type": "number",
          "minimum": 0.5,
          "maximum": 1.0,
          "description": "Required agreement fraction for consensus termination"
        },
        "custom_function": {
          "type": "string",
          "description": "Custom termination function name"
        },
        "silent_termination": {
          "type": "boolean",
          "default": false,
          "description": "Whether to terminate silently without message"
        }
      }
    }
  }
}
