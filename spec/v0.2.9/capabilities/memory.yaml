# OSSA Memory Capabilities v0.2.9
# Agent intelligence and context retrieval

capabilities:
  - uri: "ossa:memory/semantic_search@1.0"
    name: "semantic_search"
    domain: "memory"
    version: "1.0.0"
    stability: "stable"

    description: |
      Perform semantic search across vector collections using embeddings.
      Supports codebase, issues, documentation, and workflow patterns.

    input:
      type: object
      required:
        - query
        - collection
      properties:
        query:
          type: string
          description: "Natural language query"
        collection:
          type: string
          enum:
            - codebase-embeddings
            - issue-embeddings
            - documentation-embeddings
            - workflow-patterns
        topK:
          type: integer
          default: 10
        scoreThreshold:
          type: number
          default: 0.7
        filter:
          type: object
          description: "Payload filters for narrowing results"

    output:
      type: object
      properties:
        results:
          type: array
          items:
            type: object
            properties:
              id: { type: string }
              score: { type: number }
              payload: { type: object }
        search_latency_ms:
          type: integer

    bindings:
      mcp:
        server: "agent-brain"
        tool: "semantic_search"

  - uri: "ossa:memory/kg_query@1.0"
    name: "kg_query"
    domain: "memory"
    version: "1.0.0"
    stability: "stable"

    description: |
      Query the knowledge graph for entity relationships and context.
      Supports entity lookup, relation traversal, and type queries.

    input:
      type: object
      required:
        - operation
      properties:
        operation:
          type: string
          enum:
            - get_entity
            - get_relations
            - query_type
            - traverse
        entityId:
          type: string
        entityType:
          type: string
        relationType:
          type: string
        maxDepth:
          type: integer
          default: 3

    output:
      type: object
      properties:
        entities:
          type: array
          items:
            $ref: "#/definitions/Entity"
        relations:
          type: array
          items:
            $ref: "#/definitions/Relation"

    bindings:
      mcp:
        server: "agent-brain"
        tool: "kg_query"

  - uri: "ossa:memory/context_fusion@1.0"
    name: "context_fusion"
    domain: "memory"
    version: "1.0.0"
    stability: "stable"

    description: |
      Fuse multiple knowledge sources into coherent context for agent injection.
      Combines Qdrant vectors, knowledge graph, and MLflow predictions.

    input:
      type: object
      required:
        - query
      properties:
        query:
          type: string
          description: "User query or task description"
        sources:
          type: array
          items:
            type: string
            enum:
              - codebase
              - issues
              - documentation
              - knowledge_graph
              - workflow_patterns
          default:
            - codebase
            - issues
            - knowledge_graph
        maxTokens:
          type: integer
          default: 8192
        rerank:
          type: boolean
          default: true
        format:
          type: string
          enum: [markdown, json, xml]
          default: markdown

    output:
      type: object
      properties:
        context:
          type: string
          description: "Fused context ready for injection"
        sources_used:
          type: array
          items:
            type: object
            properties:
              name: { type: string }
              relevance_score: { type: number }
              tokens_contributed: { type: integer }
        total_tokens:
          type: integer
        fusion_latency_ms:
          type: integer

    bindings:
      mcp:
        server: "agent-brain"
        tool: "fuse_context"
      grpc:
        service: "AgentBrainService"
        method: "FuseContext"
        port: 50051

  - uri: "ossa:ml/predict@1.0"
    name: "predict"
    domain: "ml"
    version: "1.0.0"
    stability: "stable"

    description: |
      Get predictions from MLflow-served models.
      Supports domain-specific models for routing and intelligence.

    input:
      type: object
      required:
        - input
      properties:
        model:
          type: string
          enum:
            - agent-studio
            - civicpolicy
            - gov-rfp
            - llm-platform
        input:
          type: object
          description: "Model-specific input payload"
        autoSelect:
          type: boolean
          default: false
          description: "Auto-select model based on task"
        taskDescription:
          type: string
          description: "Task description for auto-selection"

    output:
      type: object
      properties:
        output:
          description: "Model prediction output"
        confidence:
          type: number
        model:
          type: string
        latency_ms:
          type: integer
        cached:
          type: boolean

    bindings:
      mcp:
        server: "agent-router"
        tool: "mlflow_predict"

definitions:
  Entity:
    type: object
    properties:
      id: { type: string }
      type: { type: string }
      name: { type: string }
      observations:
        type: array
        items: { type: string }
      metadata: { type: object }

  Relation:
    type: object
    properties:
      from: { type: string }
      to: { type: string }
      type: { type: string }
      weight: { type: number }
      metadata: { type: object }
