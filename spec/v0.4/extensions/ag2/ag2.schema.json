{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://openstandardagents.org/schemas/v0.3.5/extensions/ag2/ag2.json",
  "title": "AG2 (AutoGen) Extension",
  "description": "Native integration with Microsoft AG2 (AutoGen) for multi-agent conversations, group chats, nested chats, and swarm topologies.",
  "type": "object",
  "properties": {
    "enabled": {
      "type": "boolean",
      "default": true,
      "description": "Enable AG2 integration"
    },
    "pattern": {
      "type": "string",
      "enum": ["group_chat", "nested_chat", "swarm", "sequential", "two_agent"],
      "description": "AG2 conversation pattern"
    },
    "group_chat": {
      "$ref": "#/definitions/GroupChatConfig",
      "description": "Group chat configuration"
    },
    "nested_chat": {
      "$ref": "#/definitions/NestedChatConfig",
      "description": "Nested chat configuration"
    },
    "swarm": {
      "$ref": "#/definitions/SwarmConfig",
      "description": "Swarm topology configuration"
    },
    "code_execution": {
      "$ref": "#/definitions/CodeExecutionConfig",
      "description": "Code execution configuration"
    },
    "human_input_mode": {
      "type": "string",
      "enum": ["ALWAYS", "NEVER", "TERMINATE"],
      "default": "NEVER",
      "description": "When to request human input"
    },
    "max_consecutive_auto_reply": {
      "type": "integer",
      "minimum": 0,
      "description": "Maximum consecutive auto-replies"
    }
  },
  "additionalProperties": false,
  "definitions": {
    "GroupChatConfig": {
      "type": "object",
      "description": "Group chat configuration",
      "required": ["participants", "manager"],
      "properties": {
        "participants": {
          "type": "array",
          "minItems": 2,
          "items": {
            "type": "string",
            "pattern": "^@[a-z0-9-]+$"
          },
          "description": "Agent IDs participating in group chat"
        },
        "manager": {
          "type": "string",
          "pattern": "^@[a-z0-9-]+$",
          "description": "Group chat manager agent ID"
        },
        "max_round": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 10,
          "description": "Maximum conversation rounds"
        },
        "speaker_selection_method": {
          "type": "string",
          "enum": ["auto", "manual", "round_robin", "random"],
          "default": "auto",
          "description": "Speaker selection method"
        },
        "allow_repeat_speaker": {
          "type": "boolean",
          "default": true,
          "description": "Allow same agent to speak consecutively"
        },
        "transitions": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "description": "Allowed speaker transitions"
        },
        "enable_clear_history": {
          "type": "boolean",
          "default": false,
          "description": "Allow clearing conversation history"
        }
      },
      "additionalProperties": false
    },
    "NestedChatConfig": {
      "type": "object",
      "description": "Nested chat configuration",
      "required": ["triggers"],
      "properties": {
        "triggers": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/NestedChatTrigger"
          },
          "description": "Nested chat triggers"
        },
        "max_depth": {
          "type": "integer",
          "minimum": 1,
          "default": 3,
          "description": "Maximum nesting depth"
        }
      },
      "additionalProperties": false
    },
    "NestedChatTrigger": {
      "type": "object",
      "description": "Nested chat trigger",
      "required": ["condition", "chat_queue"],
      "properties": {
        "condition": {
          "type": "string",
          "description": "Trigger condition (function or expression)"
        },
        "chat_queue": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["recipient", "message"],
            "properties": {
              "recipient": {
                "type": "string",
                "pattern": "^@[a-z0-9-]+$",
                "description": "Recipient agent ID"
              },
              "message": {
                "type": "string",
                "description": "Message to send"
              },
              "summary_method": {
                "type": "string",
                "enum": ["last_msg", "reflection_with_llm"],
                "default": "last_msg"
              }
            }
          },
          "description": "Chat queue for nested conversation"
        }
      },
      "additionalProperties": false
    },
    "SwarmConfig": {
      "type": "object",
      "description": "Swarm topology configuration",
      "required": ["agents", "handoffs"],
      "properties": {
        "agents": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/SwarmAgent"
          },
          "description": "Swarm agents"
        },
        "handoffs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/SwarmHandoff"
          },
          "description": "Agent handoff rules"
        },
        "update_agent_state_before_reply": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "description": "State update functions"
        }
      },
      "additionalProperties": false
    },
    "SwarmAgent": {
      "type": "object",
      "description": "Swarm agent definition",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^@[a-z0-9-]+$",
          "description": "Agent ID"
        },
        "name": {
          "type": "string",
          "description": "Agent name"
        },
        "system_message": {
          "type": "string",
          "description": "Agent system message"
        },
        "functions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Available functions"
        }
      },
      "additionalProperties": false
    },
    "SwarmHandoff": {
      "type": "object",
      "description": "Swarm handoff rule",
      "required": ["from", "to", "condition"],
      "properties": {
        "from": {
          "type": "string",
          "pattern": "^@[a-z0-9-]+$",
          "description": "Source agent ID"
        },
        "to": {
          "type": "string",
          "pattern": "^@[a-z0-9-]+$",
          "description": "Target agent ID"
        },
        "condition": {
          "type": "string",
          "description": "Handoff condition"
        },
        "available": {
          "type": "string",
          "description": "Availability condition"
        }
      },
      "additionalProperties": false
    },
    "CodeExecutionConfig": {
      "type": "object",
      "description": "Code execution configuration",
      "properties": {
        "work_dir": {
          "type": "string",
          "description": "Working directory for code execution"
        },
        "use_docker": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "type": "string"
            }
          ],
          "description": "Use Docker for code execution (bool or image name)"
        },
        "timeout": {
          "type": "integer",
          "minimum": 1,
          "default": 60,
          "description": "Code execution timeout in seconds"
        },
        "last_n_messages": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of recent messages to include in code execution context"
        }
      },
      "additionalProperties": false
    }
  }
}
