# OSSA v0.3.3 First-Class Citizen Agent Template
# Reference implementation for agents with full first-class citizenship features
# 
# This template demonstrates all OSSA v0.3.3 first-class citizen capabilities:
# - Comprehensive identity with OpenTelemetry service identity
# - Resource governance (cost, performance, resource constraints)
# - Execution profiles for A/B testing
# - Compliance profiles (SOC2, GDPR, FedRAMP, HIPAA)
# - Enhanced observability with SLOs, alerting, custom metrics
# - Enhanced A2A messaging with full reliability (retry, DLQ)
# - DORA tracking for deployment metrics
# - Token rotation and security policies
#
# Reference: @bluefly/openstandardagents v0.3.3
# Location: This file should be moved to OssA/openstandardagents/spec/v0.3.3/examples/

identity:
  provider: gitlab
  service_account:
    id: ${GITLAB_SERVICE_ACCOUNT_ID}
    username: ${SERVICE_ACCOUNT_USERNAME}
    email: ${SERVICE_ACCOUNT_EMAIL}
    display_name: ${AGENT_DISPLAY_NAME}
    roles: [maintainer]
  authentication:
    method: project_access_token
    scopes:
    - api
    - read_repository
    - write_repository
    auto_refresh: true
    expiry_warning_days: 7
    rotation_policy:
      enabled: true
      interval_days: 90
      notify_on_rotation: true
  token_source:
    env_var: ${TOKEN_ENV_VAR}
    fallback:
      vault:
        path: secret/agents/${AGENT_NAME}
        key: gitlab_token
  observability:
    service_name: ${AGENT_NAME}
    service_namespace: agents.${DOMAIN}
    service_version: 1.0.0
    service_instance_id: ${AGENT_INSTANCE_ID:-auto}
    resource_attributes:
      deployment.environment: ${ENVIRONMENT:-production}
      service.team: platform
      service.domain: ${DOMAIN}
  dora_tracking:
    enabled: true
    metrics:
    - deployment_frequency
    - lead_time
    - change_failure_rate
    - mttr
    labels:
      team: platform
      domain: ${DOMAIN}
  security:
    token_encryption: both
    minimum_token_length: 32
    rate_limits:
      requests_per_minute: 60
      requests_per_hour: 2000
      git_operations_per_hour: 100

llm:
  profile: ${AGENT_PROFILE:-balanced}
  execution_profiles:
    default: balanced
    profiles:
      fast:
        maxTokens: 4000
        temperature: 0.2
        reasoning_enabled: false
        description: Quick operations
      balanced:
        maxTokens: 8192
        temperature: 0.3
        reasoning_enabled: true
        description: Default production profile
      deep:
        maxTokens: 16384
        temperature: 0.4
        reasoning_enabled: true
        validation_required: true
        audit_log: true
        description: Deep analysis
  fallback:
    provider: openai
    model: gpt-4o
    trigger:
      on_error: true
      max_retries: 2
      latency_threshold_ms: 10000
  retry:
    max_attempts: 3
    backoff_strategy: exponential
    initial_delay_ms: 1000
    max_delay_ms: 30000
  cost_tracking:
    enabled: true
    budget_alert_threshold: ${BUDGET_ALERT}
    budget_limit_usd: ${BUDGET_LIMIT}
    cost_allocation_tags:
      team: platform
      project: ${PROJECT}
      agent: ${AGENT_NAME}
      cost_center: engineering

constraints:
  cost:
    maxTokensPerDay: ${MAX_TOKENS_PER_DAY}
    maxTokensPerRequest: 16384
    maxCostPerDay: ${MAX_COST_PER_DAY}
    currency: USD
  performance:
    maxLatencySeconds: ${MAX_LATENCY}
    maxConcurrentRequests: ${MAX_CONCURRENT}
    timeoutSeconds: ${TIMEOUT}
  resources:
    cpu: ${CPU}
    memory: ${MEMORY}

observability:
  tracing:
    enabled: true
    exporter: otlp
    endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:-http://jaeger-collector:4317}
  metrics:
    enabled: true
    exporter: prometheus
    endpoint: ${PROMETHEUS_ENDPOINT:-http://prometheus:9090}
    port: ${METRICS_PORT}
  logging:
    level: info
    format: json
    structured: true
    include_stack_traces: true
  alerting:
    enabled: true
    channels:
    - slack://#${SLACK_CHANNEL}
    - gitlab://@platform-team
    rules:
    - name: high_error_rate
      condition: error_rate > 0.05
      severity: warning
    - name: latency_degraded
      condition: p95_latency_ms > ${LATENCY_THRESHOLD}
      severity: warning
  slo:
    availability: 0.999
    latency_p95_ms: ${SLO_LATENCY}
    error_budget: 0.001
    targets:
      - name: operation_latency
        target_p95_ms: ${TARGET_LATENCY}
      - name: success_rate
        target_success_rate: 0.95

compliance:
  frameworks:
  - SOC2
  - GDPR
  data_residency: us-east-1
  audit_logging: required
  pii_handling: encrypt_at_rest

messaging:
  reliability:
    deliveryGuarantee: at-least-once
    retry:
      maxAttempts: 3
      backoff:
        strategy: exponential
        initialDelayMs: 1000
        maxDelayMs: 30000
        multiplier: 2
    dlq:
      enabled: true
      channel: ${DOMAIN}.messages.dlq
      retentionDays: 7
