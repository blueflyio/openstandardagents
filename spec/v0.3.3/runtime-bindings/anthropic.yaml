# Anthropic Runtime Binding
# OSSA v0.3.0 Runtime Binding for Anthropic Claude

apiVersion: ossa/v0.3.0
kind: RuntimeBinding
metadata:
  name: anthropic
  version: "1.0.0"
  description: Runtime binding for Anthropic Claude models
  labels:
    provider: anthropic
    category: llm
    tier: enterprise

spec:
  # Provider identification
  provider: anthropic
  apiVersion: "2024-01-01"
  
  # Default model configuration
  defaultModel: claude-3-5-sonnet-20241022
  
  # Supported models with pricing and capabilities
  models:
    - id: claude-opus-4-5-20251101
      name: Claude Opus 4.5
      contextWindow: 200000
      maxOutput: 8192
      pricing:
        input: 15.0    # per 1M tokens
        output: 75.0   # per 1M tokens
      capabilities:
        - tool_use
        - vision
        - extended_thinking
        - streaming
      tier: enterprise
      
    - id: claude-sonnet-4-20250514
      name: Claude Sonnet 4
      contextWindow: 200000
      maxOutput: 8192
      pricing:
        input: 3.0
        output: 15.0
      capabilities:
        - tool_use
        - vision
        - streaming
      tier: standard
      
    - id: claude-3-5-sonnet-20241022
      name: Claude 3.5 Sonnet
      contextWindow: 200000
      maxOutput: 8192
      pricing:
        input: 3.0
        output: 15.0
      capabilities:
        - tool_use
        - vision
        - streaming
      tier: standard
      recommended: true
      
    - id: claude-3-5-haiku-20241022
      name: Claude 3.5 Haiku
      contextWindow: 200000
      maxOutput: 8192
      pricing:
        input: 0.8
        output: 4.0
      capabilities:
        - tool_use
        - streaming
      tier: economy
      
    - id: claude-3-opus-20240229
      name: Claude 3 Opus
      contextWindow: 200000
      maxOutput: 4096
      pricing:
        input: 15.0
        output: 75.0
      capabilities:
        - tool_use
        - vision
        - streaming
      tier: enterprise
      
    - id: claude-3-sonnet-20240229
      name: Claude 3 Sonnet
      contextWindow: 200000
      maxOutput: 4096
      pricing:
        input: 3.0
        output: 15.0
      capabilities:
        - tool_use
        - vision
        - streaming
      tier: standard
      deprecated: true
      
    - id: claude-3-haiku-20240307
      name: Claude 3 Haiku
      contextWindow: 200000
      maxOutput: 4096
      pricing:
        input: 0.25
        output: 1.25
      capabilities:
        - tool_use
        - streaming
      tier: economy

  # Capability mapping configuration
  capabilityMapping:
    # How OSSA tools map to Anthropic format
    toolFormat: tool_use
    
    # Tool input schema mapping
    toolSchema:
      wrapper: null  # Anthropic uses inline schema
      inputKey: input_schema
      outputKey: null  # Not supported
      
    # Message format mapping
    messageFormat:
      systemPrompt: separate  # System prompt is a separate parameter
      userRole: user
      assistantRole: assistant
      toolResultRole: user  # Tool results sent as user messages
      
    # Content block mapping
    contentBlocks:
      text: text
      image: image
      toolUse: tool_use
      toolResult: tool_result
      
    # Structured output support
    structuredOutput: true
    
    # Streaming support
    streaming: true
    
    # Vision/multimodal support
    vision: true

  # Rate limiting defaults
  rateLimits:
    requestsPerMinute: 1000
    tokensPerMinute: 400000
    tokensPerDay: 10000000

  # Authentication configuration
  authentication:
    type: api_key
    headerName: x-api-key
    envVariable: ANTHROPIC_API_KEY

  # Endpoint configuration
  endpoints:
    messages: https://api.anthropic.com/v1/messages
    
  # Request configuration
  requestConfig:
    timeout: 120000  # 2 minutes
    retries: 3
    retryDelay: 1000
    retryBackoff: exponential

  # Extension configuration
  extensions:
    # Anthropic-specific OSSA extension
    anthropic:
      description: Anthropic-specific configuration options
      schema:
        type: object
        properties:
          model:
            type: string
            description: Override model from manifest
          system:
            type: string
            description: Custom system prompt
          max_tokens:
            type: integer
            description: Maximum tokens to generate
          temperature:
            type: number
            minimum: 0
            maximum: 1
          stop_sequences:
            type: array
            items:
              type: string
            description: Custom stop sequences
          top_p:
            type: number
            minimum: 0
            maximum: 1
          top_k:
            type: integer
            minimum: 1
          tools:
            type: array
            description: Additional Anthropic-native tools
