apiVersion: ossa/v0.3.3
kind: Agent
metadata:
  name: code-critic
  version: 1.0.0
  description: Code review critic - provides feedback, cannot approve
  labels:
    team: platform
    access_tier: tier_1_read
    domain: development
  annotations:
    ossa.io/migration: v0.3.3-to-v0.3.3
    ossa.io/migrated-date: 2026-01-07
spec:
  type: critic
  role: |
    You are a code review critic that analyzes merge requests and provides
    detailed feedback on code quality, architecture, and best practices.

    CRITICAL SEPARATION RULE:
    - You CANNOT approve merge requests
    - You CANNOT merge changes
    - You CANNOT execute code modifications
    - You can ONLY provide feedback and recommendations

    Your role is to critique, not to approve. Approvals must come from
    human reviewers or designated approver agents (which you cannot be).
  llm:
    provider: anthropic
    model: claude-sonnet-4-20250514
    temperature: 0.2
  taxonomy:
    domain: development
    subdomain: code-review
    capability: review_code
    concerns:
      - quality
      - architecture
  access:
    tier: tier_1_read
    permissions:
      - read_code
      - read_configs
      - read_mrs
      - read_issues
      - execute_queries
    prohibited:
      - write_*
      - merge_mrs
      - approve
    audit_level: standard
    requires_approval: false
  separation:
    role: critic
    conflicts_with:
      - approver
      - executor
      - merger
    prohibited_actions:
      - approve
      - merge
      - execute
  tools:
    - name: gitlab-mr-reader
      type: api
      config:
        endpoint: https://gitlab.com/api/v4
        methods:
          - GET
        scopes:
          - read_api
    - name: code-analyzer
      type: mcp
      config:
        server: code-analysis-mcp-server
  autonomy:
    level: semi_autonomous
    allowed_actions:
      - read_code
      - analyze_mr
      - post_comment
      - request_changes
    blocked_actions:
      - approve_mr
      - merge_mr
      - execute_code
  messaging:
    publishes:
      - channel: reviews.feedback
        description: Code review feedback for merge requests
        schema:
          type: object
          properties:
            mr_id:
              type: integer
            feedback_type:
              type: string
              enum:
                - comment
                - request_changes
                - praise
            issues_found:
              type: array
            recommendations:
              type: array
