{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://openstandardagents.org/schemas/v0.3.5/registry/registry-contract.json",
  "title": "OSSA Agent Registry Contract",
  "description": "Contract schema for OSSA agent registry - enables discovery, publishing, and validation of agents",
  "type": "object",
  "properties": {
    "registry_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "Registry contract version"
    },
    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "Last update timestamp (ISO 8601)"
    },
    "agents": {
      "type": "array",
      "description": "List of registered agents",
      "items": {
        "$ref": "#/definitions/AgentEntry"
      }
    }
  },
  "required": ["registry_version", "last_updated", "agents"],
  "additionalProperties": false,
  "definitions": {
    "AgentEntry": {
      "type": "object",
      "description": "Agent registry entry",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9][a-z0-9-]*[a-z0-9]$",
          "description": "Unique agent identifier (DNS-1123 subdomain)"
        },
        "name": {
          "type": "string",
          "description": "Human-readable agent name"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+(-[a-zA-Z0-9]+)?$",
          "description": "Agent version (semver)"
        },
        "description": {
          "type": "string",
          "description": "Agent description"
        },
        "license": {
          "type": "string",
          "enum": ["Apache-2.0", "MIT", "BSD-3-Clause", "GPL-3.0", "Proprietary"],
          "description": "License type"
        },
        "frameworks": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["langchain", "langgraph", "autogen", "crewai", "openai", "anthropic", "kagent", "mcp", "a2a"]
          },
          "description": "Supported frameworks"
        },
        "capabilities": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Agent capabilities (from OSSA taxonomy)"
        },
        "artifacts": {
          "$ref": "#/definitions/Artifacts",
          "description": "Bundle artifacts with checksums and metadata"
        },
        "security_posture": {
          "$ref": "#/definitions/SecurityPosture",
          "description": "Security and compliance posture"
        },
        "entrypoints": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Entrypoint"
          },
          "description": "Agent entrypoints (CLI, API, webhook, etc.)"
        },
        "signing": {
          "$ref": "#/definitions/Signing",
          "description": "Cryptographic signing metadata (optional)"
        },
        "sbom_sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA256 checksum of agent bundle SBOM (deprecated - use artifacts.sbom.sha256)"
        },
        "schema_version": {
          "type": "string",
          "pattern": "^0\\.3\\.[4-9]|^0\\.3\\.[0-9]+(-[a-zA-Z0-9]+)?$",
          "description": "OSSA schema version"
        },
        "compat_matrix": {
          "$ref": "#/definitions/CompatibilityMatrix",
          "description": "Compatibility matrix"
        },
        "manifest_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to agent manifest (OSSA YAML)"
        },
        "bundle_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to agent bundle (tarball)"
        },
        "git_url": {
          "type": "string",
          "format": "uri",
          "description": "Git repository URL"
        },
        "published_at": {
          "type": "string",
          "format": "date-time",
          "description": "Publication timestamp"
        },
        "published_by": {
          "type": "string",
          "description": "Publisher identifier (GitHub username, GitLab username, etc.)"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Searchable tags"
        }
      },
      "required": ["id", "name", "version", "schema_version", "manifest_url"],
      "additionalProperties": false
    },
    "SecurityPosture": {
      "type": "object",
      "description": "Security and compliance posture",
      "properties": {
        "compliance_level": {
          "type": "string",
          "enum": ["baseline", "enterprise", "fedramp", "hipaa", "soc2"],
          "description": "Compliance level"
        },
        "audit_logging": {
          "type": "boolean",
          "description": "Audit logging enabled"
        },
        "encryption_at_rest": {
          "type": "boolean",
          "description": "Encryption at rest"
        },
        "encryption_in_transit": {
          "type": "boolean",
          "description": "Encryption in transit"
        },
        "network": {
          "type": "object",
          "properties": {
            "egress": {
              "type": "boolean",
              "description": "Requires network egress (outbound connections)"
            },
            "ingress": {
              "type": "boolean",
              "description": "Requires network ingress (inbound connections)"
            }
          },
          "description": "Network requirements"
        },
        "secrets": {
          "type": "object",
          "properties": {
            "required": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "List of required secret names/keys"
            }
          },
          "description": "Secret requirements"
        },
        "tools": {
          "type": "object",
          "properties": {
            "exec": {
              "type": "boolean",
              "description": "Requires command execution capabilities"
            },
            "file_system": {
              "type": "boolean",
              "description": "Requires file system access"
            }
          },
          "description": "Tool/capability requirements"
        },
        "k8s": {
          "type": "object",
          "properties": {
            "rbac_summary": {
              "type": "string",
              "description": "Summary of required Kubernetes RBAC permissions"
            }
          },
          "description": "Kubernetes-specific security requirements"
        },
        "vulnerability_scan": {
          "type": "object",
          "properties": {
            "last_scan": {
              "type": "string",
              "format": "date-time"
            },
            "critical": {
              "type": "integer",
              "minimum": 0
            },
            "high": {
              "type": "integer",
              "minimum": 0
            },
            "medium": {
              "type": "integer",
              "minimum": 0
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "CompatibilityMatrix": {
      "type": "object",
      "description": "Compatibility matrix",
      "properties": {
        "frameworks": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Framework version compatibility"
        },
        "runtimes": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["node", "python", "kubernetes", "docker", "serverless"]
          },
          "description": "Supported runtimes"
        },
        "os": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["linux", "darwin", "windows"]
          },
          "description": "Supported operating systems"
        }
      },
      "additionalProperties": false
    },
    "Artifacts": {
      "type": "object",
      "description": "Bundle artifacts with checksums and metadata",
      "properties": {
        "bundle": {
          "type": "object",
          "properties": {
            "sha256": {
              "type": "string",
              "pattern": "^[a-f0-9]{64}$",
              "description": "SHA256 checksum of bundle tarball"
            },
            "size": {
              "type": "integer",
              "minimum": 0,
              "description": "Bundle size in bytes"
            }
          },
          "required": ["sha256"],
          "additionalProperties": false
        },
        "sbom": {
          "type": "object",
          "properties": {
            "sha256": {
              "type": "string",
              "pattern": "^[a-f0-9]{64}$",
              "description": "SHA256 checksum of SBOM"
            },
            "format": {
              "type": "string",
              "enum": ["spdx", "cyclonedx"],
              "description": "SBOM format"
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["bundle"],
      "additionalProperties": false
    },
    "Entrypoint": {
      "type": "object",
      "description": "Agent entrypoint configuration",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["cli", "api", "webhook", "grpc"],
          "description": "Entrypoint type"
        },
        "command": {
          "type": "string",
          "description": "Command to execute (for CLI type)"
        },
        "endpoint": {
          "type": "string",
          "format": "uri",
          "description": "HTTP/gRPC endpoint URL (for API/webhook/grpc types)"
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "Signing": {
      "type": "object",
      "description": "Cryptographic signing metadata (optional, reserved for future use)",
      "properties": {
        "sigstore": {
          "type": "object",
          "properties": {
            "bundle": {
              "type": "string",
              "format": "uri",
              "description": "URL to Sigstore bundle"
            }
          },
          "additionalProperties": false
        },
        "cosign": {
          "type": "object",
          "properties": {
            "signature": {
              "type": "string",
              "format": "uri",
              "description": "URL to Cosign signature"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  }
}
