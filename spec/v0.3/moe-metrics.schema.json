{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://openstandardagents.org/schemas/v0.3.5/moe-metrics.json",
  "title": "OSSA v0.3.5 MOE (Measure of Effectiveness) Metrics Schema",
  "description": "Standardized metrics for evaluating agent performance and effectiveness",
  "type": "object",
  "definitions": {
    "MetricDefinition": {
      "type": "object",
      "required": ["metric", "target"],
      "properties": {
        "metric": {
          "type": "string",
          "description": "Metric identifier",
          "examples": ["review_accuracy", "review_latency_p95", "user_satisfaction", "uptime", "cost_per_review"]
        },
        "description": {
          "type": "string"
        },
        "target": {
          "oneOf": [
            { "type": "number" },
            { "type": "string" }
          ],
          "description": "Target value for metric"
        },
        "unit": {
          "type": "string",
          "examples": ["ratio", "seconds", "rating", "usd", "percentage"]
        },
        "scale": {
          "type": "array",
          "items": {
            "type": "number"
          },
          "description": "Value scale (e.g., [1, 5] for ratings)"
        },
        "measurement": {
          "type": "object",
          "required": ["type"],
          "properties": {
            "type": {
              "type": "string",
              "enum": ["ratio", "average", "percentile", "count", "sum"]
            },
            "numerator": {
              "type": "string",
              "description": "Field name for numerator (for ratio type)"
            },
            "denominator": {
              "type": "string",
              "description": "Field name for denominator (for ratio type)"
            },
            "field": {
              "type": "string",
              "description": "Field name to measure"
            },
            "value": {
              "type": "integer",
              "description": "Percentile value (e.g., 95 for p95)"
            },
            "source": {
              "type": "string",
              "description": "Data source (e.g., agent-tracer, feedback_ratings)"
            }
          }
        },
        "collection": {
          "type": "object",
          "properties": {
            "source": {
              "type": "string",
              "enum": ["agent-tracer", "gitlab_observability", "custom"]
            },
            "interval": {
              "type": "string",
              "enum": ["real_time", "1s", "10s", "60s", "5m", "1h"],
              "default": "60s"
            }
          }
        }
      }
    },
    "MOEConfiguration": {
      "type": "object",
      "properties": {
        "primary": {
          "$ref": "#/definitions/MetricDefinition",
          "description": "Primary effectiveness metric"
        },
        "secondary": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/MetricDefinition"
          },
          "description": "Secondary supporting metrics"
        },
        "operational": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/MetricDefinition"
          },
          "description": "Operational health metrics"
        },
        "tracking": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "collection_interval": {
              "type": "string",
              "default": "60s"
            },
            "retention_days": {
              "type": "integer",
              "default": 90
            },
            "dashboards": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "examples": [["gitlab_observability", "agent_studio_ui"]]
            },
            "alerts": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["condition"],
                "properties": {
                  "condition": {
                    "type": "string",
                    "description": "Alert condition expression (e.g., 'primary_metric < target * 0.9')"
                  },
                  "severity": {
                    "type": "string",
                    "enum": ["info", "warning", "critical"]
                  },
                  "notification": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "examples": [["slack", "email", "pagerduty"]]
                  }
                }
              }
            }
          }
        }
      },
      "required": ["primary"]
    }
  },
  "properties": {
    "moe": {
      "$ref": "#/definitions/MOEConfiguration"
    }
  }
}
