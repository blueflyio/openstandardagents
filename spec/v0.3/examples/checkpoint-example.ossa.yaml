apiVersion: ossa/v0.3.5
kind: Agent
metadata:
  name: checkpoint-enabled-agent
  version: 1.0.0
  description: "Agent with checkpointing for long-running tasks"
spec:
  identity:
    id: "@checkpoint-enabled-agent"
    display_name: "Checkpoint Enabled Agent"
    tier: worker

  llm:
    provider: ${LLM_PROVIDER:-anthropic}
    model: ${LLM_MODEL:-claude-sonnet}
    profile: balanced

  # Completion signals with checkpoint support
  completion:
    default_signal: complete
    signals:
      - signal: continue
        condition: "iteration_count < max_iterations"
      - signal: checkpoint
        condition: "iteration_count % 5 == 0"
      - signal: blocked
        condition: "confidence < 0.5"
    max_iterations: 50
    timeout_seconds: 3600

  # Checkpointing configuration
  checkpointing:
    enabled: true
    interval: iteration
    interval_value: 5
    retention:
      days: 30
      max_checkpoints: 100
    storage:
      backend: agent-brain
      location: s3://checkpoints/@checkpoint-enabled-agent/{session_id}

  # Tools with checkpoint support
  tools:
    - name: checkpoint_session
      description: "Save current session state for resumption"
      parameters:
        type: object
        properties:
          reason:
            type: string
            description: "Reason for checkpoint"

    - name: resume_session
      description: "Resume from a previous checkpoint"
      parameters:
        type: object
        required: [checkpoint_id]
        properties:
          checkpoint_id:
            type: string
            format: uuid

    - name: long_running_task
      description: "Execute a long-running task with automatic checkpointing"
      parameters:
        type: object
        required: [task_description]
        properties:
          task_description:
            type: string
          max_iterations:
            type: integer
            default: 50

  # Access tier
  access_tier:
    tier: tier_2_write_limited
    permissions:
      - gitlab:read
      - gitlab:write_comments
