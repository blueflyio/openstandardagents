{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://openstandardagents.org/schemas/v0.3.5/extensions/kagent/kagent.json",
  "title": "Kagent (GitLab Kubernetes Agents) Extension",
  "description": "Native integration with GitLab's Kagent framework for Kubernetes-native agent deployment, management, and orchestration. Enables GitLab CI/CD integration, Kubernetes-native deployment, service mesh integration, and GitLab agent registry compatibility.",
  "type": "object",
  "properties": {
    "kubernetes": {
      "$ref": "#/definitions/KubernetesConfig",
      "description": "Kubernetes deployment configuration for GitLab Kagent"
    },
    "guardrails": {
      "$ref": "#/definitions/GuardrailsConfig",
      "description": "Safety and compliance guardrails for Kagent deployment"
    },
    "a2aConfig": {
      "$ref": "#/definitions/A2AConfig",
      "description": "Agent-to-agent communication configuration"
    },
    "meshIntegration": {
      "$ref": "#/definitions/MeshIntegration",
      "description": "Service mesh integration (Istio, Linkerd, Ambient Mesh)"
    },
    "gitlabIntegration": {
      "$ref": "#/definitions/GitLabIntegration",
      "description": "GitLab-specific integration settings"
    },
    "monitoring": {
      "$ref": "#/definitions/MonitoringConfig",
      "description": "Monitoring and observability configuration"
    }
  },
  "required": ["kubernetes"],
  "additionalProperties": false,
  "definitions": {
    "KubernetesConfig": {
      "type": "object",
      "description": "Kubernetes-native deployment configuration",
      "properties": {
        "namespace": {
          "type": "string",
          "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
          "description": "Kubernetes namespace for agent deployment",
          "default": "default"
        },
        "labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Kubernetes labels for agent identification and selection",
          "default": {}
        },
        "annotations": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Kubernetes annotations for metadata and configuration",
          "default": {}
        },
        "resourceLimits": {
          "$ref": "#/definitions/ResourceLimits",
          "description": "Kubernetes resource limits and requests"
        },
        "serviceAccount": {
          "type": "string",
          "description": "Kubernetes service account for agent execution",
          "default": "default"
        },
        "imagePullSecrets": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Kubernetes image pull secrets for private registries"
        },
        "nodeSelector": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Kubernetes node selector for agent pod placement"
        },
        "tolerations": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Toleration"
          },
          "description": "Kubernetes tolerations for pod scheduling"
        },
        "affinity": {
          "$ref": "#/definitions/Affinity",
          "description": "Kubernetes pod affinity/anti-affinity rules"
        },
        "securityContext": {
          "$ref": "#/definitions/SecurityContext",
          "description": "Kubernetes security context for agent pods"
        }
      },
      "required": ["namespace"],
      "additionalProperties": false
    },
    "ResourceLimits": {
      "type": "object",
      "description": "Kubernetes resource limits and requests",
      "properties": {
        "cpu": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]+)?(m|)$",
          "description": "CPU limit (e.g., '1000m', '1')",
          "examples": ["100m", "500m", "1000m", "2"]
        },
        "memory": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]+)?(Ki|Mi|Gi|Ti|Pi|Ei|k|M|G|T|P|E)?$",
          "description": "Memory limit (e.g., '512Mi', '2Gi')",
          "examples": ["128Mi", "512Mi", "1Gi", "2Gi", "4Gi"]
        },
        "ephemeralStorage": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]+)?(Ki|Mi|Gi|Ti|Pi|Ei|k|M|G|T|P|E)?$",
          "description": "Ephemeral storage limit"
        },
        "requests": {
          "type": "object",
          "properties": {
            "cpu": {
              "type": "string",
              "pattern": "^[0-9]+(\\.[0-9]+)?(m|)$"
            },
            "memory": {
              "type": "string",
              "pattern": "^[0-9]+(\\.[0-9]+)?(Ki|Mi|Gi|Ti|Pi|Ei|k|M|G|T|P|E)?$"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "GuardrailsConfig": {
      "type": "object",
      "description": "Safety and compliance guardrails",
      "properties": {
        "requireApproval": {
          "type": "boolean",
          "description": "Require human approval for agent actions",
          "default": false
        },
        "costLimits": {
          "$ref": "#/definitions/CostLimits",
          "description": "Cost limits and budget controls"
        },
        "allowedActions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of allowed Kubernetes actions (e.g., 'kubernetes:get:pods', 'kubernetes:create:deployments')",
          "examples": [
            "kubernetes:get:pods",
            "kubernetes:get:logs",
            "kubernetes:create:deployments",
            "kubernetes:patch:services"
          ]
        },
        "blockedActions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of blocked Kubernetes actions"
        },
        "auditLog": {
          "$ref": "#/definitions/AuditLogConfig",
          "description": "Audit logging configuration"
        },
        "compliance": {
          "$ref": "#/definitions/ComplianceConfig",
          "description": "Compliance framework requirements (SOC2, HIPAA, FedRAMP, etc.)"
        }
      },
      "additionalProperties": false
    },
    "CostLimits": {
      "type": "object",
      "description": "Cost limits and budget controls",
      "properties": {
        "maxTokensPerDay": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum tokens per day"
        },
        "maxCostPerDay": {
          "type": "number",
          "minimum": 0,
          "description": "Maximum cost per day"
        },
        "currency": {
          "type": "string",
          "enum": ["USD", "EUR", "GBP", "JPY", "CAD", "AUD"],
          "default": "USD",
          "description": "Currency for cost limits"
        },
        "budgetAlertThreshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Alert when budget reaches this percentage (0.0-1.0)",
          "default": 0.8
        }
      },
      "additionalProperties": false
    },
    "AuditLogConfig": {
      "type": "object",
      "description": "Audit logging configuration",
      "properties": {
        "destination": {
          "type": "string",
          "description": "Audit log destination (e.g., 'compliance-engine', 's3://bucket/path', 'stdout')"
        },
        "retention": {
          "type": "string",
          "pattern": "^[0-9]+(days|weeks|months|years)$",
          "description": "Audit log retention period",
          "examples": ["7days", "30days", "1year", "7years", "10years"]
        },
        "format": {
          "type": "string",
          "enum": ["json", "cef", "syslog"],
          "default": "json",
          "description": "Audit log format"
        },
        "encryption": {
          "type": "boolean",
          "default": true,
          "description": "Encrypt audit logs at rest"
        }
      },
      "required": ["destination", "retention"],
      "additionalProperties": false
    },
    "ComplianceConfig": {
      "type": "object",
      "description": "Compliance framework requirements",
      "properties": {
        "frameworks": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["SOC2", "HIPAA", "FedRAMP", "NIST", "ISO27001", "PCI-DSS", "GDPR"]
          },
          "description": "Compliance frameworks this agent must comply with"
        },
        "evidenceCollection": {
          "type": "boolean",
          "default": true,
          "description": "Collect compliance evidence automatically"
        },
        "reportingInterval": {
          "type": "string",
          "pattern": "^[0-9]+(s|m|h|d)$",
          "description": "Compliance reporting interval",
          "default": "24h"
        }
      },
      "additionalProperties": false
    },
    "A2AConfig": {
      "type": "object",
      "description": "Agent-to-agent communication configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable agent-to-agent communication"
        },
        "protocol": {
          "type": "string",
          "enum": ["json-rpc", "grpc", "http", "websocket", "nats"],
          "default": "json-rpc",
          "description": "A2A communication protocol"
        },
        "endpoints": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          },
          "description": "List of agent endpoints for A2A communication",
          "examples": [
            "http://security-scanner:8080/a2a",
            "http://documentation-agent:8080/a2a",
            "grpc://cost-optimizer:9090"
          ]
        },
        "authentication": {
          "$ref": "#/definitions/AuthenticationConfig",
          "description": "A2A authentication configuration"
        },
        "timeout": {
          "type": "integer",
          "minimum": 1,
          "default": 30,
          "description": "A2A request timeout in seconds"
        },
        "retryPolicy": {
          "$ref": "#/definitions/RetryPolicy",
          "description": "A2A retry policy"
        }
      },
      "required": ["enabled"],
      "additionalProperties": false
    },
    "AuthenticationConfig": {
      "type": "object",
      "description": "Authentication configuration for A2A",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["mtls", "oauth2", "api-key", "jwt", "none"],
          "default": "mtls",
          "description": "Authentication type"
        },
        "credentials": {
          "type": "object",
          "description": "Authentication credentials (structure depends on type)"
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "RetryPolicy": {
      "type": "object",
      "description": "Retry policy for A2A requests",
      "properties": {
        "maxRetries": {
          "type": "integer",
          "minimum": 0,
          "default": 3,
          "description": "Maximum number of retries"
        },
        "backoff": {
          "type": "string",
          "enum": ["linear", "exponential", "fixed"],
          "default": "exponential",
          "description": "Backoff strategy"
        },
        "initialDelay": {
          "type": "integer",
          "minimum": 1,
          "default": 1,
          "description": "Initial retry delay in seconds"
        }
      },
      "additionalProperties": false
    },
    "MeshIntegration": {
      "type": "object",
      "description": "Service mesh integration configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable service mesh integration"
        },
        "istioIntegration": {
          "type": "boolean",
          "default": false,
          "description": "Enable Istio service mesh integration"
        },
        "linkerdIntegration": {
          "type": "boolean",
          "default": false,
          "description": "Enable Linkerd service mesh integration"
        },
        "ambientMesh": {
          "type": "boolean",
          "default": false,
          "description": "Enable Istio Ambient Mesh (sidecarless)"
        },
        "trafficPolicy": {
          "$ref": "#/definitions/TrafficPolicy",
          "description": "Service mesh traffic policy"
        }
      },
      "required": ["enabled"],
      "additionalProperties": false
    },
    "TrafficPolicy": {
      "type": "object",
      "description": "Service mesh traffic policy",
      "properties": {
        "loadBalancer": {
          "type": "string",
          "enum": ["round_robin", "least_conn", "random", "consistent_hash"],
          "default": "round_robin",
          "description": "Load balancing algorithm"
        },
        "circuitBreaker": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "maxConnections": {
              "type": "integer",
              "minimum": 1,
              "default": 100
            },
            "maxPendingRequests": {
              "type": "integer",
              "minimum": 1,
              "default": 10
            },
            "maxRequests": {
              "type": "integer",
              "minimum": 1,
              "default": 100
            },
            "consecutiveErrors": {
              "type": "integer",
              "minimum": 1,
              "default": 5
            }
          },
          "additionalProperties": false
        },
        "timeout": {
          "type": "integer",
          "minimum": 1,
          "default": 30,
          "description": "Request timeout in seconds"
        }
      },
      "additionalProperties": false
    },
    "GitLabIntegration": {
      "type": "object",
      "description": "GitLab-specific integration settings",
      "properties": {
        "agentId": {
          "type": "string",
          "description": "GitLab agent ID"
        },
        "projectId": {
          "type": "integer",
          "description": "GitLab project ID"
        },
        "groupId": {
          "type": "integer",
          "description": "GitLab group ID"
        },
        "ciCdIntegration": {
          "type": "boolean",
          "default": true,
          "description": "Enable GitLab CI/CD integration"
        },
        "registryIntegration": {
          "type": "boolean",
          "default": true,
          "description": "Enable GitLab agent registry integration"
        },
        "webhookUrl": {
          "type": "string",
          "format": "uri",
          "description": "GitLab webhook URL for agent events"
        }
      },
      "additionalProperties": false
    },
    "MonitoringConfig": {
      "type": "object",
      "description": "Monitoring and observability configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable monitoring"
        },
        "metrics": {
          "type": "object",
          "properties": {
            "prometheus": {
              "type": "boolean",
              "default": true,
              "description": "Enable Prometheus metrics"
            },
            "endpoint": {
              "type": "string",
              "default": "/metrics",
              "description": "Metrics endpoint path"
            },
            "port": {
              "type": "integer",
              "minimum": 1,
              "maximum": 65535,
              "default": 9090,
              "description": "Metrics port"
            }
          },
          "additionalProperties": false
        },
        "tracing": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "provider": {
              "type": "string",
              "enum": ["jaeger", "zipkin", "datadog", "newrelic", "opentelemetry"],
              "default": "opentelemetry"
            },
            "samplingRate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "default": 0.1,
              "description": "Tracing sampling rate (0.0-1.0)"
            }
          },
          "additionalProperties": false
        },
        "logging": {
          "type": "object",
          "properties": {
            "level": {
              "type": "string",
              "enum": ["debug", "info", "warn", "error"],
              "default": "info"
            },
            "format": {
              "type": "string",
              "enum": ["json", "text"],
              "default": "json"
            },
            "destination": {
              "type": "string",
              "enum": ["stdout", "file", "loki", "elasticsearch"],
              "default": "stdout"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "Toleration": {
      "type": "object",
      "description": "Kubernetes toleration",
      "properties": {
        "key": {
          "type": "string"
        },
        "operator": {
          "type": "string",
          "enum": ["Equal", "Exists"]
        },
        "value": {
          "type": "string"
        },
        "effect": {
          "type": "string",
          "enum": ["NoSchedule", "PreferNoSchedule", "NoExecute"]
        }
      },
      "required": ["key", "operator"],
      "additionalProperties": false
    },
    "Affinity": {
      "type": "object",
      "description": "Kubernetes pod affinity/anti-affinity",
      "properties": {
        "podAffinity": {
          "type": "object",
          "description": "Pod affinity rules"
        },
        "podAntiAffinity": {
          "type": "object",
          "description": "Pod anti-affinity rules"
        },
        "nodeAffinity": {
          "type": "object",
          "description": "Node affinity rules"
        }
      },
      "additionalProperties": false
    },
    "SecurityContext": {
      "type": "object",
      "description": "Kubernetes security context",
      "properties": {
        "runAsNonRoot": {
          "type": "boolean",
          "default": true
        },
        "runAsUser": {
          "type": "integer"
        },
        "runAsGroup": {
          "type": "integer"
        },
        "fsGroup": {
          "type": "integer"
        },
        "seccompProfile": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["RuntimeDefault", "Localhost"]
            }
          }
        }
      },
      "additionalProperties": false
    }
  }
}
