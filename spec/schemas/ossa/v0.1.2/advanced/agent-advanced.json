{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://open-standards-scalable-agents.org/schemas/v0.1.2/agent-advanced.json",
  "title": "OSSA Advanced Agent Schema",
  "description": "Advanced level OSSA agent specification with full regulatory compliance",
  "allOf": [
    {
      "$ref": "../governed/agent-governed.json"
    },
    {
      "properties": {
        "metadata": {
          "properties": {
            "labels": {
              "properties": {
                "tier": {
                  "const": "advanced"
                }
              }
            },
            "annotations": {
              "properties": {
                "ossa.io/conformance-level": {
                  "const": "advanced"
                }
              }
            }
          }
        },
        "spec": {
          "properties": {
            "compliance": {
              "type": "object",
              "required": ["frameworks"],
              "properties": {
                "frameworks": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": ["iso_42001", "nist_ai_rmf", "eu_ai_act", "sox", "hipaa", "gdpr", "ccpa", "custom"]
                  },
                  "minItems": 1,
                  "description": "Compliance frameworks"
                },
                "certifications": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["framework", "level", "valid_until"],
                    "properties": {
                      "framework": {
                        "type": "string",
                        "enum": ["iso_42001", "nist_ai_rmf", "eu_ai_act", "sox", "hipaa", "gdpr", "ccpa"]
                      },
                      "level": {
                        "type": "string",
                        "enum": ["bronze", "silver", "gold", "platinum"]
                      },
                      "valid_until": {
                        "type": "string",
                        "format": "date"
                      },
                      "certificate_id": {
                        "type": "string"
                      },
                      "issuing_authority": {
                        "type": "string"
                      }
                    }
                  }
                },
                "audit": {
                  "type": "object",
                  "required": ["enabled", "level"],
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true
                    },
                    "level": {
                      "type": "string",
                      "enum": ["basic", "comprehensive", "forensic"],
                      "description": "Audit detail level"
                    },
                    "retention": {
                      "type": "string",
                      "pattern": "^[0-9]+[ymwd]$",
                      "description": "Audit log retention period"
                    },
                    "destinations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "required": ["type", "endpoint"],
                        "properties": {
                          "type": {
                            "type": "string",
                            "enum": ["syslog", "elasticsearch", "splunk", "custom"]
                          },
                          "endpoint": {
                            "type": "string"
                          },
                          "format": {
                            "type": "string",
                            "enum": ["json", "xml", "cef", "custom"]
                          }
                        }
                      }
                    }
                  }
                },
                "data_governance": {
                  "type": "object",
                  "required": ["classification", "retention"],
                  "properties": {
                    "classification": {
                      "type": "object",
                      "required": ["levels"],
                      "properties": {
                        "levels": {
                          "type": "array",
                          "items": {
                            "type": "string",
                            "enum": ["public", "internal", "confidential", "restricted", "top_secret"]
                          }
                        },
                        "default_level": {
                          "type": "string",
                          "enum": ["public", "internal", "confidential", "restricted", "top_secret"]
                        }
                      }
                    },
                    "retention": {
                      "type": "object",
                      "properties": {
                        "policies": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "required": ["data_type", "retention_period"],
                            "properties": {
                              "data_type": {
                                "type": "string"
                              },
                              "retention_period": {
                                "type": "string",
                                "pattern": "^[0-9]+[ymwd]$"
                              },
                              "disposal_method": {
                                "type": "string",
                                "enum": ["secure_delete", "degauss", "shred", "incinerate"]
                              }
                            }
                          }
                        }
                      }
                    },
                    "privacy": {
                      "type": "object",
                      "properties": {
                        "pii_handling": {
                          "type": "object",
                          "properties": {
                            "detection": {
                              "type": "boolean",
                              "default": true
                            },
                            "masking": {
                              "type": "boolean",
                              "default": true
                            },
                            "encryption": {
                              "type": "boolean",
                              "default": true
                            }
                          }
                        },
                        "consent_management": {
                          "type": "object",
                          "properties": {
                            "required": {
                              "type": "boolean",
                              "default": true
                            },
                            "granular": {
                              "type": "boolean",
                              "default": true
                            },
                            "revocable": {
                              "type": "boolean",
                              "default": true
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "risk_management": {
                  "type": "object",
                  "required": ["assessments"],
                  "properties": {
                    "assessments": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "required": ["type", "frequency", "last_performed"],
                        "properties": {
                          "type": {
                            "type": "string",
                            "enum": ["privacy_impact", "security_assessment", "bias_audit", "fairness_review", "safety_evaluation"]
                          },
                          "frequency": {
                            "type": "string",
                            "enum": ["monthly", "quarterly", "annually", "on_change"]
                          },
                          "last_performed": {
                            "type": "string",
                            "format": "date"
                          },
                          "next_due": {
                            "type": "string",
                            "format": "date"
                          },
                          "assessor": {
                            "type": "string"
                          }
                        }
                      }
                    },
                    "mitigation_strategies": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "required": ["risk_type", "strategy", "implementation_status"],
                        "properties": {
                          "risk_type": {
                            "type": "string"
                          },
                          "strategy": {
                            "type": "string"
                          },
                          "implementation_status": {
                            "type": "string",
                            "enum": ["planned", "in_progress", "implemented", "verified"]
                          },
                          "responsible_party": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "deployment": {
              "type": "object",
              "properties": {
                "environments": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["name", "type"],
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "type": {
                        "type": "string",
                        "enum": ["development", "staging", "production", "dr"]
                      },
                      "region": {
                        "type": "string"
                      },
                      "compliance_zone": {
                        "type": "string",
                        "enum": ["us", "eu", "apac", "sovereign"]
                      }
                    }
                  }
                },
                "disaster_recovery": {
                  "type": "object",
                  "required": ["enabled", "rpo", "rto"],
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true
                    },
                    "rpo": {
                      "type": "string",
                      "pattern": "^[0-9]+[smhd]$",
                      "description": "Recovery Point Objective"
                    },
                    "rto": {
                      "type": "string",
                      "pattern": "^[0-9]+[smhd]$",
                      "description": "Recovery Time Objective"
                    },
                    "backup_strategy": {
                      "type": "string",
                      "enum": ["full", "incremental", "differential", "continuous"]
                    }
                  }
                }
              }
            },
            "governance": {
              "type": "object",
              "required": ["stakeholders"],
              "properties": {
                "stakeholders": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["role", "contact"],
                    "properties": {
                      "role": {
                        "type": "string",
                        "enum": ["owner", "steward", "custodian", "user", "auditor"]
                      },
                      "contact": {
                        "type": "string"
                      },
                      "responsibilities": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    }
                  }
                },
                "change_management": {
                  "type": "object",
                  "properties": {
                    "approval_required": {
                      "type": "boolean",
                      "default": true
                    },
                    "approvers": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "testing_required": {
                      "type": "boolean",
                      "default": true
                    }
                  }
                },
                "documentation": {
                  "type": "object",
                  "properties": {
                    "required_documents": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "enum": ["architecture", "security", "privacy", "operations", "incident_response"]
                      }
                    },
                    "review_cycle": {
                      "type": "string",
                      "enum": ["monthly", "quarterly", "annually"]
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  ]
}