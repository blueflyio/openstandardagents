apiVersion: ossa/v0.3.2
kind: Agent
metadata:
  name: example-agent-quick-wins
  namespace: production
  labels:
    app: example
    version: v1.0.0
spec:
  role: "Example agent demonstrating all quick-win capabilities"
  
  # 1. Health Monitoring Configuration
  health:
    enabled: true
    endpoints:
      health: /health
      ready: /ready
      live: /live
    interval_seconds: 30
    timeout_seconds: 5
    restart_policy:
      enabled: true
      max_restarts: 3
      restart_delay_seconds: 10
  
  # 2. Secrets Management
  secrets:
    provider: gitlab_vault
    injection:
      method: env_vars
      prefix: AGENT_SECRET_
    rotation:
      enabled: true
      interval_days: 90
      auto_rotate: false
    encryption:
      enabled: true
      algorithm: aes-256-gcm
    audit:
      enabled: true
      log_access: true
  
  # 3. LLM Configuration with Circuit Breaker (via retry)
  llm:
    provider: anthropic
    model: claude-sonnet-4
    profile: balanced
    retry:
      max_attempts: 3
      backoff:
        strategy: exponential
        initial_delay_ms: 1000
        max_delay_ms: 30000
      circuit_breaker:
        enabled: true
        failure_threshold: 5
        timeout_ms: 60000
        half_open_max_calls: 3
        success_threshold: 2
  
  # 4. Error Handling with Aggregation
  error_handling:
    strategy: fail_fast
    aggregation:
      enabled: true
      window_seconds: 300
      threshold: 10
      alert_channels:
        - slack
        - pagerduty
      categorization:
        enabled: true
        categories:
          - timeout
          - rate_limit
          - validation
  
  # 5. State Management with Versioning & Conflict Resolution
  state:
    mode: long_running
    storage:
      type: kv
      config:
        provider: redis
        endpoint: redis://localhost:6379
    versioning:
      enabled: true
      strategy: optimistic_locking
    conflict_resolution:
      strategy: merge_on_conflict
      merge_on_conflict: true
    persistence:
      enabled: true
      backup_interval_seconds: 300
      restore_on_startup: true
  
  # 6. Security Boundaries
  safety:
    content_filtering:
      enabled: true
    security_boundaries:
      network_policies:
        enabled: true
        allowed_agents:
          - agent-a
          - agent-b
      rbac:
        enabled: true
        roles:
          - reader
          - writer
      mtls:
        enabled: true
        ca_cert: env:CA_CERT
      audit_logging:
        enabled: true
        retention_days: 90
  
  # 7. Rollback Configuration
  rollback:
    triggers:
      - health_check_failure
      - error_rate_threshold
      - cost_exceeded
    automation:
      enabled: true
      approval_required: false
      notification_channels:
        - slack
        - email
  
  # 8. Testing Configuration (Optional)
  testing:
    framework: jest
    mock_llm:
      enabled: true
      provider: local_mock
      responses_file: tests/fixtures/mock-llm-responses.json
    coverage:
      threshold: 80
      enforce: true
    test_data:
      management: fixtures
      fixtures_path: tests/fixtures/
