# OSSA Enterprise Workspace Configuration - Production Grade
# Comprehensive enterprise workspace with full compliance, monitoring, and advanced orchestration
# OpenAPI AI Agents Standard (OSSA) v0.1.8

ossa: "0.1.8"
kind: "Workspace"
metadata:
  name: "enterprise-workspace"
  version: "1.0.0"
  created: "2025-01-26"
  updated: "2025-01-26"
  description: "Production-grade enterprise workspace with comprehensive governance and orchestration"
  
  annotations:
    # Workspace-level UADP annotations
    workspace.uadp/discovery-enabled: "true"
    workspace.uadp/orchestration-enabled: "true"
    workspace.uadp/auto-scaling: "true"
    workspace.uadp/cross-project-routing: "enabled"
    workspace.uadp/compliance-monitoring: "automated"
    
    # Enterprise governance
    enterprise/organization: "${ORGANIZATION_NAME}"
    enterprise/domain: "${ORGANIZATION_DOMAIN}"
    enterprise/compliance-level: "gold"
    enterprise/security-classification: "internal"
    
    # Framework support
    frameworks/langchain: "supported"
    frameworks/crewai: "supported"
    frameworks/autogen: "bridge"
    frameworks/openai: "supported"
    frameworks/anthropic: "bridge"
    frameworks/google: "supported"
    
  labels:
    environment: production
    region: us-east-1
    compliance: "iso-42001,nist-ai-rmf,eu-ai-act"
    tier: enterprise
    organization: "${ORGANIZATION_NAME}"

spec:
  workspace:
    name: enterprise-production
    description: "Production workspace with multi-region support"
    
  discovery:
    enabled: true
    scan_paths:
      - .agents
      - agents
      - services/agents
      - "**/modules/**/agents"  # Deep scanning
    exclude_paths:
      - "**/node_modules/**"
      - "**/.git/**"
      - "**/test/**"
    auto_register: true
    refresh_interval: 60  # 1 minute for production
    validation:
      required_level: 2  # Minimum agent level
      enforce_schemas: true
      reject_invalid: true
    
  orchestration:
    strategy: hierarchical
    max_concurrent: 10
    timeout: 60000  # 60 seconds
    error_handling: retry  # stop, continue, retry, fallback
    retry:
      max_attempts: 3
      backoff: exponential
      initial_delay: 1000
    routing_rules:
      - pattern: "security|audit|compliance"
        agents: ["security-agent", "compliance-agent"]
        priority: high
      - pattern: "performance|optimize"
        agents: ["performance-agent"]
        priority: medium
      - pattern: ".*"
        agents: ["*"]  # All agents
        priority: low
    conflict_resolution: weighted_confidence
    cache:
      enabled: true
      ttl: 3600  # 1 hour
      backend: redis
      
  registry:
    type: etcd  # local, redis, etcd, consul
    connection: "etcd://etcd-cluster:2379"
    namespace: oaas-production
    replication:
      enabled: true
      factor: 3
    backup:
      enabled: true
      schedule: "0 2 * * *"  # Daily at 2 AM
      retention: 30  # days
      
  context:
    environment: production
    region: us-east-1
    variables:
      API_BASE_URL: "https://api.production.example.com"
      LOG_LEVEL: "warn"
      METRICS_ENABLED: "true"
      TRACING_ENABLED: "true"
    resources:
      - type: database
        name: postgres-main
        connection: "postgresql://prod-db:5432/agents"
      - type: vector_store
        name: qdrant
        connection: "http://qdrant:6333"
      - type: api
        name: internal-api
        connection: "https://internal.example.com"
        
  bridges:
    - protocol: mcp
      enabled: true
      config:
        auto_generate: true
        server_prefix: "prod-"
        port_range: "3100-3200"
    - protocol: langchain
      enabled: true
      config:
        tool_integration: seamless
        async_support: true
    - protocol: crewai
      enabled: true
      config:
        role_mapping: automatic
        delegation: enabled
    - protocol: autogen
      enabled: true
      config:
        conversation_mode: group_chat
    - protocol: custom
      enabled: true
      config:
        adapter: "./adapters/custom-protocol.js"
        
  compliance:
    frameworks:
      - iso_42001
      - nist_ai_rmf
      - eu_ai_act
      - sox
      - hipaa
    audit:
      enabled: true
      level: forensic
      storage: elasticsearch
      retention: "7y"  # 7 years for SOX
    data_governance:
      classification: strict
      encryption: required
      anonymization: enabled
      gdpr_compliant: true
      
  monitoring:
    metrics:
      enabled: true
      export: prometheus
      endpoint: "/metrics"
      interval: 15
      custom_metrics:
        - agent_invocations
        - orchestration_latency
        - bridge_conversions
        - error_rates
    logging:
      level: info
      format: json
      destinations:
        - stdout
        - elasticsearch
        - s3://logs-bucket/workspace/
      sampling:
        error: 1.0
        warning: 1.0
        info: 0.1
        debug: 0.01
    tracing:
      enabled: true
      provider: jaeger
      endpoint: "http://jaeger:14268/api/traces"
      sampling_rate: 0.1
    alerting:
      enabled: true
      channels:
        - slack
        - pagerduty
        - email
      rules:
        - name: workspace_down
          condition: "health_check_failures > 3"
          severity: critical
          channel: pagerduty
        - name: high_error_rate
          condition: "error_rate > 0.05"
          severity: warning
          channel: slack
          
  security:
    authentication:
      enabled: true
      providers:
        - type: oauth2
          issuer: "https://auth.example.com"
        - type: api_key
          header: "X-API-Key"
    authorization:
      enabled: true
      model: rbac
      policies:
        - role: admin
          permissions: ["*"]
        - role: developer
          permissions: ["read", "execute"]
        - role: viewer
          permissions: ["read"]
    encryption:
      at_rest: true
      in_transit: true
      key_management: vault
    network:
      allowed_ips:
        - "10.0.0.0/8"
        - "172.16.0.0/12"
      tls:
        enabled: true
        min_version: "1.3"
        
  deployment:
    multi_region:
      enabled: true
      regions:
        - us-east-1
        - eu-west-1
        - ap-southeast-1
      failover: automatic
    disaster_recovery:
      enabled: true
      rpo: 3600  # 1 hour
      rto: 7200  # 2 hours
      backup_regions:
        - us-west-2
        - eu-central-1