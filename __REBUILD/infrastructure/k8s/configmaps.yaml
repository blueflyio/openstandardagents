apiVersion: v1
kind: ConfigMap
metadata:
  name: ossa-platform-config
  namespace: ossa-platform
  labels:
    app.kubernetes.io/name: ossa-platform
    app.kubernetes.io/component: configuration
    ossa.bluefly.io/version: "0.1.8"
data:
  # Core platform configuration
  NODE_ENV: "production"
  OSSA_VERSION: "0.1.8"
  OSSA_ENVIRONMENT: "production"
  
  # API Configuration
  API_VERSION: "v1"
  GRAPHQL_ENABLED: "true"
  GRAPHQL_INTROSPECTION: "false"
  GRAPHQL_PLAYGROUND: "false"
  
  # Service Discovery
  GATEWAY_URL: "http://ossa-gateway.ossa-platform.svc.cluster.local:3000"
  COORDINATION_URL: "http://ossa-coordination.ossa-platform.svc.cluster.local:3010"
  DISCOVERY_URL: "http://ossa-discovery.ossa-platform.svc.cluster.local:3011"
  ORCHESTRATION_URL: "http://ossa-orchestration.ossa-platform.svc.cluster.local:3012"
  MONITORING_URL: "http://ossa-monitoring.ossa-platform.svc.cluster.local:3013"
  
  # Database URLs
  REDIS_URL: "redis://ossa-redis.ossa-system.svc.cluster.local:6379"
  POSTGRES_URL: "postgresql://ossa:${POSTGRES_PASSWORD}@ossa-postgres.ossa-system.svc.cluster.local:5432/ossa"
  QDRANT_URL: "http://ossa-qdrant.ossa-system.svc.cluster.local:6333"
  
  # Scaling Configuration
  MIN_REPLICAS: "3"
  MAX_REPLICAS: "100"
  TARGET_CPU_UTILIZATION: "70"
  TARGET_MEMORY_UTILIZATION: "80"
  
  # Agent Configuration
  AGENT_POOL_SIZE: "10"
  AGENT_TIMEOUT: "300000"
  AGENT_RETRY_ATTEMPTS: "3"
  AGENT_DISCOVERY_INTERVAL: "30000"
  
  # Security Configuration
  CORS_ORIGIN: "*"
  RATE_LIMIT_WINDOW: "900000"
  RATE_LIMIT_MAX: "1000"
  
  # Observability
  METRICS_ENABLED: "true"
  TRACING_ENABLED: "true"
  LOGGING_LEVEL: "info"
  JAEGER_ENDPOINT: "http://jaeger-collector.ossa-monitoring.svc.cluster.local:14268/api/traces"
  
  # Geographic Distribution
  REGION: "us-west-2"
  AVAILABILITY_ZONES: "us-west-2a,us-west-2b,us-west-2c"
  MULTI_REGION_ENABLED: "true"
  CROSS_REGION_REPLICATION: "true"

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: ossa-agent-config
  namespace: ossa-platform
  labels:
    app.kubernetes.io/name: ossa-platform
    app.kubernetes.io/component: agent-configuration
    ossa.bluefly.io/version: "0.1.8"
data:
  # Agent Framework Support
  LANGCHAIN_ENABLED: "true"
  CREWAI_ENABLED: "true"
  OPENAI_ENABLED: "true"
  ANTHROPIC_ENABLED: "true"
  MCP_ENABLED: "true"
  
  # Agent Capabilities
  TASK_AGENT_CAPABILITIES: "task_execution,workflow_management,state_tracking"
  COMM_AGENT_CAPABILITIES: "message_routing,protocol_bridging,communication_management"
  MCP_AGENT_CAPABILITIES: "mcp_bridging,tool_integration,context_management"
  
  # Performance Optimization
  TOKEN_REDUCTION_TARGET: "85"
  VORTEX_OPTIMIZATION: "true"
  BATCH_PROCESSING: "true"
  PARALLEL_EXECUTION: "true"
  
  # Compliance and Governance
  ISO_42001_COMPLIANCE: "true"
  NIST_AI_RMF_COMPLIANCE: "true"
  EU_AI_ACT_COMPLIANCE: "true"
  AUDIT_LOGGING: "true"
  
  # Agent Health Checks
  HEALTH_CHECK_INTERVAL: "30"
  READINESS_TIMEOUT: "10"
  LIVENESS_TIMEOUT: "5"

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: ossa-monitoring
  labels:
    app.kubernetes.io/name: prometheus
    app.kubernetes.io/component: monitoring
    ossa.bluefly.io/version: "0.1.8"
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s

    rule_files:
      - "/etc/prometheus/ossa-alerts.yml"

    scrape_configs:
      - job_name: 'prometheus'
        static_configs:
          - targets: ['localhost:9090']

      - job_name: 'ossa-gateway'
        kubernetes_sd_configs:
          - role: endpoints
            namespaces:
              names: ['ossa-platform']
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            action: keep
            regex: ossa-gateway
          - source_labels: [__meta_kubernetes_endpoint_port_name]
            action: keep
            regex: metrics

      - job_name: 'ossa-agents'
        kubernetes_sd_configs:
          - role: endpoints
            namespaces:
              names: ['ossa-platform']
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]
            action: keep
            regex: true
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]
            action: replace
            target_label: __metrics_path__
            regex: (.+)

      - job_name: 'kubernetes-apiservers'
        kubernetes_sd_configs:
          - role: endpoints
        scheme: https
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        relabel_configs:
          - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
            action: keep
            regex: default;kubernetes;https

      - job_name: 'kubernetes-nodes'
        kubernetes_sd_configs:
          - role: node
        scheme: https
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token

  ossa-alerts.yml: |
    groups:
    - name: ossa-platform
      rules:
      - alert: OSSAGatewayDown
        expr: up{job="ossa-gateway"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "OSSA Gateway is down"
          description: "OSSA Gateway has been down for more than 1 minute."

      - alert: OSSAHighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes > 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage detected"
          description: "Memory usage is above 80% for more than 5 minutes."

      - alert: OSSAHighCPUUsage
        expr: 100 - (avg(irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is above 80% for more than 5 minutes."

      - alert: OSSAAgentFailure
        expr: increase(ossa_agent_failures_total[5m]) > 5
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Multiple OSSA agent failures detected"
          description: "More than 5 agent failures in the last 5 minutes."