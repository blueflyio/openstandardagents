apiVersion: ossa.io/v0.1.9-alpha.1
kind: Agent
metadata:
  name: voice-assistant
  version: 0.1.9-alpha.1
  description: Voice interface agent for hands-free interaction with OSSA platform
  labels:
    category: interface
    modality: audio
    tenant: ossa-platform
  annotations:
    openapi: /api/voice-agent-specification.yml
    compliance: gold
  author: OSSA Platform Team
  license: Apache-2.0
  repository: https://github.com/ossa/voice-assistant
  documentation: https://docs.ossa.io/agents/voice

spec:
  type: voice
  subtype: voice.assistant
  
  capabilities:
    domains:
      - audio
      - speech
      - interaction
      - nlp
      - orchestration
    operations:
      - name: transcribe_audio
        description: Convert speech to text using configured provider
        inputSchema:
          type: object
          required: [audioData, format]
          properties:
            audioData:
              type: string
              format: base64
            format:
              type: string
              enum: [wav, mp3, m4a, webm]
        outputSchema:
          type: object
          properties:
            text:
              type: string
            confidence:
              type: number
        timeout: 30000
      
      - name: analyze_intent
        description: Extract intent from transcribed text
        inputSchema:
          type: object
          required: [text]
          properties:
            text:
              type: string
            context:
              type: array
        outputSchema:
          type: object
          properties:
            intent:
              type: object
            confidence:
              type: number
        timeout: 5000
      
      - name: synthesize_speech
        description: Convert text to speech audio
        inputSchema:
          type: object
          required: [text]
          properties:
            text:
              type: string
            voiceId:
              type: string
            speed:
              type: number
        outputSchema:
          type: object
          properties:
            audioData:
              type: string
              format: base64
            duration:
              type: number
        timeout: 10000
      
      - name: route_to_agent
        description: Route intent to appropriate agent for execution
        inputSchema:
          type: object
          required: [intent, targetAgent]
          properties:
            intent:
              type: object
            targetAgent:
              type: string
        outputSchema:
          type: object
          properties:
            result:
              type: object
            agentResponse:
              type: string
        timeout: 60000
    
    inputFormats:
      - audio/wav
      - audio/mp3
      - audio/m4a
      - audio/webm
      - application/json
    
    outputFormats:
      - audio/wav
      - audio/mp3
      - application/json
      - text/plain
    
    tokenEfficiency:
      strategies:
        - key-based-context
        - delta-prompting
        - output-only-critique
        - cacheable-capsules
        - checkpoint-memos
      compressionRatio: 0.7
  
  protocols:
    supported:
      - name: rest
        version: "3.1.0"
        endpoint: http://localhost:3006/api/v1
        authentication:
          type: api-key
        tls: false
      - name: websocket
        version: "1.0"
        endpoint: ws://localhost:3006/ws
        authentication:
          type: jwt
        tls: false
    preferred: websocket
  
  conformance:
    level: gold
    certifications:
      - ISO-42001
      - WCAG-2.1-AA
    auditLogging: true
    feedbackLoop: true
    propsTokens: true
    learningSignals: true
  
  performance:
    throughput:
      requestsPerSecond: 100
      concurrentRequests: 50
    latency:
      p50: 200
      p95: 500
      p99: 1000
    limits:
      maxRequestSize: 10485760  # 10MB for audio files
      maxResponseSize: 10485760
      timeout: 60000
  
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
      storage: 5Gi
    limits:
      cpu: 2
      memory: 4Gi
      storage: 10Gi
  
  feedbackLoop:
    phase: execute
    inputs:
      - user_audio
      - conversation_context
      - agent_responses
    outputs:
      - transcribed_text
      - extracted_intent
      - synthesized_audio
      - execution_result
  
  budgets:
    tokens:
      default: 5000
      maximum: 20000
      strategy: adaptive
    time:
      default: 30000
      maximum: 120000
  
  dependencies:
    agents:
      - name: orchestrator-platform
        version: ">=0.1.9"
        optional: false
      - name: registry-core
        version: ">=0.1.9"
        optional: false
    services:
      - name: whisper-api
        endpoint: https://api.openai.com/v1/audio
        healthCheck: https://api.openai.com/v1/models
      - name: elevenlabs-api
        endpoint: https://api.elevenlabs.io/v1
        healthCheck: https://api.elevenlabs.io/v1/voices

status:
  state: registered
  health: healthy
  lastHeartbeat: "2024-01-01T00:00:00Z"
  registeredAt: "2024-01-01T00:00:00Z"
  metrics:
    requestsHandled: 0
    successRate: 1.0
    avgResponseTime: 250
    tokenUsage: 0

voiceConfig:
  inputMode:
    - microphone
    - audio_file
    - stream
    - websocket
  outputMode:
    - speaker
    - audio_file
    - stream
    - websocket
  transcriptionProvider: whisper-api
  ttsProvider: elevenlabs
  language: en-US
  voiceId: 21m00Tcm4TlvDq8ikWAM
  contextWindow: 10
  wakeWord: "hey ossa"
  audioFormat:
    sampleRate: 16000
    channels: 1
    encoding: pcm