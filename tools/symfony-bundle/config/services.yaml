services:
  _defaults:
    autowire: true
    autoconfigure: true
    public: false

  # ===================================================================
  # Core Agent Services
  # ===================================================================

  Ossa\SymfonyBundle\Agent\AgentRegistry:
    arguments:
      $config: '%ossa.config%'
    public: true

  Ossa\SymfonyBundle\Agent\AgentExecutor:
    arguments:
      $registry: '@Ossa\SymfonyBundle\Agent\AgentRegistry'
      $llmFactory: '@Ossa\SymfonyBundle\LLM\LLMProviderFactory'
      $logger: '@logger'
    tags:
      - { name: 'monolog.logger', channel: 'ossa' }

  Ossa\SymfonyBundle\Agent\AgentLoader:
    arguments:
      $manifestPaths: '%ossa.manifest_paths%'
      $autoDiscover: '%ossa.auto_discover%'

  # ===================================================================
  # LLM Provider Services
  # ===================================================================

  Ossa\SymfonyBundle\LLM\LLMProviderFactory:
    arguments:
      $providersConfig: '%ossa.providers%'
      $defaultProvider: '%ossa.default_provider%'

  Ossa\SymfonyBundle\LLM\Provider\AnthropicProvider:
    tags: ['ossa.llm_provider']

  Ossa\SymfonyBundle\LLM\Provider\OpenAIProvider:
    tags: ['ossa.llm_provider']

  Ossa\SymfonyBundle\LLM\Provider\GoogleProvider:
    tags: ['ossa.llm_provider']

  Ossa\SymfonyBundle\LLM\Provider\AzureProvider:
    tags: ['ossa.llm_provider']

  # ===================================================================
  # Validation Services
  # ===================================================================

  Ossa\SymfonyBundle\Validator\ManifestValidator:
    arguments:
      $schemaPath: '%kernel.project_dir%/vendor/ossa/symfony-bundle/schema/ossa-0.3.5.schema.json'

  Ossa\SymfonyBundle\Validator\SafetyValidator:
    arguments:
      $safetyConfig: '%ossa.safety%'

  # ===================================================================
  # MCP Tool Services
  # ===================================================================

  Ossa\SymfonyBundle\MCP\MCPToolRegistry:
    arguments:
      $mcpConfig: '%ossa.mcp%'

  Ossa\SymfonyBundle\MCP\MCPServerManager:
    arguments:
      $mcpConfig: '%ossa.mcp%'
      $logger: '@logger'
    tags:
      - { name: 'monolog.logger', channel: 'ossa.mcp' }

  # ===================================================================
  # Observability Services
  # ===================================================================

  Ossa\SymfonyBundle\Observability\TelemetryService:
    arguments:
      $observabilityConfig: '%ossa.observability%'
      $logger: '@logger'
    tags:
      - { name: 'monolog.logger', channel: 'ossa.telemetry' }

  Ossa\SymfonyBundle\Observability\CostTracker:
    arguments:
      $safetyConfig: '%ossa.safety%'

  # ===================================================================
  # Event Listeners
  # ===================================================================

  Ossa\SymfonyBundle\EventListener\AgentExecutionListener:
    tags:
      - { name: 'kernel.event_subscriber' }

  # ===================================================================
  # Console Commands
  # ===================================================================

  Ossa\SymfonyBundle\Command\AgentListCommand:
    arguments:
      $registry: '@Ossa\SymfonyBundle\Agent\AgentRegistry'
    tags:
      - { name: 'console.command', command: 'ossa:agent:list' }

  Ossa\SymfonyBundle\Command\AgentExecuteCommand:
    arguments:
      $executor: '@Ossa\SymfonyBundle\Agent\AgentExecutor'
      $registry: '@Ossa\SymfonyBundle\Agent\AgentRegistry'
    tags:
      - { name: 'console.command', command: 'ossa:agent:execute' }

  Ossa\SymfonyBundle\Command\AgentValidateCommand:
    arguments:
      $validator: '@Ossa\SymfonyBundle\Validator\ManifestValidator'
      $manifestPaths: '%ossa.manifest_paths%'
    tags:
      - { name: 'console.command', command: 'ossa:agent:validate' }

  Ossa\SymfonyBundle\Command\MCPServerListCommand:
    arguments:
      $mcpManager: '@Ossa\SymfonyBundle\MCP\MCPServerManager'
    tags:
      - { name: 'console.command', command: 'ossa:mcp:list' }
