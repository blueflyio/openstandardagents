# OSSA Website - GitLab Workspaces Configuration
# https://docs.gitlab.com/ee/user/workspace/
schemaVersion: 2.2.0
metadata:
  name: ossa-website
  version: 0.2.9
  displayName: OSSA Website Development
  description: Development environment for openstandardagents.org
  tags:
    - nextjs
    - typescript
    - ossa
  projectType: Next.js

components:
  - name: ossa-dev
    attributes:
      gl/inject-editor: true
    container:
      image: node:22-alpine
      memoryRequest: 1024M
      memoryLimit: 4096M
      cpuRequest: 500m
      cpuLimit: 2000m
      mountSources: true
      sourceMapping: /projects
      env:
        - name: NODE_ENV
          value: development
        - name: NEXT_TELEMETRY_DISABLED
          value: "1"
        - name: GITLAB_DUO_ENABLED
          value: "true"
      endpoints:
        - name: nextjs
          targetPort: 3000
          exposure: public
          protocol: https
      volumeMounts:
        - name: npm-cache
          path: /home/node/.npm
        - name: nextjs-cache
          path: /projects/website/.next

  - name: npm-cache
    volume:
      size: 2Gi

  - name: nextjs-cache
    volume:
      size: 1Gi

commands:
  - id: install
    exec:
      label: Install Dependencies
      component: ossa-dev
      workingDir: /projects/website
      commandLine: npm ci
      group:
        kind: build
        isDefault: false

  - id: dev
    exec:
      label: Start Dev Server
      component: ossa-dev
      workingDir: /projects/website
      commandLine: npm run dev
      group:
        kind: run
        isDefault: true

  - id: build
    exec:
      label: Build Production
      component: ossa-dev
      workingDir: /projects/website
      commandLine: npm run build
      group:
        kind: build
        isDefault: true

  - id: test
    exec:
      label: Run Tests
      component: ossa-dev
      workingDir: /projects/website
      commandLine: npm test
      group:
        kind: test
        isDefault: true

  - id: lint
    exec:
      label: Run Linter
      component: ossa-dev
      workingDir: /projects/website
      commandLine: npm run lint
      group:
        kind: test
        isDefault: false

  - id: typecheck
    exec:
      label: Type Check
      component: ossa-dev
      workingDir: /projects/website
      commandLine: npm run typecheck
      group:
        kind: test
        isDefault: false

  - id: ossa-validate
    exec:
      label: Validate OSSA Manifests
      component: ossa-dev
      workingDir: /projects
      commandLine: npx @bluefly/openstandardagents validate .agents/**/*.yaml .gitlab/agents/**/*.yaml
      group:
        kind: test
        isDefault: false

events:
  postStart:
    - install
