# OSSA v0.1.8 - Specialized Agent Services Configuration
# This compose file focuses on different types of OSSA agents

services:
  # Specialized Task Agent - Heavy computation tasks
  ossa-task-heavy:
    container_name: ossa-task-heavy
    image: ossa:task-agent
    build:
      context: ../..
      dockerfile: infrastructure/docker/Dockerfile.task-agent
    environment:
      - NODE_ENV=development
      - SERVICE_PORT=3004
      - AGENT_TYPE=task-heavy
      - AGENT_SPECIALIZATION=heavy_computation
      - MAX_CONCURRENT_TASKS=5
      - TASK_TIMEOUT=120000
      - REDIS_URL=redis://redis:6379
      - POSTGRES_URL=postgresql://ossa:ossa_dev_password@postgres:5432/ossa
      - GATEWAY_URL=http://ossa-gateway:3000
    ports:
      - "3004:3004"
    depends_on:
      - ossa-gateway
      - redis
    networks:
      - ossa-network
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
        reservations:
          memory: 512M
          cpus: '0.5'

  # Specialized Communication Agent - Multi-protocol support
  ossa-comm-multiprotocol:
    container_name: ossa-comm-multiprotocol
    image: ossa:comm-agent
    build:
      context: ../..
      dockerfile: infrastructure/docker/Dockerfile.comm-agent
    environment:
      - NODE_ENV=development
      - SERVICE_PORT=3005
      - AGENT_TYPE=communication-multiprotocol
      - SUPPORTED_PROTOCOLS=websocket,grpc,rest,graphql
      - WS_PORT=3105
      - GRPC_PORT=3205
      - REDIS_URL=redis://redis:6379
      - GATEWAY_URL=http://ossa-gateway:3000
    ports:
      - "3005:3005"
      - "3105:3105"  # WebSocket
      - "3205:3205"  # gRPC
    depends_on:
      - ossa-gateway
      - redis
    networks:
      - ossa-network

  # Specialized MCP Agent - Enhanced MCP Server
  ossa-mcp-enhanced:
    container_name: ossa-mcp-enhanced
    image: ossa:mcp-agent
    build:
      context: ../..
      dockerfile: infrastructure/docker/Dockerfile.mcp-agent
    environment:
      - NODE_ENV=development
      - SERVICE_PORT=3006
      - AGENT_TYPE=mcp-enhanced
      - MCP_VERSION=2.0
      - TOOL_REGISTRY_SIZE=500
      - AUTO_DISCOVERY=true
      - REDIS_URL=redis://redis:6379
      - GATEWAY_URL=http://ossa-gateway:3000
    ports:
      - "3006:3006"
    depends_on:
      - ossa-gateway
      - redis
    networks:
      - ossa-network
    volumes:
      - ../../examples/mcp-tools:/app/mcp-tools:ro

  # Data Processing Agent
  ossa-data-agent:
    container_name: ossa-data-agent
    image: ossa:data-agent
    build:
      context: ../..
      dockerfile: infrastructure/docker/Dockerfile.data-agent
    environment:
      - NODE_ENV=development
      - SERVICE_PORT=3007
      - AGENT_TYPE=data
      - PROCESSING_MODES=batch,stream,realtime
      - MAX_FILE_SIZE=100MB
      - SUPPORTED_FORMATS=json,csv,xml,yaml,parquet
      - REDIS_URL=redis://redis:6379
      - POSTGRES_URL=postgresql://ossa:ossa_dev_password@postgres:5432/ossa
      - QDRANT_URL=http://qdrant:6333
      - GATEWAY_URL=http://ossa-gateway:3000
    ports:
      - "3007:3007"
    depends_on:
      - ossa-gateway
      - redis
      - postgres
      - qdrant
    networks:
      - ossa-network
    volumes:
      - ../../data:/app/data

  # Analytics Agent
  ossa-analytics-agent:
    container_name: ossa-analytics-agent
    image: ossa:analytics-agent
    build:
      context: ../..
      dockerfile: infrastructure/docker/Dockerfile.analytics-agent
    environment:
      - NODE_ENV=development
      - SERVICE_PORT=3008
      - AGENT_TYPE=analytics
      - ANALYTICS_ENGINES=pandas,numpy,scipy,sklearn
      - VISUALIZATION_ENABLED=true
      - REPORT_FORMATS=pdf,html,json
      - REDIS_URL=redis://redis:6379
      - POSTGRES_URL=postgresql://ossa:ossa_dev_password@postgres:5432/ossa
      - QDRANT_URL=http://qdrant:6333
      - GATEWAY_URL=http://ossa-gateway:3000
    ports:
      - "3008:3008"
    depends_on:
      - ossa-gateway
      - redis
      - postgres
      - qdrant
    networks:
      - ossa-network

  # Security Agent
  ossa-security-agent:
    container_name: ossa-security-agent
    image: ossa:security-agent
    build:
      context: ../..
      dockerfile: infrastructure/docker/Dockerfile.security-agent
    environment:
      - NODE_ENV=development
      - SERVICE_PORT=3009
      - AGENT_TYPE=security
      - SECURITY_FEATURES=auth,encryption,audit,compliance
      - AUDIT_LOG_ENABLED=true
      - ENCRYPTION_LEVEL=AES-256
      - REDIS_URL=redis://redis:6379
      - POSTGRES_URL=postgresql://ossa:ossa_dev_password@postgres:5432/ossa
      - GATEWAY_URL=http://ossa-gateway:3000
    ports:
      - "3009:3009"
    depends_on:
      - ossa-gateway
      - redis
      - postgres
    networks:
      - ossa-network
    volumes:
      - ../../data/security:/app/security-data
      - ../../data/audit:/app/audit-logs

networks:
  ossa-network:
    external: true

volumes:
  agent-data:
  security-data:
  audit-logs: