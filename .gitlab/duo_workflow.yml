workflows:
  - name: mr-automation
    description: Automated MR review using existing BlueFly agents
    on:
      - merge_request_created
      - merge_request_updated
    
    steps:
      - name: ossa-validation
        agent: bot-ossa-validator
        description: Validate OSSA manifests and schema compliance
        when: |
          files.any(f => f.endsWith('.ossa.yaml') || f.includes('spec/'))
      
      - name: drupal-standards
        agent: bot-drupal-standards
        description: Check Drupal coding standards
        when: |
          files.any(f => f.endsWith('.module') || f.endsWith('.php'))
      
      - name: config-audit
        agent: bot-config-auditor
        description: Audit configuration changes
        when: |
          files.any(f => f.includes('config/') || f.endsWith('.yml'))
      
      - name: pipeline-check
        agent: bot-gitlab-ci-fixer
        description: Validate and fix CI/CD pipeline
        when: |
          files.any(f => f.includes('.gitlab-ci.yml') || f.includes('.gitlab/ci/'))
      
      - name: docs-sync
        agent: bot-wiki-aggregator
        description: Sync documentation changes
        when: |
          files.any(f => f.endsWith('.md') || f.includes('docs/'))
      
      - name: content-audit
        agent: bot-content-auditor
        description: Audit content quality
        when: |
          files.any(f => f.endsWith('.md'))
      
      - name: mr-review
        agent: bot-mr-reviewer
        description: Comprehensive MR review and approval
        depends_on:
          - ossa-validation
          - drupal-standards
          - config-audit
          - pipeline-check
        actions:
          - review_code
          - check_tests
          - validate_commits
          - auto_approve_if_passing

  - name: issue-automation
    description: Automated issue handling
    on:
      - issue_created
      - issue_updated
    
    steps:
      - name: issue-triage
        agent: bot-issue-worker
        description: Triage and assign issues
        actions:
          - classify_issue
          - assign_labels
          - assign_milestone
          - notify_team

  - name: component-workflow
    description: Component and module automation
    on:
      - merge_request_created
    
    steps:
      - name: component-analysis
        agent: bot-component-trainer
        description: Learn from component patterns
        when: |
          files.any(f => f.includes('components/'))
      
      - name: module-validation
        agent: bot-module-scaffolder
        description: Validate module structure
        when: |
          files.any(f => f.includes('modules/'))

  - name: recipe-workflow
    description: Drupal recipe automation
    on:
      - merge_request_created
    
    steps:
      - name: recipe-validation
        agent: bot-drupal-recipe-scaffolder
        description: Validate recipe structure
        when: |
          files.any(f => f.includes('recipes/'))
      
      - name: recipe-publish
        agent: bot-drupal-recipe-pub
        description: Publish validated recipes
        when: |
          mr.target_branch == 'main' && 
          files.any(f => f.includes('recipes/'))

agents:
  bot-ossa-validator:
    capabilities:
      - schema_validation
      - manifest_validation
      - compliance_checking
  
  bot-drupal-standards:
    capabilities:
      - phpcs_validation
      - drupal_best_practices
      - code_quality
  
  bot-config-auditor:
    capabilities:
      - config_validation
      - security_audit
      - breaking_change_detection
  
  bot-gitlab-ci-fixer:
    capabilities:
      - pipeline_validation
      - yaml_syntax_check
      - auto_fix_common_issues
  
  bot-wiki-aggregator:
    capabilities:
      - doc_sync
      - wiki_update
      - changelog_generation
  
  bot-content-auditor:
    capabilities:
      - markdown_validation
      - link_checking
      - content_quality
  
  bot-mr-reviewer:
    capabilities:
      - code_review
      - test_validation
      - auto_approval
      - merge_orchestration
  
  bot-issue-worker:
    capabilities:
      - issue_triage
      - label_assignment
      - milestone_assignment
      - team_notification
  
  bot-component-trainer:
    capabilities:
      - pattern_learning
      - component_analysis
  
  bot-module-scaffolder:
    capabilities:
      - module_validation
      - structure_checking
  
  bot-drupal-recipe-scaffolder:
    capabilities:
      - recipe_validation
      - dependency_checking
  
  bot-drupal-recipe-pub:
    capabilities:
      - recipe_publishing
      - version_management
