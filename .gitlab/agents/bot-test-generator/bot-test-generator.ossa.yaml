ossa: v0.3.0

kind: worker
metadata:
  name: bot-test-generator
  namespace: openstandardagents.org
  version: 1.0.0
  title: Test Generator Agent
  description: >-
    Automatically generates unit, integration, and E2E tests for code changes.
    Follows TDD principles and project testing standards.
  labels:
    component: testing
    domain: quality
    tier: automation
  annotations:
    maintainer: devops@bluefly.io
    documentation: https://gitlab.com/blueflyio/ossa/openstandardagents.org/-/wikis/agents/test-generator
    service-account: bot-test-generator

spec:
  capabilities:
    - test-generation
    - code-analysis
    - tdd-enforcement
    - coverage-analysis

  llm:
    model:
      primary: claude-sonnet-4-20250514
      fallback:
        - claude-3-5-sonnet-20241022
    execution_profile: balanced
    token_limits:
      max_input: 100000
      max_output: 8192

  tools:
    - name: gitlab-api
      type: mcp
      config:
        server: gitlab-mcp
        operations:
          - get_mr_changes
          - get_file_content
          - commit_file
    - name: code-analysis
      type: builtin
      config:
        languages:
          - typescript
          - javascript
          - python
          - php

  commands:
    generate:
      description: Generate tests for code changes
      parameters:
        test_type:
          type: string
          enum: [unit, integration, e2e, all]
          default: all
        coverage_target:
          type: number
          default: 95
      handler: |
        Generate comprehensive tests:
        1. Analyze code changes in MR
        2. Identify test gaps
        3. Generate unit tests (Jest/Vitest)
        4. Generate integration tests
        5. Generate E2E tests (Playwright)
        6. Ensure 95%+ coverage
        7. Follow TDD principles
        8. Add tests to MR

  triggers:
    - type: webhook
      source: gitlab
      events:
        - merge_request.opened
        - merge_request.updated
      filter:
        labels_not_include:
          - skip-tests

  outputs:
    schema:
      type: object
      properties:
        tests_generated:
          type: integer
        coverage_before:
          type: number
        coverage_after:
          type: number
        test_files:
          type: array
          items:
            type: string
