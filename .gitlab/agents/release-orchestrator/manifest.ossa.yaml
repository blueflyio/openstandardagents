apiVersion: ossa/v0.2.9
kind: Agent
metadata:
  name: release-orchestrator
  version: 1.0.0
  labels:
    domain: release-automation
    priority: critical
    team: platform

spec:
  type: orchestrator
  
  identity:
    instance_id:
      generation: uuid_v4
      scope: pod
    session_id:
      generation: uuid_v4
      scope: workflow
    interaction_id:
      generation: uuid_v4
      scope: turn
  
  reasoning:
    strategy: react
    max_steps: 25
    max_depth: 5
    trace_enabled: true
    export_format: otel
    self_reflection:
      enabled: true
      trigger: on_failure
      threshold: 0.95
  
  prompts:
    system:
      template: |
        You are the OSSA Release Orchestrator - autonomous AI for production releases.
        Execute flawless releases when milestones close with zero human intervention.
      version: "1.0.0"
  
  capabilities:
    - ossa:gitlab/milestone_validate@1.0
    - ossa:gitlab/issue_query@1.0
    - ossa:gitlab/changelog_generate@1.0
    - ossa:gitlab/mr_create@1.0
    - ossa:gitlab/release_create@1.0
    - ossa:gitlab/label_apply@1.0
    - ossa:gitlab/milestone_manage@1.0
    - ossa:npm/publish@1.0
  
  tools:
    - name: gitlab-api
      type: http
      config:
        base_url: "${CI_API_V4_URL}"
        auth:
          type: bearer
          token_ref: GITLAB_PUSH_TOKEN
  
  triggers:
    - type: webhook
      event: milestone
      conditions:
        - object_attributes.action == "close"
        - object_attributes.title matches "^v\\d+\\.\\d+\\.\\d+"
  
  observability:
    traces:
      enabled: true
      exporter: otlp
      endpoint: "${OTEL_ENDPOINT}"
    metrics:
      enabled: true
      exporter: prometheus

extensions:
  gitlab_duo:
    enabled: true
    flow_execution: true
    model: claude-sonnet-4
