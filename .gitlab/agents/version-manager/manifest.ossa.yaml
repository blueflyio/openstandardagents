apiVersion: ossa/v0.3.2
kind: Agent
metadata:
  name: version-manager
  version: 1.0.0
  description: |
    Automated version management agent for OSSA project.
    Handles version bumping, synchronization, documentation updates,
    and GitLab integration. Demonstrates OSSA "dogfooding" by managing
    OSSA's own version lifecycle.
  labels:
    environment: production
    team: platform
    domain: version-management
    capability: version-automation
    dogfood: "true"
    ossa-version: v0.3.0
  annotations:
    documentation: https://openstandardagents.org/docs/agents/version-manager
    support: platform@bluefly.io
    runbook: https://openstandardagents.org/docs/runbooks/version-manager
    gitlab-agent: "true"
spec:
  taxonomy:
    domain: infrastructure
    subdomain: version-management
    capability: semantic_versioning
  role: |
    You are an expert version management agent specializing in semantic versioning
    and automated version synchronization across large codebases.

    Your responsibilities:
    1. Bump versions (major, minor, patch, rc, release) based on GitLab milestones
    2. Synchronize version references across all project files:
       - package.json, website/package.json
       - README.md badges and links
       - Documentation files (website/content/docs/**/*.md)
       - OpenAPI specifications
       - CHANGELOG.md
       - RELEASING.md
    3. Process {{VERSION}} placeholders in documentation templates
    4. Create spec directories for new versions
    5. Validate version consistency across all files
    6. Create GitLab merge requests for version updates
    7. Integrate with GitLab milestones for release coordination
    8. Generate version bump commits with proper conventional commits

    Version Bump Types:
    - major: Breaking changes (1.0.0 → 2.0.0)
    - minor: New features (1.0.0 → 1.1.0)
    - patch: Bug fixes (1.0.0 → 1.0.1)
    - rc: Release candidate (1.0.0 → 1.0.1-RC)
    - release: Promote RC to stable (1.0.1-RC → 1.0.1)

    Always:
    - Read .version.json as single source of truth
    - Validate version format (semver)
    - Check for version inconsistencies before bumping
    - Create atomic commits for version changes
    - Update all files in a single transaction
    - Verify changes before committing
  llm:
    provider: ${LLM_PROVIDER:-anthropic}
    model: ${LLM_MODEL:-claude-sonnet}
    temperature: 0
    maxTokens: 4000
    topP: 0.9
    fallback_models:
      - provider: ${LLM_FALLBACK_PROVIDER_1:-openai}
        model: ${LLM_FALLBACK_MODEL_1:-gpt-4o}
      - provider: ${LLM_FALLBACK_PROVIDER_2:-anthropic}
        model: ${LLM_FALLBACK_MODEL_2:-claude-haiku}
    retry_config:
      max_attempts: 3
      backoff_strategy: exponential
    cost_tracking:
      enabled: true
      budget_alert_threshold: 5
      cost_allocation_tags:
        project: ossa-agents
        team: platform
        service: version-manager
  tools:
    - type: http
      name: gitlab-api
      description: |
        GitLab API integration for milestone management, MR creation, and
        version tag operations.
      endpoint: ${GITLAB_API_URL:-https://gitlab.com/api/v4}
      config:
        method: POST
        timeout: 30
      auth:
        type: bearer
        tokenPath: /var/secrets/gitlab-token
    - type: function
      name: version-bump
      description: |
        Execute version bump operation using npm run version:bump
      config:
        handler: version_bump_handler
        timeout: 60
    - type: function
      name: version-sync
      description: |
        Synchronize version references across all files using npm run version:sync
      config:
        handler: version_sync_handler
        timeout: 120
    - type: function
      name: docs-process
      description: |
        Process documentation templates using npm run docs:process
      config:
        handler: docs_process_handler
        timeout: 60
    - type: function
      name: git-operations
      description: |
        Git operations (commit, push, create branch, create MR)
      config:
        handler: git_operations_handler
        timeout: 30
    - type: mcp
      server: filesystem
      capabilities:
        - read_file
        - write_file
        - list_directory
        - file_exists
  autonomy:
    level: supervised
    approval_required: true
    allowed_actions:
      - read_version_files
      - validate_version_consistency
      - create_version_branch
      - bump_version
      - sync_versions
      - process_docs
      - create_commit
    blocked_actions:
      - push_to_main
      - push_to_development
      - create_git_tag
      - publish_to_npm
  constraints:
    cost:
      maxTokensPerDay: 10000
      maxCostPerDay: 1
      currency: USD
    performance:
      maxLatencySeconds: 300
      maxConcurrentRequests: 1
      timeoutSeconds: 300
    time:
      maxExecutionTime: 600
  observability:
    tracing:
      enabled: true
      exporter: otlp
      endpoint: http://jaeger:4317
    metrics:
      enabled: true
      exporter: prometheus
      endpoint: http://prometheus:9090/metrics
    logging:
      level: info
      format: json
      outputs:
        - type: console
        - type: file
          config:
            path: /var/log/version-manager.log
            rotation: daily
            max_files: 7
extensions:
  gitlab:
    agent:
      enabled: true
      config:
        project_id: ${CI_PROJECT_ID}
        api_url: ${CI_API_V4_URL}
        token: ${SERVICE_ACCOUNT_VERSION_MANAGER_TOKEN:-${GITLAB_TOKEN}}
      service_account:
        name: version-manager-service-account
        namespace: version-management
        token: ${SERVICE_ACCOUNT_VERSION_MANAGER_TOKEN}
      capabilities:
        - version_bump
        - version_sync
        - milestone_integration
        - mr_creation
        - tag_management
  kubernetes:
    deployment:
      namespace: version-management
      replicas: 1
      resources:
        requests:
          cpu: 100m
          memory: 256Mi
        limits:
          cpu: 500m
          memory: 512Mi
    service:
      type: ClusterIP
      port: 8080
    ingress:
      enabled: false
  kagent:
    api_version: kagent.dev/v1alpha2
    kubernetes:
      namespace: agent-system
      labels:
        app.kubernetes.io/name: version-manager
        app.kubernetes.io/part-of: ossa-showcase
        openstandardagents.org/version: v0.3.0
      resourceLimits:
        cpu: "1"
        memory: 2Gi
    deployment:
      replicas:
        min: 1
        max: 3
      strategy: rolling-update
    a2aConfig:
      enabled: true
      protocol: json-rpc
    meshIntegration:
      enabled: true
      istioIntegration: true
  gitlab_duo:
    enabled: true
    flow_execution: true
    model: ${GITLAB_DUO_MODEL:-claude-sonnet-4.5-20250929}
    knowledge_graph:
      enabled: true
      index_on_push: true
  mcp:
    enabled: true
    server_type: stdio
    server_name: version-manager-mcp
