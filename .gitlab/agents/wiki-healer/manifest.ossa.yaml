apiVersion: ossa/v0.3.3
kind: Agent
metadata:
  name: wiki-healer
  version: 1.0.0
  description: |
    Documentation aggregation and healing agent. Monitors and maintains
    documentation quality across GitLab wikis, README files, and docs
    repositories. Detects staleness, generates updates, and ensures
    documentation completeness.
  labels:
    environment: production
    team: documentation
    domain: docs
    capability: documentation_healing
    wave: "5"
  annotations:
    documentation: https://openstandardagents.org/docs/agents/wiki-healer
    support: ops@openstandardagents.org
    gitlab-handle: "@bot-wiki-aggregator"
    category: Docs
    ossa.io/migration: v0.3.3-to-v0.3.3
    ossa.io/migrated-date: 2026-01-07
spec:
  taxonomy:
    domain: documentation
    subdomain: knowledge-management
    capability: wiki_aggregation
  role: |
    You are an expert documentation healer specializing in maintaining
    documentation quality and completeness across distributed systems.

    Your responsibilities:
    1. Scan GitLab wikis and README files for stale content
    2. Aggregate documentation from multiple repositories
    3. Identify missing documentation coverage
    4. Generate documentation updates from code changes
    5. Sync documentation across wikis and repositories
    6. Validate documentation accuracy against implementation
    7. Create merge requests for documentation improvements

    When detecting documentation issues:
    - Compare timestamps against code changes
    - Check for broken internal links
    - Validate code examples still work
    - Identify undocumented public APIs
    - Detect inconsistencies across documentation sources
  llm:
    provider: anthropic
    model: claude-3-5-sonnet-20241022
    temperature: 0.3
    maxTokens: 8000
  tools:
    - type: mcp
      name: gitlab-wiki
      description: |
        Access and modify GitLab wiki pages. Supports reading, creating,
        and updating wiki content across projects.
      config:
        server: gitlab-mcp
        scope: wiki
      auth:
        type: bearer
        tokenPath: /var/secrets/gitlab-token
    - type: mcp
      name: filesystem
      description: |
        Read README files, documentation directories, and code files
        to analyze documentation coverage.
      config:
        server: filesystem-mcp
        allowed_paths:
          - "*.md"
          - docs/**
          - website/**
          - "*.rst"
    - type: http
      name: markdown-lint
      description: |
        Validate markdown formatting and detect broken links.
      endpoint: http://markdown-lint:8080/lint
      config:
        method: POST
        timeout: 60
    - type: a2a
      name: agent-mesh
      description: |
        Communicate with other agents (doc-agent, spec-healer) for
        coordinated documentation updates.
      endpoint: http://agent-mesh:9090/a2a
      config:
        protocol: json-rpc
        version: "2.0"
  capabilities:
    - name: scan_wikis
      description: Scan GitLab wikis for stale or missing content
      input_schema:
        type: object
        properties:
          project_ids:
            type: array
            items:
              type: string
            description: List of GitLab project IDs to scan
          staleness_threshold_days:
            type: integer
            default: 90
            description: Days since last update to consider stale
        required:
          - project_ids
      output_schema:
        type: object
        properties:
          stale_pages:
            type: array
            items:
              type: object
              properties:
                project_id:
                  type: string
                page_slug:
                  type: string
                last_updated:
                  type: string
                  format: date-time
          missing_coverage:
            type: array
            items:
              type: string
          success:
            type: boolean
    - name: aggregate_docs
      description: Aggregate documentation from multiple sources
      input_schema:
        type: object
        properties:
          sources:
            type: array
            items:
              type: object
              properties:
                type:
                  type: string
                  enum:
                    - wiki
                    - readme
                    - docs_dir
                    - external
                location:
                  type: string
        required:
          - sources
      output_schema:
        type: object
        properties:
          aggregated_index:
            type: object
          total_pages:
            type: integer
          success:
            type: boolean
    - name: detect_staleness
      description: Detect stale documentation by comparing with code changes
      input_schema:
        type: object
        properties:
          doc_path:
            type: string
          code_paths:
            type: array
            items:
              type: string
        required:
          - doc_path
          - code_paths
      output_schema:
        type: object
        properties:
          is_stale:
            type: boolean
          code_changes_since_doc_update:
            type: integer
          affected_sections:
            type: array
            items:
              type: string
          success:
            type: boolean
    - name: generate_updates
      description: Generate documentation updates from code changes
      input_schema:
        type: object
        properties:
          code_diff:
            type: string
          doc_path:
            type: string
        required:
          - code_diff
          - doc_path
      output_schema:
        type: object
        properties:
          suggested_updates:
            type: string
          confidence:
            type: number
            minimum: 0
            maximum: 1
          success:
            type: boolean
    - name: sync_wiki
      description: Sync documentation to GitLab wiki
      input_schema:
        type: object
        properties:
          source_dir:
            type: string
          wiki_project_id:
            type: string
        required:
          - source_dir
          - wiki_project_id
      output_schema:
        type: object
        properties:
          pages_synced:
            type: integer
          pages_created:
            type: integer
          pages_updated:
            type: integer
          success:
            type: boolean
  triggers:
    - type: schedule
      name: weekly_audit
      schedule: 0 8 * * 1
      description: Weekly documentation completeness audit
    - type: webhook
      name: on_merge
      event: merge_request_merged
      description: Check documentation after code merges
    - type: webhook
      name: on_release
      event: release_created
      description: Generate release documentation
  autonomy:
    level: supervised
    approval_required: true
    allowed_actions:
      - scan_wikis
      - aggregate_docs
      - detect_staleness
      - generate_updates
      - create_merge_requests
    blocked_actions:
      - delete_wiki_pages
      - force_push
  constraints:
    cost:
      maxTokensPerDay: 200000
      maxTokensPerRequest: 8000
      maxCostPerDay: 20
      currency: USD
    performance:
      maxLatencySeconds: 60
      maxConcurrentRequests: 5
      timeoutSeconds: 300
    resources:
      cpu: 1000m
      memory: 2Gi
      ephemeralStorage: 5Gi
  observability:
    tracing:
      enabled: true
      exporter: otlp
      endpoint: http://jaeger-collector:4318
      samplingRate: 0.5
    metrics:
      enabled: true
      exporter: prometheus
      endpoint: http://prometheus:9090/metrics
      customMetrics:
        - name: wiki_pages_scanned
          type: counter
          description: Total wiki pages scanned
        - name: stale_docs_detected
          type: gauge
          description: Number of stale documentation pages
        - name: docs_updated
          type: counter
          description: Documentation pages updated
    logging:
      level: info
      format: json
  state:
    backend: redis
    config:
      host: redis-cluster.default.svc.cluster.local
      port: 6379
      database: 3
      ttl: 604800
      keyPrefix: "wiki-healer:"
