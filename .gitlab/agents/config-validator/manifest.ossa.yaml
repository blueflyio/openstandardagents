apiVersion: ossa/v0.3.3
kind: Agent
metadata:
  name: config-validator
  version: 1.0.0
  description: >
    Automated configuration validation agent for Kubernetes manifests, Helm
    charts,

    and application configs. Detects misconfigurations, policy violations, and

    security risks before deployment to production clusters.
  labels:
    environment: production
    team: platform-engineering
    domain: configuration
    capability: policy-enforcement
    dora-metric: change-failure-rate
    ossa-version: v0.3.0
  annotations:
    documentation: https://openstandardagents.org/docs/agents/config-validator
    support: ops@openstandardagents.org
    runbook: https://openstandardagents.org/docs/runbooks/config-validator
    policies: OPA, Gatekeeper, Pod Security Standards
    ossa.io/migration: v0.3.3-to-v0.3.3
    ossa.io/migrated-date: 2026-01-07
spec:
  taxonomy:
    domain: infrastructure
    subdomain: policy-enforcement
    capability: validation
  role: >
    You are an expert Kubernetes configuration validator specializing in policy
    enforcement.


    Your responsibilities:

    1. Validate Kubernetes manifests against schema and best practices

    2. Lint Helm charts and detect templating errors

    3. Enforce OPA/Gatekeeper policies (resource limits, labels, security
    contexts)

    4. Detect hardcoded secrets in ConfigMaps and environment variables

    5. Validate resource limits and requests (CPU, memory)

    6. Check network policies for egress/ingress rules

    7. Verify RBAC configurations for least privilege

    8. Ensure Pod Security Standards compliance (restricted/baseline)


    For each violation:

    - Severity (critical/high/medium/low)

    - Policy violated (OPA rule, PSS requirement, best practice)

    - Affected resource (namespace/name)

    - Remediation (specific fix required)

    - Auto-fix available (yes/no)
  llm:
    provider: ${LLM_PROVIDER:-openai}
    model: ${LLM_MODEL:-gpt-4o}
    temperature: 0.1
    maxTokens: 5000
    topP: 0.9
    fallback_models:
      - provider: ${LLM_FALLBACK_PROVIDER_1:-anthropic}
        model: ${LLM_FALLBACK_MODEL_1:-claude-sonnet}
      - provider: ${LLM_FALLBACK_PROVIDER_2:-openai}
        model: ${LLM_FALLBACK_MODEL_2:-gpt-4o-mini}
    retry_config:
      max_attempts: 3
      backoff_strategy: exponential
    cost_tracking:
      enabled: true
      budget_alert_threshold: 20
      cost_allocation_tags:
        project: ossa-agents
        team: platform-engineering
        service: config-validator
  tools:
    - type: mcp
      name: kubernetes-validator
      description: >
        Validate Kubernetes manifests using kubectl --dry-run and schema
        validation.
      config:
        server: kubernetes-mcp
        validationMode: strict
      auth:
        type: mtls
        certPath: /var/secrets/k8s-client-cert.pem
    - type: http
      name: opa-policy-engine
      description: |
        Validate configs against Open Policy Agent (OPA) policies.
      endpoint: http://opa-server:8181/v1/data
      config:
        method: POST
        timeout: 10
      auth:
        type: bearer
        tokenPath: /var/secrets/opa-token
    - type: function
      name: helm-linter
      description: |
        Lint Helm charts for syntax errors and best practices.
      config:
        handler: helm_lint_handler
        strict: true
    - type: a2a
      name: security-scanner
      description: |
        Coordinate with security-scanner for secret detection.
      endpoint: http://security-scanner:8080/a2a
      config:
        protocol: json-rpc
      auth:
        type: mtls
        certPath: /var/secrets/a2a-client-cert.pem
  autonomy:
    level: autonomous
    approval_required: false
    allowed_actions:
      - validate_kubernetes_manifests
      - lint_helm_charts
      - check_opa_policies
      - detect_secrets_in_configs
      - generate_validation_reports
    blocked_actions:
      - apply_configurations
      - modify_opa_policies
  constraints:
    cost:
      maxTokensPerDay: 200000
      maxTokensPerRequest: 5000
      maxCostPerDay: 20
      currency: USD
    performance:
      maxLatencySeconds: 30
      maxConcurrentRequests: 50
      timeoutSeconds: 60
    resources:
      cpu: 500m
      memory: 1Gi
  observability:
    tracing:
      enabled: true
      exporter: otlp
      endpoint: http://jaeger-collector:4318
    metrics:
      enabled: true
      exporter: prometheus
      endpoint: http://prometheus:9090/metrics
      customMetrics:
        - name: validations_total
          type: counter
          description: Total configuration validations
          labels:
            - status
            - severity
        - name: policy_violations_total
          type: counter
          description: Total policy violations detected
          labels:
            - policy
            - resource_type
    logging:
      level: info
      format: json
  state:
    backend: redis
    config:
      host: redis-cluster.default.svc.cluster.local
      port: 6379
      database: 4
      ttl: 86400
      keyPrefix: "config-validator:"
  extensions:
    kagent:
      kubernetes:
        namespace: platform-system
        labels:
          app: config-validator
          team: platform-engineering
        resourceLimits:
          cpu: 500m
          memory: 1Gi
        serviceAccount: config-validator-sa
      guardrails:
        requireApproval: false
        allowedActions:
          - kubernetes:validate:*
          - opa:evaluate:*
      a2aConfig:
        enabled: true
        protocol: json-rpc
        endpoints:
          - http://security-scanner:8080/a2a
        authentication:
          type: mtls
      meshIntegration:
        enabled: true
        istioIntegration: true
        mtlsMode: STRICT
extensions:
  kagent:
    api_version: kagent.dev/v1alpha2
    kubernetes:
      namespace: agent-system
      labels:
        app.kubernetes.io/name: config-validator
        app.kubernetes.io/part-of: ossa-showcase
        openstandardagents.org/version: v0.3.0
      resourceLimits:
        cpu: "1"
        memory: 2Gi
    deployment:
      replicas:
        min: 1
        max: 3
      strategy: rolling-update
    a2aConfig:
      enabled: true
      protocol: json-rpc
    meshIntegration:
      enabled: true
      istioIntegration: true
  gitlab_duo:
    enabled: true
    flow_execution: true
    model: ${GITLAB_DUO_MODEL:-claude-sonnet-4.5-20250929}
    knowledge_graph:
      enabled: true
      index_on_push: true
  mcp:
    enabled: true
    server_type: stdio
    server_name: config-validator-mcp
