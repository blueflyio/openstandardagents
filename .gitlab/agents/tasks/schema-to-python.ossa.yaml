# ═══════════════════════════════════════════════════════════════════════════════
# Task: Generate Python Pydantic Models from JSON Schema
# ═══════════════════════════════════════════════════════════════════════════════
#
# This is a DETERMINISTIC task - no LLM required.
# Input: JSON Schema file
# Output: Python Pydantic models with type hints
#
# ═══════════════════════════════════════════════════════════════════════════════

apiVersion: ossa/v0.3.2
kind: Task
metadata:
  name: schema-to-python
  version: 1.0.0
  description: Generate Python Pydantic models from OSSA JSON Schema
  labels:
    category: code-generation
    language: python
    deterministic: "true"

spec:
  execution:
    type: deterministic
    runtime: node
    timeout_seconds: 60

  capabilities:
    - read_file
    - write_file
    - json_parse
    - code_generation

  input:
    type: object
    required: [schema_path, output_path]
    properties:
      schema_path:
        type: string
        description: Path to JSON Schema file
        examples:
          - spec/v0.3.0/ossa-0.3.0.schema.json
      output_path:
        type: string
        description: Path for generated Python file
        examples:
          - sdks/python/ossa/types.py
      generator:
        type: string
        enum: [pydantic, dataclass, typed_dict]
        default: pydantic
        description: Python type generation strategy

  output:
    type: object
    properties:
      generated_file:
        type: string
        description: Path to generated file
      types_count:
        type: integer
        description: Number of types generated
      definitions:
        type: array
        items:
          type: string
        description: List of generated type names

  error_handling:
    on_error: fail
    error_mapping:
      SCHEMA_NOT_FOUND: fail
      PARSE_ERROR: fail
      WRITE_ERROR: retry

# Runtime binding for Node.js execution
runtime:
  type: node
  bindings:
    read_file:
      handler: fs.readFileSync
    write_file:
      handler: fs.writeFileSync
    json_parse:
      handler: JSON.parse
    code_generation:
      handler: "./scripts/schema-to-python.js"
      config:
        template: pydantic
        include_validators: true
        include_examples: true
