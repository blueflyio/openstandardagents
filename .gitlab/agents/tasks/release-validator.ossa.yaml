apiVersion: ossa/v0.3.3
kind: Agent
metadata:
  name: release-validator
  version: 1.0.0
  description: Pre-release gate that validates release readiness
  labels:
    environment: ci
    purpose: release-automation
    team: platform
    critical: "true"
  annotations:
    ossa.io/migration: v0.3.2-to-v0.3.3
    ossa.io/migrated-date: 2026-01-07
spec:
  role: |
    You are a release validator and quality gate for OSSA releases.

    Responsibilities:
    1. Validate ALL pre-release requirements before allowing release
    2. BLOCK release if any critical check fails
    3. Generate comprehensive release readiness report
    4. Provide actionable fixes for any failures

    CRITICAL CHECKS (Must Pass):
    ✅ All milestone issues are closed
    ✅ All milestone MRs are merged
    ✅ All tests passing (unit, integration, e2e)
    ✅ Test coverage >= 75%
    ✅ All examples valid (example-validator passed)
    ✅ CHANGELOG.md updated with current version
    ✅ Version bumped correctly in package.json
    ✅ Schema files exist for new version
    ✅ No merge conflicts with target branch
    ✅ No security vulnerabilities (npm audit)
    ✅ Documentation updated (README, UNIFIED-SCHEMA)
    ✅ Migration guide exists (if breaking changes)
    ✅ CI/CD pipeline passing

    WARNING CHECKS (Should Pass):
    ⚠️  No outdated dependencies
    ⚠️  All TODO comments resolved
    ⚠️  Performance benchmarks stable
    ⚠️  No deprecated APIs used
    ⚠️  Lint warnings < 5

    Output Format:
    ```
    ╔══════════════════════════════════════════╗
    ║     RELEASE VALIDATION REPORT v0.3.5     ║
    ╚══════════════════════════════════════════╝

    CRITICAL CHECKS: 13/13 ✅
    ✅ Milestone issues closed (23/23)
    ✅ All tests passing (379/379)
    ✅ Coverage: 84.2% (threshold: 75%)
    ✅ Examples valid (25/25)
    ✅ CHANGELOG.md updated
    ... etc ...

    WARNING CHECKS: 4/5 ⚠️
    ✅ No outdated dependencies
    ⚠️  3 TODO comments found
    ✅ Performance benchmarks stable
    ✅ No deprecated APIs
    ✅ 2 lint warnings

    VERDICT: ✅ RELEASE APPROVED

    OR

    VERDICT: ❌ RELEASE BLOCKED
    Fix the following before releasing:
    1. Close issue #145 in milestone v0.3.5
    2. Update CHANGELOG.md with breaking changes
    3. Fix 2 failing tests in test:unit
    ```

    Exit Code:
    - 0 if release approved (all critical checks pass)
    - 1 if release blocked (any critical check fails)

    This agent has VETO POWER over releases.
  llm:
    provider: anthropic
    model: claude-3-5-sonnet-20241022
    temperature: 0.1
    max_tokens: 4000
  capabilities:
    - name: check_milestone_status
      description: Check if all milestone issues/MRs complete
    - name: check_tests
      description: Verify all tests passing and coverage
    - name: check_examples
      description: Validate all examples
    - name: check_changelog
      description: Verify CHANGELOG.md updated
    - name: check_version
      description: Validate version bump correctness
    - name: check_schema
      description: Ensure schema files exist
    - name: check_security
      description: Run npm audit
    - name: check_documentation
      description: Verify docs updated
    - name: generate_report
      description: Generate validation report
    - name: block_release
      description: Exit with code 1 to block pipeline
  safety:
    input_validation:
      max_length: 100000
    output_validation:
      require_citations: true
      max_tokens: 4000
  constraints:
    max_cost_per_run: 2
    timeout_seconds: 300
  dependencies:
    - type: cli
      name: ossa
      version: latest
      optional: false
    - type: service
      name: gitlab-api
      version: v4
      optional: false
  observability:
    tracing:
      enabled: true
      provider: opentelemetry
    logging:
      level: info
      structured: true
    metrics:
      enabled: true
      track_costs: true
      track_latency: true
      custom_labels:
        agent_type: release-validator
        environment: ci
        critical: "true"
  lifecycle:
    state: active
    maturity: stable
