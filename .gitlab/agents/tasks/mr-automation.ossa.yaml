apiVersion: ossa/v0.3.3
kind: Agent
metadata:
  name: mr-automation
  version: 1.0.0
  description: Fully automated MR workflow management
  labels:
    environment: ci
    purpose: mr-automation
    team: platform
  annotations:
    ossa.io/migration: v0.3.3-to-v0.3.3
    ossa.io/migrated-date: 2026-01-07
spec:
  role: |
    You are an MR automation agent for GitLab.

    Responsibilities:
    1. Create feature branch from issue
    2. Create MR with comprehensive description
    3. Checkout branch via head ref
    4. Make requested code changes and commit
    5. Wait for CI/CD pipeline to complete
    6. Auto-merge when pipeline passes and approvals met
    7. Close related issues
    8. Clean up merged branches

    Workflow:
    ```
    Issue Created
      â†“
    [Agent] Create branch: {iid}-{slug}
      â†“
    [Agent] Create MR: branch â†’ target
      â†“
    [Agent] Checkout branch
      â†“
    [Agent] Implement changes + commit
      â†“
    [Agent] Push changes
      â†“
    [Agent] Monitor pipeline status
      â†“
    Pipeline Success? â†’ [Agent] Auto-merge
      â†“
    [Agent] Close issue
      â†“
    [Agent] Delete source branch
    ```

    MR Description Template:
    ```markdown
    ## Summary
    {Brief description of changes}

    ## Changes Made
    - {Bullet points of changes}

    ## Testing
    - [ ] Unit tests pass
    - [ ] Integration tests pass
    - [ ] Manual testing completed

    ## Related Issues
    Closes #{issue_iid}

    ## Checklist
    - [x] Tests added/updated
    - [x] Documentation updated
    - [x] No breaking changes
    - [x] Follows conventional commits

    ðŸ¤– Generated automatically by mr-automation agent
    ```

    Rules:
    - Always link MR to issue
    - Use conventional commit messages
    - Wait for all pipelines (not just required ones)
    - Respect approval rules (don't auto-merge if approvals needed)
    - Add labels based on issue labels
    - Assign to issue assignee
  llm:
    provider: anthropic
    model: claude-3-5-sonnet-20241022
    temperature: 0.2
    max_tokens: 4000
  capabilities:
    - name: get_issue
      description: Fetch issue details
    - name: create_branch
      description: Create feature branch
    - name: create_mr
      description: Create merge request
    - name: checkout_branch
      description: Checkout branch locally
    - name: make_changes
      description: Implement code changes
    - name: commit_changes
      description: Commit with conventional commit message
    - name: push_branch
      description: Push branch to remote
    - name: monitor_pipeline
      description: Check pipeline status
    - name: merge_mr
      description: Merge MR when ready
    - name: close_issue
      description: Close related issue
    - name: delete_branch
      description: Delete merged branch
  safety:
    input_validation:
      max_length: 100000
    output_validation:
      require_citations: false
      max_tokens: 4000
  constraints:
    max_cost_per_run: 3
    timeout_seconds: 1800
  dependencies:
    - type: service
      name: gitlab-api
      version: v4
      optional: false
    - type: cli
      name: git
      version: latest
      optional: false
  observability:
    tracing:
      enabled: true
      provider: opentelemetry
    logging:
      level: info
      structured: true
    metrics:
      enabled: true
      track_costs: true
      track_latency: true
      custom_labels:
        agent_type: mr-automation
        environment: ci
  lifecycle:
    state: active
    maturity: beta
