apiVersion: ossa/v0.3.3
kind: Agent
metadata:
  name: changelog-generator
  version: 1.0.0
  description: Automated changelog generation from commits
  labels:
    environment: ci
    purpose: release-automation
    team: platform
  annotations:
    ossa.io/migration: v0.3.2-to-v0.3.3
    ossa.io/migrated-date: 2026-01-07
spec:
  role: |
    You are a changelog generator for OSSA releases.

    Responsibilities:
    1. Parse all commits since last release tag
    2. Group commits by type (feat, fix, docs, chore, refactor, test, perf)
    3. Generate structured CHANGELOG.md in Keep a Changelog format
    4. Link to relevant issues and MRs using #XXX and !YYY syntax
    5. Highlight breaking changes with ⚠️ BREAKING CHANGE markers
    6. Include migration guides for breaking changes
    7. Add contributor credits

    Output Format:
    ```markdown
    ## [Version] - YYYY-MM-DD

    ### Added
    - New features (#issue)

    ### Changed
    - Changes to existing functionality (#issue)

    ### Fixed
    - Bug fixes (!mr)

    ### Deprecated
    - Soon-to-be removed features

    ### Removed
    - Removed features

    ### Security
    - Security fixes

    ### ⚠️ BREAKING CHANGES
    - Breaking changes with migration guide
    ```

    Rules:
    - Follow conventional commits specification
    - Use present tense ("Add feature" not "Added feature")
    - Group related changes together
    - Always link to issues/MRs
    - Include "Thanks @username" for external contributors
  llm:
    provider: anthropic
    model: claude-3-5-sonnet-20241022
    temperature: 0.2
    max_tokens: 4000
  capabilities:
    - name: get_commits
      description: Get commits since last release
    - name: parse_commit_message
      description: Parse conventional commit format
    - name: get_issue_details
      description: Fetch issue details from GitLab
    - name: get_mr_details
      description: Fetch MR details from GitLab
    - name: write_changelog
      description: Write CHANGELOG.md file
  safety:
    input_validation:
      max_length: 100000
    output_validation:
      require_citations: true
      max_tokens: 4000
  constraints:
    max_cost_per_run: 2
    timeout_seconds: 300
  dependencies:
    - type: service
      name: gitlab-api
      version: v4
      optional: false
  observability:
    tracing:
      enabled: true
      provider: opentelemetry
    logging:
      level: info
      structured: true
    metrics:
      enabled: true
      track_costs: true
      track_latency: true
      custom_labels:
        agent_type: changelog-generator
        environment: ci
  lifecycle:
    state: active
    maturity: stable
