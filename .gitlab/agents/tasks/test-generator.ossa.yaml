apiVersion: ossa/v0.3.0
kind: Agent
metadata:
  name: test-generator
  version: "1.0.0"
  description: Automated test case generation for agents and schemas
  labels:
    environment: ci
    purpose: testing
    team: platform

spec:
  role: |
    You are a test generator agent for OSSA.

    Responsibilities:
    1. Generate comprehensive test suites for agents and schemas
    2. Create unit tests for all agent capabilities
    3. Generate integration tests for multi-agent workflows
    4. Create validation tests for schema compliance
    5. Generate performance/load tests
    6. Create security test cases (injection, traversal, etc.)
    7. Generate edge case and error handling tests
    8. Ensure test coverage >= 80%

    Test Categories to Generate:
    - Unit Tests (Jest/Vitest)
      - Agent manifest validation
      - Schema field validation
      - Function/capability tests
      - Error handling
    - Integration Tests
      - Agent-to-agent communication
      - LLM provider integration
      - External API integration
    - E2E Tests
      - Full workflow execution
      - Multi-agent orchestration
      - Real-world scenarios
    - Performance Tests
      - Latency benchmarks
      - Token usage tracking
      - Cost optimization
    - Security Tests
      - Input validation
      - Injection attacks
      - Path traversal
      - Rate limiting

    Test Quality Rules:
    - Use descriptive test names
    - Follow AAA pattern (Arrange, Act, Assert)
    - Mock external dependencies
    - Test both success and failure paths
    - Include edge cases
    - Add performance assertions
    - Document test purpose

    Output: Complete test files ready to commit

  llm:
    provider: anthropic
    model: claude-3-5-sonnet-20241022
    temperature: 0.3
    max_tokens: 8000

  capabilities:
    - name: analyze_code
      description: Analyze code to identify testable units
    - name: generate_unit_tests
      description: Generate Jest/Vitest unit tests
    - name: generate_integration_tests
      description: Generate integration tests
    - name: generate_e2e_tests
      description: Generate end-to-end tests
    - name: generate_perf_tests
      description: Generate performance tests
    - name: generate_security_tests
      description: Generate security tests
    - name: calculate_coverage
      description: Calculate test coverage percentage
    - name: write_test_file
      description: Write test file to disk

  safety:
    input_validation:
      max_length: 200000
    output_validation:
      require_citations: false
      max_tokens: 8000

  constraints:
    max_cost_per_run: 5.00
    timeout_seconds: 600

  dependencies:
    - type: cli
      name: jest
      version: latest
      optional: false
    - type: cli
      name: ossa
      version: latest
      optional: false

  observability:
    tracing:
      enabled: true
      provider: opentelemetry
    logging:
      level: info
      structured: true
    metrics:
      enabled: true
      track_costs: true
      track_latency: true
      custom_labels:
        agent_type: test-generator
        environment: ci

  lifecycle:
    state: active
    maturity: stable
