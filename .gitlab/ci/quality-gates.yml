# ============================================================================
# STAGE 4 - QUALITY GATES
# ============================================================================

quality:gates:
  stage: quality
  image: node:${NODE_VERSION}-alpine
  tags:
    - saas-linux-small-amd64
  script:
    - echo "Quality gates - all tests must pass"
  # Run only when test jobs run (MR, release/*, main)
  # This ensures quality:gates doesn't fail on feature branch pushes
  # where test:unit/integration/e2e don't run
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH =~ /^release\//
    - if: $CI_COMMIT_BRANCH == "main"
  needs:
    - job: test:unit
    - job: test:integration
    - job: test:e2e
      optional: true
    - job: test:lint
      optional: true
    - job: test:security
      optional: true

