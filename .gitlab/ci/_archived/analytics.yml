# OSSA Evolution Analytics
# Tracks evolution metrics and generates reports

analytics:evolution-metrics:
  stage: monitor
  image: node:20
  script:
    - npm install -g @bluefly/openstandardagents
    - |
      echo "ðŸ“Š OSSA Evolution Metrics"
      echo "========================"
      echo ""
      echo "Issues Created (Last 30 days):"
      curl -s --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
        "https://gitlab.com/api/v4/projects/$CI_PROJECT_ID/issues?created_after=$(date -u -d '30 days ago' +%Y-%m-%d)" \
        | jq '. | length'
      echo ""
      echo "Releases Created (Last 30 days):"
      curl -s --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
        "https://gitlab.com/api/v4/projects/$CI_PROJECT_ID/releases" \
        | jq '. | length'
      echo ""
      echo "Schema Versions:"
      ls -1 spec/v*/ossa-*.schema.json | wc -l
      echo ""
      echo "Autonomous Agents:"
      ls -1 .gitlab/agents/*/manifest.ossa.yaml | wc -l
  rules:
    - if: $CI_PIPELINE_SOURCE == "schedule"
  schedule:
    - cron: "0 0 * * 0"  # Weekly on Sunday
  allow_failure: true
