# Documentation Validation Job
# Validates documentation consistency and completeness

validate:documentation:
  stage: validate
  image: node:${NODE_VERSION}-alpine
  needs: []
  before_script:
    - apk add --no-cache curl jq
    - npm ci --legacy-peer-deps
  script:
    - |
      echo "Validating documentation..."
      VERSION=$(jq -r '.current' .version.json 2>/dev/null || echo "0.3.0")
      echo "Version: v${VERSION}"
      
      # Check README exists and has version reference
      if [ ! -f README.md ]; then
        echo "ERROR: README.md missing"
        exit 1
      fi
      
      # Check CHANGELOG exists
      if [ ! -f CHANGELOG.md ]; then
        echo "WARNING: CHANGELOG.md missing"
      fi
      
      # Validate version sync script
      if ! npx tsx scripts/sync-versions.ts --check 2>/dev/null; then
        echo "WARNING: Version sync check failed (non-blocking)"
      fi
      
      echo "Documentation validation passed"
  allow_failure: false
  rules:
    - when: always
