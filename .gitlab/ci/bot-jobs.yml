# Bot Agent Jobs for CI/CD Integration
# Following TDD, OpenAPI-first, SOLID principles

bot:wiki-sync:
  stage: sync
  image: node:20
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        - "website/content/docs/**/*.md"
        - "docs/**/*.md"
    - if: $CI_COMMIT_BRANCH == "main"
  script:
    - npm install
    - node scripts/bots/bot-wiki-sync.ts
  variables:
    SOURCE_DIR: "website/content/docs"
  allow_failure: true

bot:dependency-updater:
  stage: validate
  image: node:20
  rules:
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: on_success
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: manual
      allow_failure: true
  script:
    - npm install
    - node scripts/bots/bot-dependency-updater.ts
  variables:
    UPDATE_TYPE: "security"
    CREATE_MR: "true"
  allow_failure: true

bot:policy-enforcer:
  stage: validate
  image: node:20
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
  script:
    - npm install
    - node scripts/bots/bot-policy-enforcer.ts
  variables:
    MR_IID: $CI_MERGE_REQUEST_IID
  allow_failure: false

bot:security-scanner:
  stage: security
  image: node:20
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
  script:
    - npm install
    - node scripts/bots/bot-security-scanner.ts
  variables:
    MR_IID: $CI_MERGE_REQUEST_IID
  allow_failure: false
