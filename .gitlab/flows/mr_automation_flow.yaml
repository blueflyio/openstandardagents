image: alpine:latest
injectGatewayToken: true

commands:
  - echo "Starting MR automation flow"

steps:
  - id: ossa_validation
    agent: bot-ossa-validator
    with:
      project_id: "{{ event.project_id }}"
      merge_request_id: "{{ event.merge_request_id }}"
      changed_files: "{{ event.changed_files }}"

  - id: drupal_standards
    agent: bot-drupal-standards
    with:
      project_id: "{{ event.project_id }}"
      merge_request_id: "{{ event.merge_request_id }}"
      changed_files: "{{ event.changed_files }}"

  - id: config_audit
    agent: bot-config-auditor
    with:
      project_id: "{{ event.project_id }}"
      merge_request_id: "{{ event.merge_request_id }}"
      changed_files: "{{ event.changed_files }}"

  - id: pipeline_check
    agent: bot-gitlab-ci-fixer
    with:
      project_id: "{{ event.project_id }}"
      merge_request_id: "{{ event.merge_request_id }}"
      changed_files: "{{ event.changed_files }}"

  - id: docs_sync
    agent: bot-wiki-aggregator
    with:
      project_id: "{{ event.project_id }}"
      merge_request_id: "{{ event.merge_request_id }}"
      changed_files: "{{ event.changed_files }}"

  - id: content_audit
    agent: bot-content-auditor
    with:
      project_id: "{{ event.project_id }}"
      merge_request_id: "{{ event.merge_request_id }}"
      changed_files: "{{ event.changed_files }}"

  - id: mr_review
    agent: bot-mr-reviewer
    with:
      project_id: "{{ event.project_id }}"
      merge_request_id: "{{ event.merge_request_id }}"
      previous_steps:
        - ossa_validation
        - drupal_standards
        - config_audit
        - pipeline_check
