openapi: 3.1.0
info:
  title: OSSA Performance Benchmark Specification
  version: 0.1.9
  description: |
    # Performance Benchmark Requirements for OSSA Agents

    Defines standardized performance metrics, benchmark protocols, and SLA requirements
    for OSSA-compliant agents.

    ## Key Metrics

    - **Latency**: Response time requirements (p50, p95, p99)
    - **Throughput**: Operations per second
    - **Token Efficiency**: Output/input token ratios
    - **Resource Usage**: CPU, memory, GPU utilization
    - **Error Rates**: Failure thresholds and recovery times

servers:
  - url: http://localhost:3000/ossa/v1
    description: OSSA benchmark server

paths:
  /benchmarks/run:
    post:
      tags: [Benchmark Execution]
      summary: Execute performance benchmark
      operationId: runBenchmark
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BenchmarkRequest'
      responses:
        '202':
          description: Benchmark started
          content:
            application/json:
              schema:
                type: object
                properties:
                  benchmark_id:
                    type: string
                  status:
                    type: string
                  estimated_duration_seconds:
                    type: integer

  /benchmarks/{benchmarkId}/results:
    get:
      tags: [Benchmark Results]
      summary: Get benchmark results
      operationId: getBenchmarkResults
      parameters:
        - name: benchmarkId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Benchmark results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BenchmarkResults'

  /agents/{agentId}/metrics:
    get:
      tags: [Live Metrics]
      summary: Get real-time agent metrics
      operationId: getAgentMetrics
      parameters:
        - name: agentId
          in: path
          required: true
          schema:
            type: string
        - name: duration
          in: query
          schema:
            type: string
            default: "5m"
            enum: ["1m", "5m", "15m", "1h", "24h"]
      responses:
        '200':
          description: Agent metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentMetrics'

components:
  schemas:
    BenchmarkRequest:
      type: object
      required:
        - agent_id
        - benchmark_type
        - workload
      properties:
        agent_id:
          type: string
        benchmark_type:
          type: string
          enum: [latency, throughput, token_efficiency, resource_usage, stress_test]
        workload:
          $ref: '#/components/schemas/BenchmarkWorkload'
        duration_seconds:
          type: integer
          default: 300
        warmup_seconds:
          type: integer
          default: 30

    BenchmarkWorkload:
      type: object
      required:
        - scenario
        - load_pattern
      properties:
        scenario:
          type: string
          enum: [simple_qa, multi_turn_conversation, tool_usage, complex_reasoning, batch_processing]
        load_pattern:
          type: string
          enum: [constant, ramp_up, spike, random]
        requests_per_second:
          type: number
        max_concurrent:
          type: integer
        input_tokens_avg:
          type: integer
        input_tokens_max:
          type: integer

    BenchmarkResults:
      type: object
      required:
        - benchmark_id
        - agent_id
        - timestamp
        - duration_seconds
        - metrics
      properties:
        benchmark_id:
          type: string
        agent_id:
          type: string
        timestamp:
          type: string
          format: date-time
        duration_seconds:
          type: integer
        metrics:
          $ref: '#/components/schemas/PerformanceMetrics'
        sla_compliance:
          $ref: '#/components/schemas/SLACompliance'
        recommendations:
          type: array
          items:
            type: string

    PerformanceMetrics:
      type: object
      properties:
        latency:
          type: object
          properties:
            p50_ms:
              type: number
            p95_ms:
              type: number
            p99_ms:
              type: number
            max_ms:
              type: number
            min_ms:
              type: number
        throughput:
          type: object
          properties:
            requests_per_second:
              type: number
            tokens_per_second:
              type: number
            operations_per_second:
              type: number
        token_efficiency:
          type: object
          properties:
            input_tokens_total:
              type: integer
            output_tokens_total:
              type: integer
            ratio:
              type: number
            cost_per_1k_tokens:
              type: number
        resource_usage:
          type: object
          properties:
            cpu_percent_avg:
              type: number
            cpu_percent_max:
              type: number
            memory_mb_avg:
              type: number
            memory_mb_max:
              type: number
            gpu_percent_avg:
              type: number
            gpu_memory_mb:
              type: number
        error_rates:
          type: object
          properties:
            total_requests:
              type: integer
            failed_requests:
              type: integer
            error_rate_percent:
              type: number
            timeout_count:
              type: integer
            retry_count:
              type: integer

    AgentMetrics:
      type: object
      properties:
        agent_id:
          type: string
        timestamp:
          type: string
          format: date-time
        period:
          type: string
        current:
          $ref: '#/components/schemas/LiveMetrics'
        historical:
          type: array
          items:
            $ref: '#/components/schemas/LiveMetrics'

    LiveMetrics:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        latency_ms:
          type: number
        active_requests:
          type: integer
        queue_depth:
          type: integer
        tokens_per_minute:
          type: integer
        cpu_percent:
          type: number
        memory_mb:
          type: number
        error_count:
          type: integer

    SLACompliance:
      type: object
      required:
        - meets_requirements
        - violations
      properties:
        meets_requirements:
          type: boolean
        violations:
          type: array
          items:
            type: object
            properties:
              metric:
                type: string
              required:
                type: string
              actual:
                type: string
              severity:
                type: string
                enum: [critical, major, minor]
        requirements:
          type: object
          properties:
            max_latency_p99_ms:
              type: integer
              default: 50
            min_throughput_rps:
              type: number
              default: 100
            max_error_rate_percent:
              type: number
              default: 1
            max_cpu_percent:
              type: number
              default: 80
            max_memory_mb:
              type: integer
              default: 512