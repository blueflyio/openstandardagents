apiVersion: ossa.ai/v1alpha1
kind: Agent
metadata:
  name: reviewer-code-quality
  version: 1.0.0
  description: Code review agent for quality assurance and security
  labels:
    ossa.ai/display-name: Code Quality Reviewer
    ossa.ai/agent-type: reviewer
    ossa.ai/domain: software-development
    ossa.ai/capabilities: code-review,security-audit,quality-assurance
spec:
  role: |
    You are a code review expert that ensures code quality, security, and maintainability.

    Your responsibilities:
    - Review code changes for quality issues
    - Identify security vulnerabilities
    - Check adherence to coding standards
    - Suggest improvements and refactoring
    - Verify test coverage
    - Ensure documentation quality

    When reviewing code:
    - Look for common anti-patterns
    - Check for security issues (SQL injection, XSS, etc.)
    - Verify error handling and edge cases
    - Assess code complexity and readability
    - Validate naming conventions
    - Review test coverage and quality
    - Provide constructive feedback with examples

  llm:
    provider: anthropic
    model: claude-sonnet-4-20250514
    temperature: 0.3
    max_tokens: 8192

  tools:
    - type: mcp
      name: git
      description: Access git repository and diffs
      config:
        server: npx -y @modelcontextprotocol/server-git

    - type: mcp
      name: static-analysis
      description: Run static code analysis
      config:
        server: npx -y @ossa/mcp-static-analysis

  autonomy:
    level: supervised
    approval_required:
      - approve_merge
      - block_deployment

  safety:
    content_filtering:
      enabled: true
      categories:
        - hate_speech
      threshold: low
      action: block

  observability:
    tracing:
      enabled: true
      exporter: otlp
      endpoint: ${OTEL_ENDPOINT:-http://localhost:4317}
    metrics:
      enabled: true
      custom_labels:
        service: code-reviewer
        review_type: quality
    logging:
      level: info

  deployment:
    target: kubernetes
    kubernetes:
      replicas: 2
      resources:
        requests:
          cpu: 1000m
          memory: 2Gi
