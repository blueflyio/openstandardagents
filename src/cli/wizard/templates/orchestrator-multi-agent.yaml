apiVersion: ossa.ai/v1alpha1
kind: Agent
metadata:
  name: orchestrator-multi-agent
  version: 1.0.0
  description: Multi-agent orchestrator that coordinates specialized agents in complex workflows
  labels:
    ossa.ai/display-name: Multi-Agent Orchestrator
    ossa.ai/agent-type: orchestrator
    ossa.ai/domain: workflow-management
    ossa.ai/capabilities: coordination,task-delegation,agent-mesh
spec:
  role: |
    You are an orchestrator agent that coordinates multiple specialized agents to solve complex problems.

    Your responsibilities:
    - Analyze incoming requests and break them into sub-tasks
    - Identify the most appropriate agents for each sub-task
    - Coordinate agent communication and handoffs
    - Aggregate results and synthesize final outputs
    - Monitor agent performance and adjust workflows dynamically
    - Handle failures gracefully with retry and fallback strategies

    When coordinating agents:
    - Use the agent discovery tool to find available agents and their capabilities
    - Leverage handoff protocols for clean task delegation
    - Maintain context across agent interactions
    - Ensure consistent state management
    - Provide clear instructions and success criteria

    You operate in an agent mesh and should optimize for:
    - Parallel execution where possible
    - Minimal inter-agent latency
    - Clear error handling and rollback

  llm:
    provider: anthropic
    model: claude-sonnet-4-20250514
    temperature: 0.7
    max_tokens: 8192

  tools:
    - type: mcp
      name: agent-discovery
      description: Discover and query available agents in the mesh
      config:
        server: npx -y @ossa/mcp-agent-discovery

    - type: mcp
      name: handoff-protocol
      description: Execute handoffs to other agents
      config:
        server: npx -y @ossa/mcp-handoff

  autonomy:
    level: assisted
    approval_required:
      - deploy_code
      - modify_production
      - delete_data
    approval_timeout: 300

  observability:
    tracing:
      enabled: true
      exporter: otlp
      endpoint: ${OTEL_ENDPOINT:-http://localhost:4317}
      sample_rate: 1.0
    metrics:
      enabled: true
      custom_labels:
        service: orchestrator-multi-agent
        environment: ${ENVIRONMENT:-production}
    logging:
      level: info
      include_prompts: false
      include_responses: false

  deployment:
    target: kubernetes
    kubernetes:
      replicas: 2
      resources:
        requests:
          cpu: 500m
          memory: 1Gi
        limits:
          cpu: 2000m
          memory: 4Gi
      autoscaling:
        enabled: true
        min_replicas: 2
        max_replicas: 10
        target_cpu_utilization: 80
