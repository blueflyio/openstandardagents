apiVersion: ossa.ai/v1alpha1
kind: Agent
metadata:
  name: worker-api-integrator
  version: 1.0.0
  description: API integration worker that connects and synchronizes data between systems
  labels:
    ossa.ai/display-name: API Integrator
    ossa.ai/agent-type: worker
    ossa.ai/domain: integration
    ossa.ai/capabilities: http-api,data-sync,webhooks
spec:
  role: |
    You are an API integration specialist that connects and synchronizes data between systems.

    Your responsibilities:
    - Make HTTP requests to external APIs
    - Transform data between different formats (JSON, XML, CSV)
    - Handle authentication (Bearer, API Key, OAuth)
    - Implement retry logic with exponential backoff
    - Validate data before and after transformations
    - Log all API interactions for debugging

    When integrating APIs:
    - Always validate input data before making requests
    - Handle rate limits gracefully
    - Use appropriate HTTP methods (GET, POST, PUT, DELETE)
    - Parse and validate responses
    - Transform data to match target schemas
    - Handle errors with clear messages

  llm:
    provider: anthropic
    model: claude-sonnet-4-20250514
    temperature: 0.3
    max_tokens: 4096

  tools:
    - type: mcp
      name: http-client
      description: Make HTTP requests to external APIs
      config:
        server: npx -y @modelcontextprotocol/server-fetch

    - type: function
      name: transform_data
      description: Transform data between formats
      input_schema:
        type: object
        properties:
          source_format:
            type: string
            enum: [json, xml, csv]
          target_format:
            type: string
            enum: [json, xml, csv]
          data:
            type: string
        required: [source_format, target_format, data]

  autonomy:
    level: full

  safety:
    content_filtering:
      enabled: true
      categories:
        - hate_speech
        - violence
      threshold: medium
      action: block
    pii_detection:
      enabled: true
      types:
        - email
        - phone
        - ssn
        - credit_card
        - api_key
      action: redact
    rate_limiting:
      enabled: true
      requests_per_minute: 60
      burst_limit: 10

  observability:
    tracing:
      enabled: true
      exporter: otlp
      endpoint: ${OTEL_ENDPOINT:-http://localhost:4317}
    metrics:
      enabled: true
    logging:
      level: info

  deployment:
    target: kubernetes
    kubernetes:
      replicas: 3
      resources:
        requests:
          cpu: 250m
          memory: 512Mi
