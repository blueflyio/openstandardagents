apiVersion: "@bluefly/open-standards-scalable-agents/v0.1.9"
kind: Agent
metadata:
  name: security-agent
  version: "0.1.9"
  namespace: ossa-examples
  description: Security-focused worker agent for authentication, encryption, auditing, and compliance
  labels:
    category: worker
    specialization: security
    tenant: ossa-platform
  annotations:
    openapi: /api/security-agent-specification.yml
    compliance: gold
    docker-service: ossa-security-agent
  author: OSSA Platform Team
  license: Apache-2.0
  repository: https://github.com/ossa/security-agent
  documentation: https://docs.ossa.io/agents/workers/security

spec:
  type: worker
  subtype: worker.security
  
  capabilities:
    domains:
      - security
      - authentication
      - encryption
      - audit-logging
      - compliance
    operations:
      - name: authenticate_request
        description: Authenticate and authorize API requests
        inputSchema:
          type: object
          required: [credentials, resource]
          properties:
            credentials:
              type: object
              properties:
                type: 
                  type: string
                  enum: [bearer_token, api_key, certificate, biometric]
                token: {type: string}
                metadata: {type: object}
            resource:
              type: object
              properties:
                path: {type: string}
                method: {type: string}
                permissions_required: {type: array}
            context:
              type: object
              properties:
                ip_address: {type: string}
                user_agent: {type: string}
                session_id: {type: string}
        outputSchema:
          type: object
          properties:
            authenticated: {type: boolean}
            authorized: {type: boolean}
            user_identity: {type: object}
            permissions: {type: array}
            security_level: {type: string}
            audit_id: {type: string}
        timeout: 5000
      
      - name: encrypt_data
        description: Encrypt sensitive data using AES-256 or specified algorithm
        inputSchema:
          type: object
          required: [data]
          properties:
            data: {type: string}
            algorithm:
              type: string
              enum: [aes-256-gcm, aes-256-cbc, rsa-oaep, chacha20-poly1305]
              default: aes-256-gcm
            keyId: {type: string}
            additionalData: {type: string}
        outputSchema:
          type: object
          properties:
            encryptedData: {type: string}
            keyId: {type: string}
            algorithm: {type: string}
            iv: {type: string}
            authTag: {type: string}
        timeout: 10000
      
      - name: decrypt_data
        description: Decrypt previously encrypted data
        inputSchema:
          type: object
          required: [encryptedData, keyId]
          properties:
            encryptedData: {type: string}
            keyId: {type: string}
            algorithm: {type: string}
            iv: {type: string}
            authTag: {type: string}
            additionalData: {type: string}
        outputSchema:
          type: object
          properties:
            data: {type: string}
            verified: {type: boolean}
        timeout: 10000
      
      - name: audit_log
        description: Create comprehensive audit log entries
        inputSchema:
          type: object
          required: [event, actor]
          properties:
            event:
              type: object
              properties:
                type: {type: string}
                action: {type: string}
                resource: {type: string}
                result: {type: string}
                timestamp: {type: string}
            actor:
              type: object
              properties:
                id: {type: string}
                type: {type: string}
                ip: {type: string}
                session: {type: string}
            metadata: {type: object}
        outputSchema:
          type: object
          properties:
            auditId: {type: string}
            logged: {type: boolean}
            compliance_tags: {type: array}
        timeout: 3000
      
      - name: scan_vulnerabilities
        description: Scan for security vulnerabilities in code or systems
        inputSchema:
          type: object
          required: [target]
          properties:
            target:
              type: object
              properties:
                type: 
                  type: string
                  enum: [code, container, network, api]
                content: {type: string}
                endpoint: {type: string}
            scanOptions:
              type: object
              properties:
                depth: {type: string}
                categories: {type: array}
                excludes: {type: array}
        outputSchema:
          type: object
          properties:
            scanId: {type: string}
            vulnerabilities:
              type: array
              items:
                type: object
                properties:
                  id: {type: string}
                  severity: {type: string}
                  category: {type: string}
                  description: {type: string}
                  remediation: {type: string}
            summary:
              type: object
              properties:
                total: {type: number}
                critical: {type: number}
                high: {type: number}
                medium: {type: number}
                low: {type: number}
        timeout: 60000

    inputFormats:
      - application/json
      - text/plain
      - application/x-pem-file
      - application/pkcs12

    outputFormats:
      - application/json
      - text/plain
      - application/pdf

    tokenEfficiency:
      strategies:
        - security-context-caching
        - encrypted-token-reuse
        - audit-batch-logging
        - vulnerability-deduplication
        - policy-template-reuse
      compressionRatio: 0.8

  protocols:
    supported:
      - name: ossa
        version: "0.1.9"
        endpoint: http://localhost:3009/ossa/v1
        authentication:
          type: api-key
        tls: true
      - name: rest
        version: "3.1.0"
        endpoint: http://localhost:3009/api/v1
        authentication:
          type: mutual-tls
        tls: true
    preferred: ossa

  conformance:
    level: gold
    certifications:
      - ISO-42001
      - ISO-27001
      - SOC-2-Type-II
      - PCI-DSS
      - FIPS-140-2
    auditLogging: true
    feedbackLoop: true
    propsTokens: true
    learningSignals: true

  performance:
    throughput:
      authenticationsPerSecond: 500
      encryptionsPerSecond: 200
    latency:
      p50: 100
      p95: 500
      p99: 2000
    limits:
      maxDataSize: 10485760  # 10MB
      maxConcurrentOperations: 100
      timeout: 60000

  resources:
    requests:
      cpu: 1
      memory: 2Gi
      storage: 50Gi
    limits:
      cpu: 4
      memory: 8Gi
      storage: 500Gi

  feedbackLoop:
    phase: secure
    inputs:
      - security_policies
      - threat_intelligence
      - compliance_requirements
      - audit_feedback
    outputs:
      - security_decisions
      - audit_trails
      - threat_assessments
      - compliance_reports

  budgets:
    tokens:
      default: 1500
      maximum: 8000
      strategy: security-level-proportional
    time:
      default: 10000
      maximum: 60000

  dependencies:
    agents:
      - name: registry-core
        version: ">=0.1.9"
        optional: false
    services:
      - name: key-management
        endpoint: http://vault:8200
        healthCheck: http://vault:8200/v1/sys/health
      - name: audit-store
        endpoint: postgresql://ossa:ossa_dev_password@postgres:5432/ossa
        healthCheck: postgresql://ossa:ossa_dev_password@postgres:5432/ossa

status:
  state: registered
  health: healthy
  lastHeartbeat: "2024-01-01T00:00:00Z"
  registeredAt: "2024-01-01T00:00:00Z"
  metrics:
    authenticationsCompleted: 0
    encryptionsCompleted: 0
    vulnerabilitiesDetected: 0
    auditEventsLogged: 0
    tokenUsage: 0

securityConfig:
  encryptionLevel: AES-256
  auditLogEnabled: true
  securityFeatures:
    - auth
    - encryption
    - audit
    - compliance
  complianceFrameworks:
    - SOC2
    - ISO27001
    - PCI-DSS
    - GDPR
  keyRotationInterval: 86400000  # 24 hours
  sessionTimeout: 3600000  # 1 hour
  maxFailedAttempts: 5
  alertThresholds:
    failedLogins: 10
    encryptionFailures: 5
    auditAnomalies: 3