apiVersion: ossa/v0.3.3
kind: Task
metadata:
  name: drupal-content-moderation
  description: Content moderation workflow using Drupal ECA
  labels:
    drupal.module: eca
    drupal.version: "11.x"
spec:
  steps:
    - name: validate-content
      action: drupal.eca.condition
      inputs:
        condition_type: entity_field_value
        entity_type: node
        field: moderation_state
        operator: equals
        value: draft
    
    - name: check-permissions
      action: drupal.eca.condition
      inputs:
        condition_type: user_permission
        permission: moderate content
    
    - name: update-state
      action: drupal.eca.action
      inputs:
        action_type: entity_set_field_value
        entity_type: node
        field: moderation_state
        value: published
    
    - name: notify-author
      action: drupal.eca.action
      inputs:
        action_type: send_email
        to: "{{ entity.author.email }}"
        subject: "Your content has been published"
        template: content_published

runtime:
  drupal:
    module: eca
    event: entity_presave
    entity_type: node
    bundle: article
    priority: 100
