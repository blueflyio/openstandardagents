# OSSA v0.2.9 - Reasoning Agent Example
# Demonstrates: reasoning strategies, prompt templates, knowledge graph
apiVersion: ossa/v0.3.5
kind: Agent
metadata:
  name: research-analyst
  version: 1.0.0
  description: Research analyst with ReAct reasoning, knowledge graph, and versioned prompts
  labels:
    domain: research
    capability: analysis
    reasoning: react

spec:
  taxonomy:
    domain: research
    subdomain: analysis
    capability: synthesis

  role: |
    You are a research analyst specializing in synthesizing complex information.
    Use the ReAct reasoning pattern: Thought → Action → Observation.

  llm:
    provider: anthropic
    model: claude-sonnet-4-20250514
    parameters:
      temperature: 0.3
      max_tokens: 4096

  # NEW: Reasoning configuration
  reasoning:
    strategy: react
    max_steps: 15
    trace_enabled: true
    export_format: otel
    self_reflection:
      enabled: true
      trigger: on_uncertainty
      threshold: 0.6

  # NEW: Prompt management with versioning
  prompts:
    system:
      template: prompts/research-system-v2.md
      version: "2.1.0"
      variables:
        domain: "market-research"
        output_format: "structured-report"
    few_shot_examples:
      - input: "Analyze the competitive landscape for AI agents"
        output: |
          Thought: I need to identify key players, their offerings, and market positioning.
          Action: search_knowledge_graph for entities with type=AIVendor
          Observation: Found 12 major vendors including OpenAI, Anthropic, Google...
      - input: "What are the emerging trends in agent frameworks?"
        output: |
          Thought: I should look for recent publications and framework releases.
          Action: query_research_db for papers published > 2024-01
          Observation: 47 relevant papers found, clustering around multi-agent and RAG...

  # NEW: Knowledge graph integration
  knowledge_graph:
    enabled: true
    provider: neo4j
    connection:
      endpoint: bolt://kg.internal:7687
      database: research_graph
      credentials_ref: KG_CREDENTIALS
    schema:
      entity_types:
        - Company
        - Product
        - Technology
        - Publication
        - Person
      relationship_types:
        - COMPETES_WITH
        - DEVELOPS
        - PUBLISHES
        - CITES
        - EMPLOYS
    sync:
      mode: real_time
      batch_size: 50
      interval: 30s

  tools:
    - name: search_knowledge_graph
      description: Query the knowledge graph for entity relationships
      source:
        type: mcp
        uri: mcp://kg-service/query
      input:
        type: object
        required: [query]
        properties:
          query:
            type: string
            description: Cypher query or natural language search

    - name: query_research_db
      description: Search research papers and publications
      source:
        type: mcp
        uri: mcp://research-service/search

  autonomy:
    level: assisted
    escalation:
      enabled: true
      triggers:
        - low_confidence
        - external_data_required

  observability:
    tracing:
      enabled: true
      provider: otel
      sampling_rate: 1.0
    metrics:
      enabled: true
      custom:
        - name: reasoning_steps_total
          type: counter
          description: Total reasoning steps executed
        - name: kg_queries_total
          type: counter
          description: Knowledge graph queries executed
    logging:
      level: debug

  constraints:
    max_tokens_per_turn: 8000
    max_turns: 20
    timeout_seconds: 300
