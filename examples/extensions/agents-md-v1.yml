# OSSA agents.md Extension Schema
# OpenAI agents.md repository-level agent guidance generation
# See: https://agents.md | https://github.com/openai/agents.md

apiVersion: ossa/v0.2.9
kind: ExtensionSchema
metadata:
  name: agents-md-extension
  version: v1
  namespace: ossa/extensions
spec:
  compatibleWith:
    - agents.md/v1
  description: "Extension schema for OpenAI agents.md repository-level agent guidance"

  references:
    specification: https://agents.md
    repository: https://github.com/openai/agents.md
    adoption: "20,000+ OSS projects"

  supportedTools:
    - OpenAI Codex
    - Google Jules
    - Cursor
    - GitHub Copilot
    - VS Code
    - Zed
    - Aider
    - Gemini CLI

  additionalFields:
    agent:
      enabled:
        type: boolean
        default: false
        description: "Enable agents.md generation"

      generate:
        type: boolean
        default: true
        description: "Auto-generate AGENTS.md from manifest"

      output_path:
        type: string
        default: "AGENTS.md"
        description: "Output path for generated file"

      sections:
        type: object
        properties:
          dev_environment:
            $ref: "#/definitions/AgentsMdSection"
            description: "Dev environment tips section"
          testing:
            $ref: "#/definitions/AgentsMdSection"
            description: "Testing instructions section"
          pr_instructions:
            $ref: "#/definitions/AgentsMdSection"
            description: "PR guidelines section"
          code_style:
            $ref: "#/definitions/AgentsMdSection"
            description: "Code style guidelines section"
          security:
            $ref: "#/definitions/AgentsMdSection"
            description: "Security considerations section"
          custom:
            type: array
            items:
              type: object
              required: [title, content]
              properties:
                title:
                  type: string
                content:
                  type: string
            description: "Custom sections"

      sync:
        type: object
        properties:
          on_manifest_change:
            type: boolean
            default: true
          include_comments:
            type: boolean
            default: true
          watch:
            type: boolean
            default: false

      mapping:
        type: object
        properties:
          tools_to_dev_environment:
            type: boolean
            default: true
            description: "Map spec.tools → Dev environment tips"
          constraints_to_testing:
            type: boolean
            default: true
            description: "Map spec.constraints → Testing requirements"
          autonomy_to_pr_instructions:
            type: boolean
            default: true
            description: "Map spec.autonomy → PR workflow hints"
          role_from_agents_md:
            type: boolean
            default: false
            description: "Parse AGENTS.md → spec.role hints"

      cursor_integration:
        type: boolean
        default: false
        description: "Generate Cursor-compatible content"

      nested_files:
        type: array
        items:
          type: object
          required: [path]
          properties:
            path:
              type: string
            inherit:
              type: boolean
              default: true
            sections:
              type: object

  definitions:
    AgentsMdSection:
      type: object
      properties:
        enabled:
          type: boolean
          default: true
        source:
          type: string
          description: "OSSA manifest path (e.g., 'spec.tools')"
        custom:
          type: string
          description: "Custom markdown content"
        title:
          type: string
          description: "Section header override"
        append:
          type: string
          description: "Content to append after auto-generated"

  validation:
    required: []
    customRules:
      - name: "validate-output-path"
        rule: "output_path must end with .md extension or be 'AGENTS.md'"
      - name: "validate-nested-paths"
        rule: "nested_files paths must be valid relative directories"
      - name: "validate-cursor-integration"
        rule: "If cursor_integration is true, extensions.cursor should also be enabled"

  migration:
    fromVersion: null
    toVersion: "v1"
    breakingChanges: []
    migrationGuide: "https://openstandardagents.org/docs/extensions/agents-md"

  cliCommands:
    - name: "ossa agents-md generate"
      description: "Generate AGENTS.md from manifest"
      usage: "ossa agents-md generate --manifest .agents/my-agent/manifest.yaml"
    - name: "ossa agents-md validate"
      description: "Validate AGENTS.md against manifest"
      usage: "ossa agents-md validate --agents-md AGENTS.md --manifest .agents/my-agent/manifest.yaml"
    - name: "ossa agents-md sync"
      description: "Sync AGENTS.md with manifest changes"
      usage: "ossa agents-md sync --watch"
