ossaVersion: '1.0'

agent:
  id: fedramp-compliance-scanner
  name: FedRAMP Compliance Scanner
  description: |
    Automated FedRAMP compliance scanning agent that validates
    infrastructure against FedRAMP Moderate controls.
  version: '1.0.0'
  role: compliance

  author:
    name: Bluefly Security Team
    email: security@bluefly.io
    organization: Bluefly.io

  license: Apache-2.0

  runtime:
    type: k8s
    image: registry.bluefly.io/agents/fedramp-scanner:1.0.0
    command: ['/app/scanner']
    args: ['--mode=continuous']
    env:
      LOG_LEVEL: info
      SCAN_INTERVAL: '3600'
    resources:
      cpu: '500m'
      memory: '1Gi'

  capabilities:
    - name: scan_infrastructure
      description: Scan Kubernetes infrastructure for FedRAMP compliance
      input_schema:
        type: object
        required: [namespace]
        properties:
          namespace:
            type: string
          controls:
            type: array
            items:
              type: string
      output_schema:
        type: object
        properties:
          compliant:
            type: boolean
          violations:
            type: array
            items:
              type: object
              properties:
                control:
                  type: string
                severity:
                  type: string
                  enum: [low, medium, high, critical]
                description:
                  type: string
      examples:
        - name: scan_production
          input:
            namespace: production
            controls: ['AC-2', 'AC-3', 'AU-2']
          output:
            compliant: false
            violations:
              - control: 'AC-2'
                severity: 'high'
                description: 'Service account without expiration policy'

    - name: remediate
      description: Automatically remediate compliance violations
      input_schema:
        type: object
        required: [violation_id]
        properties:
          violation_id:
            type: string
          auto_apply:
            type: boolean
      output_schema:
        type: object
        properties:
          remediated:
            type: boolean
          actions:
            type: array
            items:
              type: string

    - name: generate_report
      description: Generate FedRAMP compliance report
      input_schema:
        type: object
        required: [format]
        properties:
          format:
            type: string
            enum: [pdf, html, json]
      output_schema:
        type: object
        properties:
          report_url:
            type: string
          summary:
            type: object

  policies:
    compliance:
      - fedramp
      - soc2
    data_residency:
      - US
    encryption: true
    audit: true
    retention: 2555 # 7 years (FedRAMP requirement)

  integration:
    protocol: grpc
    endpoints:
      scan:
        path: /v1/scan
        method: POST
      remediate:
        path: /v1/remediate
        method: POST
      report:
        path: /v1/report
        method: GET
    auth:
      type: mutual-tls
      config:
        ca_cert: /etc/certs/ca.crt
        client_cert: /etc/certs/client.crt

  monitoring:
    traces: true
    metrics: true
    logs: true
    health_check: http://localhost:8080/health
    readiness_check: http://localhost:8080/ready

  metadata:
    tags:
      - compliance
      - fedramp
      - security
    keywords:
      - compliance scanning
      - automated remediation
      - audit reporting
    homepage: https://github.com/bluefly/fedramp-scanner
    documentation: https://docs.bluefly.io/agents/fedramp-scanner
