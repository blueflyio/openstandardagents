apiVersion: ossa/v0.4.1
kind: Agent
metadata:
  name: customer-support-bot
  version: 1.0.0
  description: |
    Production customer support agent with memory, multi-channel support, and ticket creation.
    Handles customer inquiries, searches documentation, creates tickets, and sends follow-up emails.
  labels:
    platform: langchain
    export: langchain
    use-case: customer-support
    tier: production
spec:
  role: |
    You are a professional customer support agent for TechCorp. Your responsibilities:

    1. Answer customer questions accurately and professionally
    2. Search documentation to provide accurate technical information
    3. Create support tickets for issues requiring human intervention
    4. Send follow-up emails to keep customers informed
    5. Maintain conversation context to provide personalized support

    Communication style:
    - Professional, friendly, and empathetic
    - Clear and concise explanations
    - Proactive in offering solutions
    - Transparent about limitations

  llm:
    provider: openai
    model: gpt-4o
    temperature: 0.7
    maxTokens: 1500

  capabilities:
    - search_documentation
    - create_ticket
    - send_email
    - conversation_memory

  tools:
    - type: function
      name: search_docs
      description: Search the knowledge base for relevant documentation
      parameters:
        type: object
        properties:
          query:
            type: string
            description: Search query for documentation
          max_results:
            type: integer
            description: Maximum number of results to return
            default: 5
        required:
          - query

    - type: function
      name: create_ticket
      description: Create a support ticket for issues requiring human attention
      parameters:
        type: object
        properties:
          title:
            type: string
            description: Brief title of the issue
          description:
            type: string
            description: Detailed description of the issue
          priority:
            type: string
            enum: [low, medium, high, urgent]
            description: Priority level of the ticket
          category:
            type: string
            description: Category (billing, technical, account, etc.)
        required:
          - title
          - description
          - priority

    - type: function
      name: send_email
      description: Send follow-up email to customer
      parameters:
        type: object
        properties:
          to:
            type: string
            description: Customer email address
          subject:
            type: string
            description: Email subject line
          body:
            type: string
            description: Email body content
          template:
            type: string
            description: Email template to use
            enum: [follow_up, resolution, escalation]
        required:
          - to
          - subject
          - body

  autonomy:
    level: supervised
    approval_required: false
    escalation_rules:
      - condition: priority == 'urgent'
        action: notify_human
      - condition: ticket_count > 3
        action: escalate

  memory:
    enabled: true
    type: conversation_buffer
    window_size: 10
    persistence:
      enabled: true
      backend: redis
      ttl: 86400

  safety:
    input_filters:
      - type: pii_detection
        action: redact
      - type: profanity_filter
        action: reject
    output_validation:
      - type: hallucination_check
        threshold: 0.8
      - type: tone_analysis
        required_sentiment: [positive, neutral]

  observability:
    logging:
      level: info
      format: json
      include_pii: false
    metrics:
      enabled: true
      port: 9090
      metrics:
        - conversations_total
        - tickets_created
        - emails_sent
        - response_time
    tracing:
      enabled: true
      provider: opentelemetry

extensions:
  langchain:
    agent_type: react
    memory_type: conversation_buffer
    chain_type: conversation
    tools_mapping:
      - ossa_capability: search_documentation
        langchain_tool: search_docs
        tool_class: CustomSearchTool
      - ossa_capability: create_ticket
        langchain_tool: create_ticket
        tool_class: TicketingTool
      - ossa_capability: send_email
        langchain_tool: send_email
        tool_class: EmailTool
    export_config:
      format: python
      include_dependencies: true
      output_file: customer_support_agent.py
