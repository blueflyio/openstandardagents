# Discovery Configuration - Project Level
# Enables workspace discovery engine to find and register this project

apiVersion: "openapi-ai-agents/v0.1.1"
kind: "DiscoveryConfig"
metadata:
  name: "project-discovery-config"
  version: "1.0.0"
  description: "Configuration for workspace discovery integration"
  
  annotations:
    # Discovery markers
    discovery/enabled: "true"
    discovery/auto-register: "true"
    discovery/visibility: "workspace"
    
    # Project metadata for discovery
    project/type: "your-project-type"
    project/maturity: "production|development|experimental"
    project/compliance-ready: "true"

spec:
  # Project identification
  project:
    id: "your-project-id"
    name: "Your Project Name"
    repository: "https://github.com/your-org/your-project"
    description: "Brief project description for discovery catalog"
    
  # Discovery settings
  discovery:
    # How this project should be discovered
    detection_markers:
      - ".agents/agent-registry.yml"  # Primary marker
      - ".agents/context.yml"          # Context availability
      - "package.json"                 # Technology indicator
      
    # What to expose to workspace
    expose_to_workspace:
      agents: true
      capabilities: true
      context: true
      metrics: true
      health: true
      
    # Discovery metadata
    metadata:
      primary_language: "javascript|python|java|go|rust"
      frameworks: ["your-framework-1", "your-framework-2"]
      domain: "your-domain"
      team: "your-team-name"
      contact: "team@your-org.com"
      
  # Workspace integration
  workspace_integration:
    # Expected workspace location
    workspace_path: "../../.agent-workspace"  # Relative to project root
    
    # How to connect to workspace services
    connections:
      orchestrator:
        enabled: true
        endpoint: "${WORKSPACE_ORCHESTRATOR_URL}"
        authentication: "service_token"
        
      context_aggregator:
        enabled: true
        share_context: true
        sync_interval: "5m"
        
      discovery_engine:
        enabled: true
        registration_mode: "automatic"
        health_check_response: true
        
    # Routing preferences
    routing:
      accept_cross_project_requests: true
      preferred_load_balancing: "capability_based"
      max_concurrent_requests: 100
      timeout: "30s"
      
  # Agent coordination
  agent_coordination:
    # How agents should respond to workspace requests
    handoff_protocol:
      supported_protocols: ["uadp", "mcp", "a2a"]
      handoff_timeout: "5s"
      context_preservation: true
      
    # Capability advertisement
    capability_broadcasting:
      enabled: true
      broadcast_interval: "1m"
      include_performance_metrics: true
      
    # Inter-agent communication
    inter_agent_communication:
      allow_direct_communication: true
      require_workspace_routing: false
      encryption: "tls"
      
  # Health and monitoring
  health_monitoring:
    # Health check endpoint configuration
    health_endpoint:
      enabled: true
      path: "/.agents/health"
      include_agent_status: true
      include_metrics: true
      
    # Metrics to share with workspace
    shared_metrics:
      - "agent_availability"
      - "response_time"
      - "error_rate"
      - "token_usage"
      - "capability_utilization"
      
  # Security and compliance
  security:
    # Workspace authentication
    workspace_auth:
      method: "mutual_tls|jwt|api_key"
      token_rotation: "24h"
      
    # Access control from workspace
    workspace_access:
      allowed_operations:
        - "discover"
        - "execute"
        - "monitor"
        - "route"
      require_signed_requests: true
      
  # Migration support
  migration:
    # For projects without .agents folder
    migration_ready: false
    suggested_migration_path: "automated|guided|manual"
    estimated_effort: "2-4 hours"
    
# Discovery response configuration
responses:
  # Response to workspace discovery ping
  discovery_ping:
    response_time_ms: 100
    include_full_registry: true
    compress_response: true
    
  # Response to capability query
  capability_query:
    include_examples: true
    include_performance_data: true
    include_cost_estimates: true
    
  # Response to health check
  health_check:
    include_agent_details: true
    include_recent_errors: false
    include_resource_usage: true