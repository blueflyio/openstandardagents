openapi: 3.1.0
info:
  title: "Drupal Module Research Agent API"
  version: "1.0.0"
  description: |
    Comprehensive Drupal module research and analysis agent compliant with 
    OpenAPI AI Agents Standard v0.1.1 and Universal Agent Discovery Protocol (UADP) v1.0.
    
    This agent provides exhaustive analysis of Drupal contributed modules including:
    - Module metadata and release history analysis
    - Complete documentation parsing and extraction
    - Issue queue analysis (open and closed issues)
    - Git repository code analysis across versions
    - Security assessment and community health evaluation
    
    Built for integration with TDDAI framework and LLM Platform ecosystem.
    
  contact:
    name: "LLM Platform Team"
    url: "https://llm.bluefly.io"
    
  license:
    name: "Apache 2.0"
    url: "https://www.apache.org/licenses/LICENSE-2.0.html"
    
  x-openapi-ai-agents-standard:
    version: "0.1.1"
    certification_level: "silver"
    protocols: ["openapi", "mcp", "tddai"]
    uadp_enabled: true
    
  x-agent-metadata:
    class: "specialist"
    domain: "drupal"
    protocols: ["openapi", "mcp", "tddai"]
    capabilities: 
      - "web_scraping"
      - "documentation_parsing" 
      - "issue_analysis"
      - "git_repository_analysis"
      - "drupal_expertise"
      - "security_assessment"
    frameworks: ["tddai", "drupal"]
    workspace_integration: true

servers:
  - url: "http://localhost:3021/api/v1"
    description: "Local TDDAI execution environment"
  - url: "https://llm.bluefly.io/agents/drupal-research/api/v1"
    description: "Production deployment"

paths:
  /research/module:
    post:
      operationId: "researchDrupalModule"
      summary: "Research Drupal module comprehensively"
      description: |
        Performs exhaustive research on a Drupal contributed module including:
        
        **Phase 1: Module Discovery**
        - Extract module metadata from drupal.org project page
        - Analyze release history, stability, and usage statistics
        - Map related modules, dependencies, and alternatives
        
        **Phase 2: Documentation Analysis** 
        - Follow documentation links in project sidebar
        - Parse ALL documentation pages recursively
        - Extract configuration examples and code samples
        - Build comprehensive knowledge base
        
        **Phase 3: Issue Queue Mining**
        - Read ALL open issues (critical, major, normal, minor)
        - Read ALL closed issues to identify patterns
        - Extract common problems and community solutions
        - Assess maintainer responsiveness and support quality
        
        **Phase 4: Code Analysis**
        - Transform git clone URL to browsable web interface
        - Analyze latest stable version architecture
        - Compare with previous 2 major versions for changes
        - Document API evolution and breaking changes
        
        **Phase 5: Assessment & Recommendations**
        - Security vulnerability assessment
        - Performance impact analysis
        - Community health and maintenance quality
        - Integration recommendations and best practices
        
      tags:
        - "Module Research"
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModuleResearchRequest"
            examples:
              basic_research:
                summary: "Basic module research"
                value:
                  module_name: "webform"
                  research_depth: "comprehensive"
                  
              exhaustive_research:
                summary: "Exhaustive research with version analysis"
                value:
                  module_name: "views"
                  research_depth: "exhaustive"
                  version_analysis:
                    analyze_previous: 3
                    include_dev_versions: false
                  output_options:
                    format: "structured_markdown"
                    include_diagrams: true
                    
      responses:
        '200':
          description: "Research completed successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResearchResult"
                
        '202':
          description: "Research accepted and processing"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AsyncOperationResponse"
                
        '400':
          description: "Invalid module name or parameters"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                
        '429':
          description: "Rate limit exceeded"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RateLimitResponse"
                
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /research/status/{operation_id}:
    get:
      operationId: "getResearchStatus"
      summary: "Get status of ongoing research operation"
      description: |
        Returns the current status of a long-running research operation,
        including progress information and partial results if available.
        
      tags:
        - "Status Monitoring"
        
      parameters:
        - name: "operation_id"
          in: "path"
          required: true
          schema:
            type: "string"
            format: "uuid"
          description: "Unique identifier for the research operation"
          
      responses:
        '200':
          description: "Operation status retrieved successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationStatus"
                
        '404':
          description: "Operation not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /analyze/documentation:
    post:
      operationId: "analyzeModuleDocumentation"
      summary: "Parse and analyze module documentation"
      description: |
        Specialized endpoint for analyzing Drupal module documentation.
        Follows all documentation links and creates structured knowledge base.
        
      tags:
        - "Documentation Analysis"
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required: ["documentation_url"]
              properties:
                documentation_url:
                  type: "string"
                  format: "uri"
                  description: "Base documentation URL to analyze"
                  example: "https://www.drupal.org/docs/contributed-modules/webform"
                  
                follow_links:
                  type: "boolean"
                  default: true
                  description: "Whether to follow and analyze linked pages"
                  
                max_depth:
                  type: "integer"
                  default: 10
                  minimum: 1
                  maximum: 20
                  description: "Maximum depth of link following"
                  
                extract_code:
                  type: "boolean"
                  default: true
                  description: "Extract code examples and configurations"
                  
      responses:
        '200':
          description: "Documentation analysis completed"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DocumentationAnalysis"

  /analyze/issues:
    post:
      operationId: "analyzeModuleIssues"
      summary: "Analyze module issue queue comprehensively"
      description: |
        Analyzes all issues in a module's issue queue to extract patterns,
        common problems, and community health indicators.
        
      tags:
        - "Issue Analysis"
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required: ["module_name"]
              properties:
                module_name:
                  type: "string"
                  pattern: "^[a-z_]+$"
                  description: "Drupal module machine name"
                  example: "webform"
                  
                include_closed:
                  type: "boolean"
                  default: true
                  description: "Include closed issues in analysis"
                  
                categorize_issues:
                  type: "boolean" 
                  default: true
                  description: "Categorize issues by type and priority"
                  
                analyze_response_times:
                  type: "boolean"
                  default: true
                  description: "Analyze maintainer response times"
                  
                extract_solutions:
                  type: "boolean"
                  default: true
                  description: "Extract common solutions and workarounds"
                  
      responses:
        '200':
          description: "Issue analysis completed"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IssueAnalysis"

  /analyze/repository:
    post:
      operationId: "analyzeModuleRepository"
      summary: "Analyze module git repository and code"
      description: |
        Analyzes the git repository of a Drupal module including architecture,
        code quality, version history, and API changes.
        
      tags:
        - "Repository Analysis"
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required: ["module_name"]
              properties:
                module_name:
                  type: "string"
                  pattern: "^[a-z_]+$"
                  description: "Drupal module machine name"
                  
                branches:
                  type: "array"
                  items:
                    type: "string"
                  default: ["main", "11.x", "10.x", "9.x"]
                  description: "Git branches to analyze"
                  
                analyze_architecture:
                  type: "boolean"
                  default: true
                  description: "Analyze code architecture and patterns"
                  
                compare_versions:
                  type: "boolean"
                  default: true 
                  description: "Compare different versions for API changes"
                  
      responses:
        '200':
          description: "Repository analysis completed"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RepositoryAnalysis"

  /modules/search:
    get:
      operationId: "searchModules"
      summary: "Search for Drupal modules by criteria"
      description: |
        Search the analyzed module database by various criteria including
        functionality, security status, maintenance level, etc.
        
      tags:
        - "Module Discovery"
        
      parameters:
        - name: "query"
          in: "query"
          schema:
            type: "string"
          description: "Search query for module functionality"
          
        - name: "category"
          in: "query"
          schema:
            type: "string"
            enum: ["content", "user", "development", "administration", "commerce"]
          description: "Module category filter"
          
        - name: "security_status"
          in: "query"
          schema:
            type: "string"
            enum: ["secure", "advisories", "unknown"]
          description: "Security status filter"
          
        - name: "maintenance_level"
          in: "query"
          schema:
            type: "string"
            enum: ["actively_maintained", "minimally_maintained", "seeking_maintainer"]
          description: "Maintenance level filter"
          
      responses:
        '200':
          description: "Search results"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  results:
                    type: "array"
                    items:
                      $ref: "#/components/schemas/ModuleSummary"
                  total:
                    type: "integer"
                  page:
                    type: "integer"
                  per_page:
                    type: "integer"

  /health:
    get:
      operationId: "healthCheck"
      summary: "Agent health check"
      description: "Returns the operational status of the research agent"
      
      tags:
        - "System"
        
      responses:
        '200':
          description: "Agent is operational"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  status:
                    type: "string"
                    enum: ["healthy", "degraded", "unhealthy"]
                  version:
                    type: "string"
                  uptime:
                    type: "integer"
                  capabilities:
                    type: "array"
                    items:
                      type: "string"
                  rate_limits:
                    type: "object"
                    properties:
                      drupal_org:
                        type: "object"
                        properties:
                          remaining:
                            type: "integer"
                          reset_time:
                            type: "string"
                            format: "date-time"

components:
  schemas:
    ModuleResearchRequest:
      type: "object"
      required: ["module_name"]
      properties:
        module_name:
          type: "string"
          pattern: "^[a-z_]+$"
          description: "Drupal module machine name"
          example: "webform"
          
        research_depth:
          type: "string"
          enum: ["basic", "comprehensive", "exhaustive"]
          default: "comprehensive"
          description: |
            - basic: Module metadata and basic info only
            - comprehensive: Includes documentation and recent issues  
            - exhaustive: Complete analysis including all issues and versions
            
        version_analysis:
          type: "object"
          properties:
            analyze_previous:
              type: "integer"
              default: 2
              minimum: 0
              maximum: 10
              description: "Number of previous major versions to analyze"
              
            include_dev_versions:
              type: "boolean"
              default: false
              description: "Include development versions in analysis"
              
        output_options:
          type: "object"
          properties:
            format:
              type: "string"
              enum: ["json", "markdown", "structured_markdown"]
              default: "structured_markdown"
              
            include_diagrams:
              type: "boolean"
              default: false
              description: "Generate architecture diagrams where applicable"
              
            save_to_filesystem:
              type: "boolean"
              default: true
              description: "Save results to persistent storage"
              
        filters:
          type: "object"
          description: "Optional filters to focus the research"
          properties:
            skip_issues:
              type: "boolean"
              default: false
              
            skip_documentation:
              type: "boolean"
              default: false
              
            skip_code_analysis:
              type: "boolean"
              default: false
              
    ResearchResult:
      type: "object"
      properties:
        operation_id:
          type: "string"
          format: "uuid"
          description: "Unique identifier for this research operation"
          
        module_name:
          type: "string"
          description: "Module that was researched"
          
        status:
          type: "string"
          enum: ["completed", "partial", "failed"]
          
        completion_time:
          type: "string"
          format: "date-time"
          
        output_path:
          type: "string"
          description: "Filesystem path where results are saved"
          
        metrics:
          type: "object"
          properties:
            pages_analyzed:
              type: "integer"
            issues_processed:
              type: "integer"
            versions_analyzed:
              type: "integer"
            documentation_pages:
              type: "integer"
            
        summary:
          $ref: "#/components/schemas/ModuleSummary"
          
        detailed_findings:
          type: "object"
          properties:
            critical_issues:
              type: "array"
              items:
                type: "string"
                
            security_concerns:
              type: "array"
              items:
                type: "string"
                
            key_features:
              type: "array"
              items:
                type: "string"
                
            integration_points:
              type: "array"
              items:
                type: "string"
                
            maintenance_assessment:
              type: "object"
              properties:
                level:
                  type: "string"
                  enum: ["excellent", "good", "adequate", "poor", "abandoned"]
                last_release:
                  type: "string"
                  format: "date"
                response_time_avg:
                  type: "number"
                  description: "Average response time in days"
                  
    ModuleSummary:
      type: "object"
      properties:
        name:
          type: "string"
        title:
          type: "string"
        description:
          type: "string"
        version:
          type: "string"
        status:
          type: "string"
          enum: ["stable", "beta", "alpha", "dev"]
        usage_count:
          type: "integer"
        security_status:
          type: "string"
          enum: ["secure", "advisories", "unknown"]
        maintenance_level:
          type: "string"
        last_updated:
          type: "string"
          format: "date"
        categories:
          type: "array"
          items:
            type: "string"
            
    DocumentationAnalysis:
      type: "object"
      properties:
        pages_found:
          type: "integer"
        pages_analyzed:
          type: "integer"
        knowledge_base:
          type: "object"
          description: "Structured knowledge extracted from documentation"
        code_examples:
          type: "array"
          items:
            type: "object"
            properties:
              title:
                type: "string"
              code:
                type: "string"
              language:
                type: "string"
              source_url:
                type: "string"
                
    IssueAnalysis:
      type: "object"
      properties:
        total_issues:
          type: "integer"
        open_issues:
          type: "integer"
        closed_issues:
          type: "integer"
        issue_categories:
          type: "object"
          additionalProperties:
            type: "integer"
        common_problems:
          type: "array"
          items:
            type: "object"
            properties:
              problem:
                type: "string"
              frequency:
                type: "integer"
              solutions:
                type: "array"
                items:
                  type: "string"
                  
    RepositoryAnalysis:
      type: "object"
      properties:
        repository_url:
          type: "string"
        branches_analyzed:
          type: "array"
          items:
            type: "string"
        architecture:
          type: "object"
          description: "Code architecture analysis"
        api_changes:
          type: "array"
          items:
            type: "object"
            properties:
              version_from:
                type: "string"
              version_to:
                type: "string"
              breaking_changes:
                type: "array"
                items:
                  type: "string"
                  
    AsyncOperationResponse:
      type: "object"
      properties:
        operation_id:
          type: "string"
          format: "uuid"
        status:
          type: "string"
          enum: ["accepted", "processing"]
        estimated_completion:
          type: "string"
          format: "date-time"
        status_url:
          type: "string"
          format: "uri"
          
    OperationStatus:
      type: "object"
      properties:
        operation_id:
          type: "string"
        status:
          type: "string"
          enum: ["processing", "completed", "failed", "cancelled"]
        progress:
          type: "number"
          minimum: 0
          maximum: 100
          description: "Completion percentage"
        current_phase:
          type: "string"
          enum: ["discovery", "documentation", "issues", "code_analysis", "synthesis"]
        current_task:
          type: "string"
        estimated_completion:
          type: "string"
          format: "date-time"
        partial_results:
          type: "object"
          description: "Partial results available during processing"
          
    ErrorResponse:
      type: "object"
      properties:
        error:
          type: "string"
        message:
          type: "string"
        details:
          type: "object"
        timestamp:
          type: "string"
          format: "date-time"
          
    RateLimitResponse:
      type: "object"
      properties:
        error:
          type: "string"
          enum: ["rate_limit_exceeded"]
        retry_after:
          type: "integer"
          description: "Seconds to wait before retrying"
        limit:
          type: "integer"
        remaining:
          type: "integer"
        reset_time:
          type: "string"
          format: "date-time"

  securitySchemes:
    ApiKey:
      type: "apiKey"
      in: "header"
      name: "X-API-Key"
      description: "API key for authenticated access"
      
    BearerAuth:
      type: "http"
      scheme: "bearer"
      description: "JWT token for authenticated access"

security:
  - ApiKey: []
  - BearerAuth: []

# OAAS Protocol Bridge Extensions
x-protocol-bridges:
  mcp:
    enabled: true
    tools_endpoint: "/mcp/tools"
    resources:
      - name: "drupal_modules"
        uri: "file:///Users/flux423/Sites/LLM/models/tddai_model/drupal_modules"
        description: "Analyzed Drupal modules knowledge base"
        
  tddai:
    enabled: true
    workflow_integration: true
    test_generation: true
    endpoints:
      - "/tddai/workflows"
      - "/tddai/tests/generate"
      
# Token optimization for Claude Code integration
x-token-optimization:
  enabled: true
  strategies:
    - "url_deduplication"
    - "content_hashing"
    - "incremental_parsing"
    - "smart_caching"
  max_tokens_per_response: 1500
  compression:
    enabled: true
    algorithms: ["gzip", "brotli"]
    
# UADP Integration
x-uadp:
  version: "1.0.0"
  discovery:
    advertise_capabilities: true
    context_sharing: true
    workspace_integration: true
  orchestration:
    participates: true
    conflict_resolution: "capability_priority"
    load_balancing: "round_robin"