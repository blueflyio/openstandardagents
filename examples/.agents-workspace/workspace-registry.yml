# Workspace-Level Agent Registry - GOLDEN STANDARD
# Universal Agent Discovery Protocol (UADP) v1.0
# OpenAPI AI Agents Standard (OAAS) v0.1.1

apiVersion: "openapi-ai-agents/v0.1.1"
kind: "WorkspaceRegistry"
metadata:
  name: "enterprise-workspace-registry"
  version: "1.0.0"
  created: "2025-01-26"
  updated: "2025-01-26"
  description: "Master registry for workspace-level agent discovery and orchestration"
  
  annotations:
    # Workspace-level UADP annotations
    workspace.uadp/discovery-enabled: "true"
    workspace.uadp/orchestration-enabled: "true"
    workspace.uadp/auto-scaling: "true"
    workspace.uadp/cross-project-routing: "enabled"
    workspace.uadp/compliance-monitoring: "automated"
    
    # Enterprise governance
    enterprise/organization: "your-organization-name"
    enterprise/domain: "your-primary-domain"
    enterprise/compliance-level: "gold"
    enterprise/security-classification: "internal"
    
    # Framework support
    frameworks/langchain: "supported"
    frameworks/crewai: "supported" 
    frameworks/autogen: "bridge"
    frameworks/openai: "supported"
    frameworks/anthropic: "bridge"
    frameworks/google: "supported"
    frameworks/microsoft: "bridge"
    
  labels:
    organization: "your-org"
    environment: "production"
    tier: "enterprise"
    compliance: "gold"

spec:
  # === WORKSPACE CONFIGURATION ===
  workspace:
    name: "Enterprise AI Agent Workspace"
    description: |
      Comprehensive workspace enabling automatic discovery, orchestration, and management
      of AI agents across multiple projects within the enterprise environment.
      
    organization: "Your Organization Name"
    domain: "enterprise-technology"
    contact:
      technical_lead: "platform-team@your-org.com"
      business_owner: "ai-governance@your-org.com"
      security_contact: "security@your-org.com"
    
    # Workspace metadata
    metadata:
      total_projects: 0  # Auto-updated by discovery engine
      active_agents: 0   # Auto-updated by orchestrator
      compliance_score: 95  # Calculated from project compliance
      last_discovery_scan: "2025-01-26T10:00:00Z"
      
  # === DISCOVERY CONFIGURATION ===
  discovery:
    # Automatic project discovery settings
    auto_discovery:
      enabled: true
      scan_interval: "300s"  # 5 minutes
      scan_patterns:
        - "*/.agents/agent-registry.yml"
        - "*/.agents/*/agent.yml"
        - "*/package.json"  # Node.js projects
        - "*/requirements.txt"  # Python projects
        - "*/pom.xml"  # Java projects
        - "*/Cargo.toml"  # Rust projects
        - "*/go.mod"  # Go projects
        
    # Discovery engine configuration
    discovery_engine:
      max_depth: 5  # Directory traversal depth
      exclude_patterns:
        - "node_modules"
        - ".git"
        - "dist"
        - "build"
        - ".next"
        - "__pycache__"
        - "target"
        
      project_detection:
        minimum_indicators: 1
        confidence_threshold: 0.8
        auto_categorization: true
        
    # Legacy project migration
    migration:
      auto_suggest: true
      migration_templates: "./migration-standardization/data/conversion-templates.json"
      compatibility_check: true
      
  # === ORCHESTRATION CONFIGURATION ===
  orchestration:
    # Universal orchestrator settings
    universal_orchestrator:
      enabled: true
      load_balancing: "intelligent"  # round-robin, least-connections, intelligent
      health_monitoring: true
      auto_scaling: true
      
    # Routing configuration
    routing:
      strategy: "optimal_capability_match"  # round-robin, capability-based, optimal_capability_match
      cross_project_routing: true
      fallback_agents: true
      timeout_seconds: 30
      
    # Load balancing
    load_balancing:
      algorithm: "least_response_time"
      health_check_interval: "30s"
      unhealthy_threshold: 3
      recovery_threshold: 2
      
    # Scaling policies
    scaling:
      enabled: true
      min_replicas_per_agent: 1
      max_replicas_per_agent: 10
      scale_up_threshold: 80  # CPU/Memory %
      scale_down_threshold: 20
      scale_down_delay: "5m"
      
  # === PROJECT DISCOVERY RESULTS ===
  discovered_projects:
    # This section is auto-populated by the discovery engine
    # Example entries (will be dynamically updated):
    
    - project_id: "backend-api"
      path: "./backend-api"
      status: "active"
      agents_count: 3
      compliance_level: "gold"
      frameworks: ["node.js", "express"]
      last_updated: "2025-01-26T09:30:00Z"
      agents:
        - name: "api-validator"
          capabilities: ["validation", "security-scan", "performance-test"]
          status: "healthy"
        - name: "database-optimizer"
          capabilities: ["query-optimization", "schema-analysis"]
          status: "healthy" 
        - name: "api-documentation-generator"
          capabilities: ["openapi-generation", "docs-generation"]
          status: "healthy"
          
    - project_id: "frontend-app"
      path: "./frontend-app"
      status: "active"
      agents_count: 2
      compliance_level: "silver"
      frameworks: ["react", "typescript"]
      last_updated: "2025-01-26T08:45:00Z"
      agents:
        - name: "component-analyzer"
          capabilities: ["accessibility-check", "performance-audit"]
          status: "healthy"
        - name: "ui-test-generator"
          capabilities: ["test-generation", "snapshot-testing"]
          status: "healthy"
          
    - project_id: "ml-pipeline"
      path: "./ml-pipeline"  
      status: "active"
      agents_count: 4
      compliance_level: "gold"
      frameworks: ["python", "tensorflow", "pytorch"]
      last_updated: "2025-01-26T10:15:00Z"
      agents:
        - name: "data-preprocessor"
          capabilities: ["data-cleaning", "feature-engineering"]
          status: "healthy"
        - name: "model-trainer"
          capabilities: ["model-training", "hyperparameter-tuning"]
          status: "healthy"
        - name: "model-validator"
          capabilities: ["model-validation", "bias-detection"]
          status: "healthy"
        - name: "deployment-optimizer"
          capabilities: ["model-optimization", "inference-scaling"]
          status: "healthy"
          
    - project_id: "mobile-app"
      path: "./mobile-app"
      status: "development"
      agents_count: 1  
      compliance_level: "bronze"
      frameworks: ["react-native", "expo"]
      last_updated: "2025-01-26T07:20:00Z"
      agents:
        - name: "mobile-performance-monitor"
          capabilities: ["performance-monitoring", "crash-reporting"]
          status: "developing"
          
    - project_id: "legacy-system"
      path: "./legacy-system"
      status: "migration_needed"
      agents_count: 0
      compliance_level: "none"
      frameworks: ["java", "spring"]
      migration_suggestions:
        - "Add .agents/ folder structure"
        - "Implement OAAS-compliant agent for legacy system management"
        - "Enable monitoring and security scanning"
      
  # === CAPABILITY AGGREGATION ===
  aggregated_capabilities:
    # Auto-generated capability index across all projects
    primary_capabilities:
      - name: "code_analysis"
        projects: ["backend-api", "frontend-app"]
        agents: ["api-validator", "component-analyzer"]
        confidence: 0.95
        
      - name: "performance_optimization"
        projects: ["backend-api", "frontend-app", "ml-pipeline"]
        agents: ["database-optimizer", "component-analyzer", "deployment-optimizer"]
        confidence: 0.90
        
      - name: "security_scanning"
        projects: ["backend-api"]
        agents: ["api-validator"]
        confidence: 0.85
        
      - name: "test_generation"
        projects: ["frontend-app"]
        agents: ["ui-test-generator"]
        confidence: 0.80
        
      - name: "documentation_generation"
        projects: ["backend-api"]
        agents: ["api-documentation-generator"]
        confidence: 0.88
        
      - name: "data_processing"
        projects: ["ml-pipeline"]
        agents: ["data-preprocessor"]
        confidence: 0.92
        
      - name: "model_training"
        projects: ["ml-pipeline"]
        agents: ["model-trainer"]
        confidence: 0.94
        
      - name: "model_validation"
        projects: ["ml-pipeline"]
        agents: ["model-validator"]
        confidence: 0.89
        
    # Emerging capabilities (agents in development)
    emerging_capabilities:
      - name: "mobile_performance_monitoring"
        projects: ["mobile-app"]
        agents: ["mobile-performance-monitor"]
        maturity: "developing"
        
  # === RESOURCE MANAGEMENT ===
  resource_management:
    # Compute resource allocation
    compute_allocation:
      total_cpu_cores: 50
      total_memory_gb: 200
      total_storage_tb: 5
      
      department_quotas:
        engineering:
          cpu_cores: 25
          memory_gb: 100
          storage_tb: 2
        data_science:
          cpu_cores: 20
          memory_gb: 80
          storage_tb: 2.5
        product:
          cpu_cores: 5
          memory_gb: 20
          storage_tb: 0.5
          
    # Token budget management
    token_budgets:
      monthly_total: 5000000  # 5M tokens/month
      cost_center_allocation:
        engineering: 
          budget: 2000000  # 40%
          models: ["gpt-4", "claude-3", "gemini-pro"]
        data_science:
          budget: 1750000  # 35%
          models: ["gpt-4", "claude-3", "codex"]
        product:
          budget: 1250000  # 25%
          models: ["gpt-3.5", "claude-instant"]
          
      optimization:
        target_savings: "35-45%"
        caching_enabled: true
        compression_enabled: true
        deduplication_enabled: true
        
  # === SECURITY & COMPLIANCE ===
  security:
    # Authentication configuration
    authentication:
      method: "enterprise_sso"
      providers: 
        - "okta"
        - "azure_ad"
        - "google_workspace"
      mfa_required: true
      session_timeout: "8h"
      
    # Authorization model
    authorization:
      rbac_enabled: true
      roles:
        workspace_admin:
          description: "Full workspace management access"
          permissions: ["workspace:*", "project:*", "agent:*", "compliance:*"]
          members: ["platform-team@your-org.com"]
          
        project_lead:
          description: "Project-level management and agent deployment"
          permissions: ["project:read", "project:update", "agent:deploy", "agent:monitor", "metrics:read"]
          scope: "assigned_projects"
          
        developer:
          description: "Agent execution and basic monitoring"
          permissions: ["agent:execute", "agent:read", "metrics:read"]
          scope: "assigned_projects"
          
        security_auditor:
          description: "Security monitoring and compliance reporting"
          permissions: ["security:read", "compliance:read", "audit:read"]
          scope: "all_projects"
          
    # Data protection
    data_protection:
      encryption_at_rest: true
      encryption_in_transit: "tls_1_3"
      key_management: "enterprise_vault"
      pii_detection: true
      data_classification: "automatic"
      
      retention_policies:
        logs: "2_years"
        metrics: "5_years" 
        audit_trails: "7_years"
        agent_data: "by_classification"
        
  # === COMPLIANCE FRAMEWORKS ===
  compliance:
    # Enterprise compliance requirements
    frameworks:
      iso_42001:
        status: "compliant"
        certification_date: "2024-12-15"
        next_audit: "2025-12-15"
        controls_implemented: 47
        controls_total: 47
        
      nist_ai_rmf:
        status: "compliant"
        assessment_date: "2024-11-20"
        next_assessment: "2025-11-20"
        functions:
          govern: "implemented"
          map: "implemented"
          measure: "implemented" 
          manage: "implemented"
          
      eu_ai_act:
        status: "compliant"
        risk_category: "limited_risk"
        compliance_date: "2024-10-30"
        requirements_met: ["transparency", "human_oversight", "accuracy", "robustness"]
        
      sox_404:
        status: "compliant"
        scope: "financial_reporting_agents"
        controls: ["access_control", "audit_trails", "data_integrity"]
        
    # Automated compliance monitoring
    monitoring:
      continuous_compliance: true
      violation_alerts: true
      auto_remediation: "low_risk_only"
      reporting_frequency: "weekly"
      
  # === MONITORING & OBSERVABILITY ===
  monitoring:
    # Health monitoring
    health_checks:
      workspace_level:
        endpoint: "/health/workspace"
        interval: "60s"
        timeout: "10s"
        
      project_level:
        endpoint: "/health/projects"
        interval: "30s"
        timeout: "5s"
        
      agent_level:
        endpoint: "/health/agents"
        interval: "15s"
        timeout: "3s"
        
    # Metrics collection
    metrics:
      collection_enabled: true
      retention: "90d"
      aggregation_levels: ["workspace", "project", "agent"]
      
      custom_metrics:
        - name: "workspace_agent_utilization"
          type: "gauge"
          labels: ["project", "agent", "capability"]
          
        - name: "cross_project_routing_count"
          type: "counter" 
          labels: ["source_project", "target_project", "capability"]
          
        - name: "compliance_score"
          type: "gauge"
          labels: ["project", "framework"]
          
        - name: "token_usage_by_department"
          type: "counter"
          labels: ["department", "model", "project"]
          
        - name: "cost_optimization_savings"
          type: "gauge"
          labels: ["optimization_type", "project"]
          
    # Alerting configuration
    alerting:
      enabled: true
      channels:
        slack: "#ai-agents-alerts"
        email: ["platform-team@your-org.com"]
        pagerduty: "AI-AGENTS-SERVICE"
        
      rules:
        - name: "agent_unavailable"
          condition: "agent_status != 'healthy' for 5m"
          severity: "critical"
          
        - name: "high_error_rate"
          condition: "error_rate > 5% for 10m"
          severity: "warning"
          
        - name: "compliance_violation"
          condition: "compliance_score < 0.9"
          severity: "critical"
          
        - name: "budget_exceeded"
          condition: "monthly_token_usage > budget * 0.9"
          severity: "warning"
          
  # === PERFORMANCE OPTIMIZATION ===
  performance:
    # Workspace-level optimization
    optimization:
      enabled: true
      target_token_savings: "35-45%"
      strategies:
        - "cross_project_caching"
        - "intelligent_routing"
        - "agent_consolidation"
        - "request_deduplication"
        
    # Caching configuration
    caching:
      levels:
        workspace:
          type: "redis_cluster"
          ttl: "24h"
          max_size: "10GB"
          
        project:
          type: "redis"
          ttl: "6h" 
          max_size: "1GB"
          
        agent:
          type: "memory"
          ttl: "1h"
          max_size: "256MB"
          
    # Load testing and benchmarking
    benchmarking:
      enabled: true
      frequency: "weekly"
      scenarios:
        - "high_load_cross_project"
        - "compliance_audit_simulation"
        - "disaster_recovery"
        
  # === INTEGRATION CONFIGURATION ===
  integrations:
    # External system integrations
    external_systems:
      kubernetes:
        enabled: true
        cluster_endpoint: "https://k8s-api.your-org.com"
        namespace: "ai-agents"
        auto_scaling: true
        
      grafana:
        enabled: true
        dashboard_url: "https://grafana.your-org.com"
        workspace_dashboard: "ai-agents-workspace"
        
      splunk:
        enabled: true
        index: "ai-agents"
        log_forwarding: true
        
      jira:
        enabled: true
        project_key: "AIAG"
        auto_ticket_creation: "compliance_violations"
        
    # Cloud provider integrations
    cloud_providers:
      aws:
        region: "us-east-1"
        services: ["eks", "s3", "cloudwatch"]
        
      azure:
        region: "eastus"
        services: ["aks", "monitor", "keyvault"]
        
      gcp:
        region: "us-central1"
        services: ["gke", "monitoring", "secretmanager"]

# === STATUS TRACKING ===
status:
  # Overall workspace status
  workspace_status:
    phase: "operational"
    health: "healthy"
    last_updated: "2025-01-26T10:00:00Z"
    uptime: "99.9%"
    
  # Discovery engine status
  discovery_status:
    last_scan: "2025-01-26T10:00:00Z"
    projects_discovered: 5
    agents_discovered: 10
    migration_candidates: 1
    
  # Orchestration status
  orchestration_status:
    active_workflows: 12
    queued_requests: 3
    average_response_time: "150ms"
    
  # Compliance status
  compliance_status:
    overall_score: 0.95
    frameworks_compliant: 4
    violations_count: 0
    last_audit: "2025-01-26T00:00:00Z"
    
  # Performance metrics
  performance_metrics:
    token_optimization_ratio: "42%"
    cost_savings_monthly: "$15,000"
    agent_utilization: "78%"
    error_rate: "0.02%"