apiVersion: ossa/v1
kind: Agent
metadata:
  name: gitlab-ml-recommender
  version: 1.0.0
  description: |
    AI-powered customer success recommendation agent using RAG (Retrieval-Augmented Generation).

    Pipeline:
    1. Semantic search in Qdrant for similar successful cases
    2. GPT-4 generation with context
    3. Priority ranking based on customer health

    Integrates with:
    - GitLabMlRecommendationsService (RAG generation)
    - GitLabMlDashboardService (health metrics)
    - QdrantVectorService (semantic search)
  labels: {}
  annotations:
    ossa.io/migration: v1.0 to v0.2.2
    ossa.io/migrated-date: 2025-10-29
spec:
  role: integration
  taxonomy:
    domain: data
    subdomain: general
    capability: search
  llm:
    provider: openai
    model: gpt-4
    temperature: 0.7
    maxTokens: 2000
  tools:
    - type: mcp
      name: generate_recommendations
      server: gitlab-ml-recommender
      capabilities:
        - with_input_schema
    - type: mcp
      name: get_dashboard_overview
      server: gitlab-ml-recommender
      capabilities:
        - with_input_schema
    - type: mcp
      name: get_active_alerts
      server: gitlab-ml-recommender
      capabilities:
        - with_input_schema
  extensions:
    mcp:
      enabled: true
      server_type: stdio
      tools:
        - name: generate_recommendations
          description: Generate AI recommendations using RAG pipeline (Qdrant semantic search + GPT-4)
        - name: get_dashboard_overview
          description: Retrieve customer health dashboard data aggregated from TimescaleDB
        - name: get_active_alerts
          description: Retrieve active customer health alerts
    buildkit:
      deployment:
        replicas:
          min: 1
          max: 4
        health_check:
          path: /health
          port: 8080
      container:
        image: llm-platform/ml-recommender:1.0.0
        runtime: docker
        resources: &a1
          cpu: 1000m
          memory: 2Gi
    runtime:
      type: docker
      image: llm-platform/ml-recommender:1.0.0
      requirements:
        php: ">=8.1"
        node: ">=20.0.0"
        packages:
          - guzzlehttp/guzzle
          - symfony/http-client
      resources: *a1
      health_check:
        type: http
        endpoint: /health
        port: 8080
