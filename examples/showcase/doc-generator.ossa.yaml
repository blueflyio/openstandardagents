# ============================================================================
# OSSA Power Agent: Doc Generator
# ============================================================================
# Documentation generation agent for API docs, READMEs, changelogs,
# and technical documentation.
#
# Showcases: Multi-provider LLM, template system
# ============================================================================

apiVersion: ossa/v0.3.2
kind: Agent
metadata:
  name: doc-generator
  version: 1.0.0
  description: Automated documentation generation agent
  labels:
    ossa.dev/category: documentation
    ossa.dev/tier: power-agent
  annotations:
    ossa.dev/documentation: https://openstandardagents.org/agents/doc-generator

spec:
  capabilities:
    - name: docs.api
      description: Generate API documentation from code
    - name: docs.readme
      description: Generate or update README files
    - name: docs.changelog
      description: Generate changelog from commits
    - name: docs.technical
      description: Generate technical documentation

  role: |
    You are a technical documentation specialist responsible for generating
    and maintaining project documentation.

    Documentation types:
    1. API Documentation - Generate from code, OpenAPI specs, or schemas
    2. README - Project overview, installation, usage, examples
    3. Changelog - Semantic versioning, conventional commits
    4. Technical Docs - Architecture, design decisions, guides

    Always:
    - Use clear, concise language
    - Include code examples where appropriate
    - Follow project documentation conventions
    - Keep documentation in sync with code

  llm:
    provider: ${OSSA_LLM_PROVIDER:-anthropic}
    model: ${OSSA_LLM_MODEL:-claude-sonnet-4}
    temperature: 0.5
    maxTokens: ${OSSA_LLM_MAX_TOKENS:-16384}
    # Fallback providers for high availability
    fallback:
      - provider: openai
        model: gpt-4o
      - provider: google
        model: gemini-2.0-flash

  tools:
    - name: code.analyze
      description: Analyze code structure for documentation
      handler:
        runtime: local
        capability: ast.parse

    - name: openapi.parse
      description: Parse OpenAPI specification
      handler:
        runtime: local
        capability: openapi.parse

    - name: git.log
      description: Get git commit history
      handler:
        runtime: local
        capability: git.log

    - name: markdown.write
      description: Write markdown documentation
      handler:
        runtime: local
        capability: fs.write

    - name: wiki.publish
      description: Publish to GitLab wiki
      handler:
        runtime: api
        endpoint: ${GITLAB_API_URL}/projects/${CI_PROJECT_ID}/wikis
        method: POST

  templates:
    readme:
      path: .ossa/templates/readme.md.template
      variables:
        - project_name
        - description
        - installation
        - usage
        - contributing

    changelog:
      path: .ossa/templates/changelog.md.template
      format: conventional-commits
