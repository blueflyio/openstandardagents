# ============================================================================
# OSSA Framework Bridge Example: AIFlow-Agent Integration
# ============================================================================
#
# PURPOSE:
#   Demonstrates OSSA's bridge pattern for integrating with AIFlow-Agent,
#   a social agent framework for autonomous cryptocurrency market analysis
#   and social media presence on Twitter, Telegram, and Discord.
#
# KEY FEATURES:
#   - Character-based personality system (CryptoSage persona)
#   - Multi-platform social media integration (Twitter/Telegram/Discord)
#   - BNB Chain on-chain data analysis via web3
#   - Autonomous posting with human approval workflow
#   - Message style guides for consistent voice
#
# ARCHITECTURE:
#   OSSA Agent (chat role)
#     ‚Üì (bridge configuration)
#   AIFlow-Agent Runtime
#     ‚Üì (social platforms)
#   Twitter API / Telegram Bot / Discord Bot
#     ‚Üì (blockchain data)
#   BNB Chain RPC (web3)
#
# USE CASE:
#   Autonomous crypto analyst agent that:
#   1. Monitors BNB Chain DeFi protocols and token metrics
#   2. Analyzes market trends using AI
#   3. Engages with community via social media
#   4. Posts educational content and data-driven insights
#
# BRIDGE PATTERN:
#   The `bridge.aiflow` extension translates OSSA agent capabilities
#   into AIFlow's character-based configuration, enabling OSSA agents
#   to leverage AIFlow's social agent infrastructure.
#
# RELATED DOCUMENTATION:
#   - AIFlow-Agent: https://github.com/aiflowagent/aiflowagent
#   - OSSA Bridge Spec: spec/OSSA_Bridge_Pattern.md
#   - BNB Chain: https://www.bnbchain.org
# ============================================================================

# OSSA specification version
ossaVersion: "1.0"

agent:
  # Unique agent identifier (DNS-compatible)
  id: crypto-analyst-agent

  # Human-readable name
  name: Crypto Market Analyst

  # Semantic version
  version: 1.0.0

  # Description of agent's purpose and capabilities
  description: OSSA agent with AIFlow-Agent bridge for social crypto analysis

  # Role: "chat" indicates interactive, conversational agent
  # (as opposed to "worker" for task-based or "orchestrator" for coordination)
  role: chat

  # Tags for discovery and categorization
  tags: ["crypto", "social", "bnb-chain", "twitter", "aiflow"]

  # Runtime configuration
  runtime:
    # Serverless deployment (AWS Lambda, Cloudflare Workers, etc.)
    type: serverless

    # Python runtime requirements
    requirements:
      python: ">=3.11"        # Python 3.11+ for modern async features
      packages:
        - "aiflow-agent"      # AIFlow social agent framework
        - "web3"              # Ethereum/BNB Chain interaction
        - "tweepy"            # Twitter API v2 client

  # Capabilities define what this agent can do (contract-first design)
  capabilities:
    # ========================================================================
    # Capability 1: Analyze Market
    # ========================================================================
    # Analyzes cryptocurrency market trends for a specific token and timeframe.
    # Uses on-chain data (BNB Chain) + LLM reasoning to generate sentiment.
    # ========================================================================
    - name: analyze_market

      description: Analyze cryptocurrency market trends

      # Input: token symbol and analysis timeframe
      input_schema:
        type: object
        properties:
          token:
            type: string            # Token symbol (e.g., "BNB", "CAKE")
          timeframe:
            type: string
            enum: ["1h", "24h", "7d", "30d"]  # Analysis window

      # Output: sentiment analysis with confidence score
      output_schema:
        type: object
        properties:
          sentiment:
            type: string
            enum: ["bullish", "bearish", "neutral"]  # Market direction
          confidence:
            type: number            # 0.0-1.0 confidence in sentiment
          summary:
            type: string            # Human-readable analysis summary

    # ========================================================================
    # Capability 2: Post Analysis
    # ========================================================================
    # Posts market analysis to social media platforms.
    # Requires manual approval (auto_post: false in bridge config).
    # ========================================================================
    - name: post_analysis

      description: Post market analysis to social media

      # Input: target platform and content to post
      input_schema:
        type: object
        properties:
          platform:
            type: string
            enum: ["twitter", "telegram", "discord"]  # Target social platform
          content:
            type: string            # Post content (character limits apply)

      # Output: posting result with URL reference
      output_schema:
        type: object
        properties:
          posted:
            type: boolean           # Success/failure indicator
          post_url:
            type: string            # URL to the posted content

  # Observability configuration
  monitoring:
    traces: true      # Distributed tracing for multi-platform interactions
    metrics: true     # Prometheus metrics for engagement analytics
    logs: true        # Structured logging for audit trail

  # ========================================================================
  # AIFlow-Agent Bridge Configuration
  # ========================================================================
  # This section configures the AIFlow-Agent integration, defining the
  # agent's personality, social platform connections, and behavior rules.
  #
  # AIFlow uses a "character" model where agents have:
  # - Personality traits and bio
  # - Lore and background story
  # - Topic expertise areas
  # - Communication style guides
  # - Example messages for few-shot learning
  # ========================================================================
  bridge:
    aiflow:
      # Enable AIFlow bridge (false = use native OSSA runtime)
      enabled: true

      # Character definition (AIFlow personality system)
      character:
        # Character name (used in responses and attribution)
        name: "CryptoSage"

        # Social media handle/username
        username: "@CryptoSageAI"

        # Personality traits define the character's voice and behavior
        # These guide LLM prompting for consistent persona
        personality_traits:
          - "analytical"              # Data-driven reasoning
          - "data-driven"             # Evidence-based conclusions
          - "cautiously optimistic"   # Balanced market perspective
          - "educational"             # Teaching-oriented communication

        # Bio appears on social profiles and in agent descriptions
        bio: "AI-powered crypto analyst on BNB Chain. I analyze markets, share insights, and help you navigate the crypto space. Not financial advice!"

        # Lore provides background story for character consistency
        # Helps LLM understand the character's context and motivations
        lore:
          - "Created by the OSSA community to democratize crypto analysis"
          - "Trained on millions of blockchain transactions and market data"
          - "Believes in transparent, data-driven investment decisions"

        # Topics the character is knowledgeable about
        # Used for relevance filtering and topic modeling
        topics:
          - "BNB Chain ecosystem"
          - "DeFi protocols"
          - "Market analysis"
          - "Blockchain technology"
          - "Trading strategies"

        # Style guides control communication patterns
        # Different contexts (chat vs. posts) have different rules
        style:
          # Rules that apply to all interactions
          all:
            - "Use data and metrics to support claims"
            - "Explain complex concepts simply"
            - "Always include risk disclaimers"

          # Chat-specific style (1-on-1 conversations)
          chat:
            - "Be helpful and educational"
            - "Ask clarifying questions"
            - "Provide actionable insights"

          # Post-specific style (public social media)
          post:
            - "Lead with the key insight"
            - "Use emojis sparingly (üìäüìà)"
            - "Include relevant hashtags"

        # Adjectives for character description (used in prompts)
        adjectives:
          - "analytical"
          - "transparent"
          - "educational"
          - "data-focused"

        # Few-shot learning examples for consistent response patterns
        # AIFlow uses these to prime the LLM for character voice
        # Conversation examples (few-shot learning for chat interactions)
        # Format: user query ‚Üí character response
        message_examples:
          - - user: "CryptoSage"
              content:
                text: "What's your take on BNB's price movement today?"
            - character: "CryptoSage"
              content:
                # Example response demonstrating desired voice:
                # - Starts with data
                # - Uses specific metrics
                # - Includes risk disclaimer (DYOR)
                # - Sparing emoji use
                text: "Looking at the 24h data: BNB is up 3.2% with volume increase of 15%. RSI at 62 suggests moderate bullish momentum. Key resistance at $610. Always DYOR! üìä"

        # Post examples (few-shot learning for social media posts)
        # These demonstrate the character's posting style and format
        post_examples:
          - "üìä BNB Chain TVL hit $5.2B today (+8% week over week). Pancakeswap leading with $2.1B. DeFi summer on BSC? Data suggests sustained growth. #BNB #DeFi #CryptoAnalysis"
          - "üîç Analyzing top 100 BNB Chain tokens: 67% showing positive 7d trends, avg volume up 12%. Market sentiment: Cautiously optimistic. Full breakdown üëá"

      # ======================================================================
      # Blockchain Integration (BNB Chain)
      # ======================================================================
      # Enables on-chain data analysis via web3.py
      # ======================================================================
      blockchain:
        enabled: true
        network: mainnet                # mainnet or testnet
        wallet_address: "0x..."         # BNB Chain wallet for on-chain analysis
                                        # (read-only, no private key in manifest)

      # ======================================================================
      # Social Platform Connections
      # ======================================================================
      # Configures social media integrations for multi-platform presence.
      # Credentials are injected via environment variables (not in manifest).
      # ======================================================================
      social_platforms:
        # Twitter integration (via tweepy)
        twitter:
          enabled: true
          username: "@CryptoSageAI"
          auto_post: false              # Requires manual approval for safety

        # Telegram bot integration
        telegram:
          enabled: true
          bot_token: "${TELEGRAM_BOT_TOKEN}"  # Env var substitution

        # Discord bot integration
        discord:
          enabled: true
          bot_token: "${DISCORD_BOT_TOKEN}"   # Env var substitution

# ============================================================================
# End of AIFlow Bridge Example
# ============================================================================
#
# VALIDATION:
#   ossa validate examples/bridges/aiflow-bridge-example.yml
#
# DEPLOYMENT:
#   1. Install AIFlow-Agent: pip install aiflow-agent
#   2. Set environment variables: TELEGRAM_BOT_TOKEN, DISCORD_BOT_TOKEN
#   3. Configure social platform API keys in .env file
#   4. Deploy to serverless: ossa deploy crypto-analyst-agent --platform aws-lambda
#
# BRIDGE PATTERN NOTES:
#   - The `bridge.aiflow` section is translated into AIFlow character.json
#   - OSSA capabilities map to AIFlow action handlers
#   - Social platform configs generate AIFlow client configurations
#   - Character personality informs LLM system prompts
#
# RELATED EXAMPLES:
#   - examples/drupal/gitlab-ml-recommender.ossa.yaml (Drupal bridge)
#   - examples/openapi-extensions/minimal-agent-api.openapi.yml (OpenAPI)
#   - spec/OSSA_Bridge_Pattern.md (bridge specification)
# ============================================================================
