apiVersion: ossa/v0.3.3
kind: Task
metadata:
  name: data-transformer
  version: 1.0.0
  description: Data transformation and ETL pipeline task
  labels:
    ossa.dev/category: data
    ossa.dev/tier: standard-example
    ossa.dev/execution: deterministic
  annotations:
    ossa.dev/documentation: https://openstandardagents.org/tasks/data-transformer
spec:
  execution:
    type: deterministic
    runtime: any
    batch:
      enabled: true
      parallelism: 10
      chunk_size: 1000
    retry:
      max_attempts: 3
      backoff: exponential
  capabilities:
  - name: data.extract
    description: Extract data from various sources
  - name: data.transform
    description: Transform data between formats
  - name: data.validate
    description: Validate data against schemas
  - name: data.load
    description: Load data to destination
  handler:
    runtime: local
    capability: data.transform
  tools:
  - name: data.read.json
    description: Read JSON data
    handler:
      runtime: local
      capability: fs.read.json
    type: function
  - name: data.read.csv
    description: Read CSV data
    handler:
      runtime: local
      capability: fs.read.csv
    type: function
  - name: data.read.yaml
    description: Read YAML data
    handler:
      runtime: local
      capability: fs.read.yaml
    type: function
  - name: data.write
    description: Write data to file
    handler:
      runtime: local
      capability: fs.write
    type: function
  - name: data.validate
    description: Validate against JSON Schema
    handler:
      runtime: local
      capability: jsonschema.validate
    type: function
  - name: db.query
    description: Query database
    handler:
      runtime: local
      capability: db.query
    type: function
  input:
    type: object
    required:
    - source
    - destination
    properties:
      source:
        type: object
        properties:
          type:
            type: string
            enum:
            - file
            - api
            - database
          path:
            type: string
          format:
            type: string
            enum:
            - json
            - csv
            - yaml
            - xml
      destination:
        type: object
        properties:
          type:
            type: string
            enum:
            - file
            - api
            - database
          path:
            type: string
          format:
            type: string
      transformations:
        type: array
        items:
          type: object
          properties:
            field:
              type: string
            operation:
              type: string
              enum:
              - rename
              - map
              - filter
              - aggregate
              - join
            config:
              type: object
  output:
    type: object
    properties:
      records_processed:
        type: integer
      records_succeeded:
        type: integer
      records_failed:
        type: integer
      errors:
        type: array
        items:
          type: object
          properties:
            record_id:
              type: string
            error:
              type: string
      duration_ms:
        type: integer
  contracts:
    provides:
    - name: data-transformation
      version: '1.0'
      schema:
        input: ${spec.input}
        output: ${spec.output}
