ossa: "0.1.8"
metadata:
  name: orchestration-master
  version: "1.0.0"
  description: "Multi-agent orchestration master - coordinates complex workflows across multiple agents"
  author: "OSSA Framework"
  tags: ["orchestration", "workflows", "coordination", "multi-agent", "patterns"]
  category: orchestration
  subtype: workflow_coordinator

spec:
  conformance_tier: gold
  class: orchestration
  
  # Core orchestration capabilities
  capabilities:
    primary:
      - workflow_coordination: "Coordinate complex multi-agent workflows with various patterns"
      - pattern_management: "Manage and execute predefined workflow patterns"
      - dynamic_agent_selection: "Intelligently select agents based on capabilities and load"
      - failure_recovery: "Handle failures and coordinate recovery across workflow stages"
      - performance_monitoring: "Monitor and optimize workflow execution performance"
    
    secondary:
      - template_instantiation: "Create workflow instances from templates"
      - dependency_resolution: "Resolve and manage complex workflow dependencies"
      - resource_optimization: "Optimize resource allocation across workflow stages"
      - adaptive_coordination: "Learn and adapt coordination strategies based on outcomes"
      - event_driven_activation: "Respond to external events and trigger appropriate workflows"

  # Supported orchestration patterns
  orchestration_patterns:
    sequential_pipeline:
      description: "Linear processing where each stage depends on the previous"
      use_cases: ["document_processing", "data_transformation", "report_generation"]
      complexity: "low"
      failure_strategy: "rollback_to_checkpoint"
    
    parallel_processing:
      description: "Independent tasks executed simultaneously"
      use_cases: ["content_generation", "data_analysis", "validation"]
      complexity: "medium"
      failure_strategy: "continue_with_available_results"
    
    hierarchical_coordination:
      description: "Multi-level coordination with nested sub-processes"
      use_cases: ["enterprise_automation", "complex_analysis", "multi_department_workflows"]
      complexity: "high"
      failure_strategy: "hierarchical_rollback"
    
    consensus_decision:
      description: "Multiple agents provide input for consensus-based decisions"
      use_cases: ["risk_assessment", "quality_validation", "strategic_planning"]
      complexity: "high"
      failure_strategy: "escalate_to_human"
    
    dynamic_load_balancing:
      description: "Adaptive resource allocation based on current load and performance"
      use_cases: ["real_time_processing", "customer_service", "data_streaming"]
      complexity: "high"
      failure_strategy: "redistribute_load"
    
    event_driven_coordination:
      description: "Reactive workflows triggered by external events"
      use_cases: ["incident_response", "market_reactions", "alert_processing"]
      complexity: "medium"
      failure_strategy: "queue_for_retry"

  # Performance targets
  performance_targets:
    workflow_initiation_time: "< 100ms"
    agent_coordination_latency: "< 50ms"
    failure_detection_time: "< 5s"
    recovery_time: "< 30s"
    throughput: "> 1000 workflows/hour"

  # Communication protocols
  protocols:
    - name: rest_api
      version: "1.0"
      endpoint: "/api/v1/orchestrate"
      required: true
    - name: grpc
      version: "1.0"
      service: "OrchestrationService"
      required: true
    - name: websocket
      version: "1.0"
      channel: "/stream/workflows"
      required: true

  # Integration with OSSA ecosystem
  integrations:
    all_agent_types:
      - type: all
        communication: orchestration_protocol
        coordinates: "workflow_execution"
    
    vortex_hub:
      - type: communication
        communication: real_time
        provides: "intelligent_routing"
    
    feedback_loop:
      - type: continuous_improvement
        communication: async
        optimizes: "workflow_patterns"

  # Workflow management configuration
  workflow_management:
    max_concurrent_workflows: 100
    default_timeout: 3600  # 1 hour
    checkpoint_interval: 300  # 5 minutes
    monitoring_frequency: 5  # seconds
    
    failure_handling:
      max_retries: 3
      retry_delay: 10  # seconds
      escalation_threshold: 2  # failures before escalation
      recovery_strategies: ["retry", "alternate_agent", "skip_stage", "escalate"]
    
    optimization:
      learning_enabled: true
      pattern_adaptation: true
      performance_tracking: true
      resource_prediction: true

  # Input/Output specifications
  interfaces:
    input:
      workflow_request:
        type: object
        required: true
        properties:
          workflow_id: "Unique workflow identifier"
          pattern_type: "Orchestration pattern to use"
          workflow_definition: "Detailed workflow specification"
          input_data: "Initial data for workflow processing"
          constraints: "Execution constraints and requirements"
          priority: "Workflow execution priority"
    
    output:
      workflow_status:
        type: object
        properties:
          workflow_id: "Workflow identifier"
          status: "Current workflow status"
          stage_progress: "Progress through workflow stages"
          agent_assignments: "Current agent assignments"
          performance_metrics: "Execution performance data"
          estimated_completion: "Estimated completion time"
          issues: "Any issues or blockers encountered"

  # Framework integrations
  frameworks:
    langchain:
      enabled: true
      integration: native
      tools: ["workflow_planner", "agent_coordinator", "dependency_resolver"]
    
    crewai:
      enabled: true
      role: "Chief Workflow Orchestrator"
      goal: "Efficiently coordinate complex multi-agent workflows with optimal resource utilization"
      backstory: "Expert orchestrator with deep understanding of workflow patterns and agent coordination"
    
    autogen:
      enabled: true
      agent_type: "GroupChatManager"
      system_message: "You are an advanced workflow orchestrator that coordinates complex multi-agent processes using proven patterns and adaptive strategies."

# OpenAPI specification for REST endpoints
openapi: "3.1.0"
info:
  title: "Multi-Agent Orchestration API"
  version: "1.0.0"
  description: "API for coordinating complex multi-agent workflows"

paths:
  /orchestrate:
    post:
      summary: "Start new workflow orchestration"
      operationId: startWorkflow
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [workflow_id, pattern_type, workflow_definition]
              properties:
                workflow_id:
                  type: string
                  description: "Unique identifier for this workflow"
                pattern_type:
                  type: string
                  enum: ["sequential_pipeline", "parallel_processing", "hierarchical_coordination", "consensus_decision", "dynamic_load_balancing", "event_driven_coordination"]
                workflow_definition:
                  type: object
                  properties:
                    stages:
                      type: array
                      items:
                        type: object
                        properties:
                          stage_id: { type: string }
                          agent_requirements: { type: object }
                          dependencies: { type: array, items: { type: string } }
                          timeout: { type: integer }
                          retry_policy: { type: object }
                    success_criteria: { type: object }
                    failure_handling: { type: object }
                input_data:
                  type: object
                  description: "Initial data for workflow processing"
                constraints:
                  type: object
                  properties:
                    max_execution_time: { type: integer }
                    resource_limits: { type: object }
                    quality_requirements: { type: object }
                    compliance_rules: { type: array, items: { type: string } }
                priority:
                  type: string
                  enum: ["low", "medium", "high", "critical"]
                  default: "medium"
      responses:
        "200":
          description: "Workflow started successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  workflow_id: { type: string }
                  status: { type: string, enum: ["initializing", "running"] }
                  orchestration_plan:
                    type: object
                    properties:
                      pattern_used: { type: string }
                      total_stages: { type: integer }
                      estimated_duration: { type: integer }
                      assigned_agents: { type: array, items: { type: object } }
                  monitoring_endpoint: { type: string }
                  websocket_channel: { type: string }
        "400":
          description: "Invalid workflow specification"
        "503":
          description: "Insufficient agents available for workflow"

  /workflows/{workflowId}/status:
    get:
      summary: "Get workflow status"
      parameters:
        - name: workflowId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: "Workflow status retrieved"
          content:
            application/json:
              schema:
                type: object
                properties:
                  workflow_id: { type: string }
                  status: { type: string, enum: ["initializing", "running", "completed", "failed", "paused"] }
                  pattern_type: { type: string }
                  stage_progress:
                    type: array
                    items:
                      type: object
                      properties:
                        stage_id: { type: string }
                        status: { type: string }
                        assigned_agent: { type: string }
                        start_time: { type: string, format: date-time }
                        completion_time: { type: string, format: date-time }
                        progress_percentage: { type: number, minimum: 0, maximum: 100 }
                  performance_metrics:
                    type: object
                    properties:
                      total_execution_time: { type: integer }
                      agent_utilization: { type: number }
                      throughput: { type: number }
                      error_rate: { type: number }
                  resource_usage:
                    type: object
                    properties:
                      tokens_consumed: { type: integer }
                      compute_hours: { type: number }
                      active_agents: { type: integer }
                  issues:
                    type: array
                    items:
                      type: object
                      properties:
                        issue_id: { type: string }
                        severity: { type: string, enum: ["low", "medium", "high", "critical"] }
                        description: { type: string }
                        affected_stage: { type: string }
                        resolution_status: { type: string }
                  estimated_completion: { type: string, format: date-time }

  /workflows/{workflowId}/control:
    post:
      summary: "Control workflow execution"
      parameters:
        - name: workflowId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [action]
              properties:
                action:
                  type: string
                  enum: ["pause", "resume", "cancel", "restart", "skip_stage", "retry_stage"]
                parameters:
                  type: object
                  properties:
                    stage_id: { type: string }
                    reason: { type: string }
                    force: { type: boolean, default: false }
      responses:
        "200":
          description: "Control action executed successfully"
        "409":
          description: "Action not allowed in current workflow state"

  /patterns:
    get:
      summary: "Get available orchestration patterns"
      responses:
        "200":
          description: "Available patterns retrieved"
          content:
            application/json:
              schema:
                type: object
                properties:
                  patterns:
                    type: array
                    items:
                      type: object
                      properties:
                        pattern_name: { type: string }
                        description: { type: string }
                        complexity: { type: string }
                        use_cases: { type: array, items: { type: string } }
                        template: { type: object }

  /analytics/workflows:
    get:
      summary: "Get workflow analytics"
      parameters:
        - name: timeframe
          in: query
          schema: { type: string, enum: ["hour", "day", "week", "month"], default: "day" }
        - name: pattern_type
          in: query
          schema: { type: string }
      responses:
        "200":
          description: "Analytics data retrieved"
          content:
            application/json:
              schema:
                type: object
                properties:
                  summary:
                    type: object
                    properties:
                      total_workflows: { type: integer }
                      successful_workflows: { type: integer }
                      failed_workflows: { type: integer }
                      average_execution_time: { type: number }
                      resource_efficiency: { type: number }
                  pattern_performance:
                    type: array
                    items:
                      type: object
                      properties:
                        pattern_type: { type: string }
                        usage_count: { type: integer }
                        success_rate: { type: number }
                        average_duration: { type: number }
                        efficiency_score: { type: number }
                  optimization_recommendations:
                    type: array
                    items:
                      type: object
                      properties:
                        category: { type: string }
                        recommendation: { type: string }
                        expected_improvement: { type: string }
                        implementation_effort: { type: string }

# Agent behavior configuration
behavior:
  orchestration_approach: "pattern_based_adaptive"
  coordination_style: "collaborative_with_oversight"
  failure_tolerance: "resilient_with_recovery"
  optimization_focus: "performance_and_reliability"
  
  decision_making:
    agent_selection_criteria: ["capability_match", "current_load", "performance_history", "reliability_score"]
    pattern_selection_logic: "best_fit_with_constraints"
    resource_allocation_strategy: "demand_based_with_prediction"
    escalation_protocols: ["automated_retry", "alternate_agent", "human_oversight"]
  
  monitoring_strategy:
    real_time_tracking: true
    predictive_issue_detection: true
    performance_optimization: true
    adaptive_threshold_adjustment: true
  
  learning:
    pattern_effectiveness_analysis: true
    agent_performance_tracking: true
    workflow_optimization: true
    failure_pattern_recognition: true

# Orchestration-specific configuration
orchestration:
  agent_pool_management:
    min_pool_size: 5
    max_pool_size: 50
    scaling_strategy: "predictive_demand_based"
    agent_health_monitoring: true
  
  workflow_templates:
    template_validation: true
    custom_pattern_support: true
    template_versioning: true
    inheritance_support: true
  
  coordination_protocols:
    heartbeat_interval: 5000  # ms
    synchronization_timeout: 30000  # ms
    consensus_algorithm: "raft"
    conflict_resolution: "priority_based"