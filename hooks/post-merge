#!/bin/bash
#
# OSSA Post-Merge Hook
# Updates dependencies and rebuilds after merge
#

echo "ğŸ”„ OSSA Post-Merge Hook"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Check if package.json changed
if git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD | grep -q "package.json"; then
    echo -e "${YELLOW}âš  package.json changed - updating dependencies...${NC}"

    if [ -f "package.json" ]; then
        npm install
        echo -e "${GREEN}âœ“ Dependencies updated${NC}"
    fi
fi

# Check if schema files changed
if git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD | grep -qE "spec/.*/.*\.schema\.json"; then
    echo -e "${YELLOW}âš  Schema files changed${NC}"
    echo "  You may need to:"
    echo "  - Update examples to match new schema"
    echo "  - Rebuild documentation"
    echo "  - Update website schema explorer"
fi

echo -e "${GREEN}âœ“ Post-merge tasks complete${NC}"
exit 0
