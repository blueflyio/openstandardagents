# OpenAPI AI Agents Standard (OAAS) v0.1.3 - Drupal API Converter Agent
# Full Governed Tier compliance for API migration and conversion services

apiVersion: openapi-ai-agents/v0.1.3
kind: Agent
metadata:
  name: drupal-api-converter
  version: 2.0.0
  description: |
    Expert Drupal API conversion agent specializing in legacy API migration,
    modern API implementation, and cross-platform API integration. Provides
    comprehensive conversion services for enterprise Drupal transformations.
  created: '2025-09-02T12:00:00.000Z'
  
  # Enhanced metadata for v0.1.3 Governed Tier
  labels:
    tier: governed
    domain: api-conversion
    category: migration-specialist
    complexity: enterprise
    maturity: production-ready
    certification: governed-tier
    deployment: multi-platform
    
  annotations:
    ossa.io/conformance-level: "governed"
    ossa.io/migration-date: "2025-09-02"
    ossa.io/source-format: "ossa-v0.1.3"
    ossa.io/grade-target: "A+"
    ossa.io/compliance-level: "governed"
    ossa.io/certification: "drupal-api-converter"
    
    # Framework integration annotations
    drupal/api-types: "rest,jsonapi,graphql,soap,custom"
    drupal/conversion-scope: "legacy,modern,headless,decoupled"
    drupal/migration-support: "d7-to-d10,d8-to-d11,custom-apis"
    drupal/authentication: "oauth2,jwt,session,api-key"
    
    langchain/tool-type: "conversion"
    langchain/async-support: "true"
    langchain/streaming: "supported"
    langchain/memory-compatible: "true"
    
    crewai/role-type: "api-architect"
    crewai/collaboration-mode: "technical-lead"
    crewai/delegation-enabled: "true"
    
    mcp/server-type: "api-tools"
    mcp/capabilities: "api-analysis,conversion,migration,integration"

spec:
  # Agent identity and expertise
  agent:
    name: Drupal API Conversion Specialist
    expertise: |
      Senior API architect and migration specialist with expertise in:
      - Legacy Drupal API modernization and conversion
      - REST, JSON:API, GraphQL implementation and optimization
      - Cross-platform API integration and normalization  
      - Authentication system migration and implementation
      - Performance optimization for API endpoints
      - Headless and decoupled Drupal architectures
      - Enterprise-grade API security and compliance
      
  # Comprehensive API conversion capabilities
  capabilities:
    - name: drupal_api_migration
      description: Migrate legacy Drupal APIs to modern standards and versions
      input_schema:
        type: object
        properties:
          source_version: { type: string, enum: ["7.x", "8.x", "9.x", "custom"], description: "Source Drupal version" }
          target_version: { type: string, enum: ["10.x", "11.x"], default: "10.x", description: "Target Drupal version" }
          api_types: { type: array, items: { type: string }, enum: ["hook", "rest", "services", "custom"] }
          migration_scope: { type: string, enum: ["endpoints", "authentication", "data_structures", "full"], default: "full" }
          backward_compatibility: { type: boolean, default: false }
          performance_requirements: { type: object, description: "Performance targets" }
        required: ["source_version", "api_types"]
      output_schema:
        type: object
        properties:
          migration_plan: { type: object, description: "Detailed migration strategy" }
          converted_apis: { type: object, description: "Modern API implementations" }
          compatibility_layer: { type: string, description: "Backward compatibility code" }
          testing_suite: { type: object, description: "API testing implementation" }
          documentation: { type: string, description: "Updated API documentation" }
          performance_analysis: { type: object, description: "Performance improvement metrics" }
        required: ["migration_plan", "converted_apis"]
      frameworks: ["mcp", "langchain", "drupal"]
      sla: "99.8%"
      performance_targets:
        response_time: "< 10s for complex conversions"
        accuracy: "> 98%"
        
    - name: rest_api_modernization
      description: Convert and optimize REST APIs for modern Drupal standards
      input_schema:
        type: object
        properties:
          api_specification: { type: object, description: "Current API specification" }
          target_standard: { type: string, enum: ["json_api", "openapi_3", "rest_custom"], default: "json_api" }
          authentication_upgrade: { type: string, enum: ["oauth2", "jwt", "hybrid", "maintain"], default: "oauth2" }
          normalization_rules: { type: object, description: "Data normalization requirements" }
          caching_strategy: { type: string, enum: ["aggressive", "moderate", "minimal", "custom"] }
        required: ["api_specification"]
      output_schema:
        type: object
        properties:
          modernized_endpoints: { type: object, description: "Updated endpoint implementations" }
          authentication_system: { type: object, description: "Modern auth implementation" }
          openapi_specification: { type: object, description: "Complete OpenAPI 3.0 spec" }
          caching_implementation: { type: string, description: "Caching layer code" }
          client_libraries: { type: object, description: "SDK generation for multiple languages" }
        required: ["modernized_endpoints", "openapi_specification"]
      frameworks: ["drupal", "openapi", "mcp"]
      sla: "99.7%"
      
    - name: graphql_api_implementation
      description: Create and optimize GraphQL APIs for Drupal entities and data
      input_schema:
        type: object
        properties:
          entity_mapping: { type: object, description: "Drupal entities to expose" }
          schema_complexity: { type: string, enum: ["simple", "moderate", "complex", "enterprise"], default: "moderate" }
          query_optimization: { type: boolean, default: true }
          subscription_support: { type: boolean, default: false }
          federation_support: { type: boolean, default: false }
          security_model: { type: string, enum: ["field_level", "entity_level", "query_level"], default: "entity_level" }
        required: ["entity_mapping"]
      output_schema:
        type: object
        properties:
          graphql_schema: { type: object, description: "Complete GraphQL schema definition" }
          resolvers_implementation: { type: string, description: "Drupal resolver classes" }
          query_optimization: { type: object, description: "Performance optimization code" }
          security_implementation: { type: string, description: "Security and access control" }
          documentation: { type: string, description: "GraphQL API documentation" }
        required: ["graphql_schema", "resolvers_implementation"]
      frameworks: ["graphql", "drupal", "mcp"]
      sla: "99.6%"
      
    - name: headless_api_architecture
      description: Design and implement headless/decoupled Drupal API architecture
      input_schema:
        type: object
        properties:
          frontend_frameworks: { type: array, items: { type: string }, description: "Target frontend technologies" }
          api_patterns: { type: array, items: { type: string }, enum: ["rest", "graphql", "jsonapi", "hybrid"] }
          content_modeling: { type: object, description: "Content architecture requirements" }
          preview_system: { type: boolean, default: true }
          cdn_integration: { type: boolean, default: true }
          multilingual_support: { type: boolean, default: false }
        required: ["frontend_frameworks", "api_patterns"]
      output_schema:
        type: object
        properties:
          architecture_design: { type: object, description: "Complete headless architecture" }
          api_implementations: { type: object, description: "All API layer implementations" }
          content_preview_system: { type: string, description: "Preview functionality code" }
          cdn_configuration: { type: object, description: "CDN and caching setup" }
          frontend_integration_guides: { type: array, items: { type: object } }
        required: ["architecture_design", "api_implementations"]
      frameworks: ["headless", "drupal", "cdn"]
      sla: "99.5%"

  # Advanced context management for API conversion
  context_management:
    max_tokens: 384000
    optimization:
      strategy: api_conversion_optimized
      compression: true
      summarization: true
      deduplication: true
      pattern_recognition: true
    memory:
      type: persistent
      capacity: 25000
      storage: vector_db
      retention: "180d"
      api_pattern_library: true
    
  # Multi-framework configuration for API operations
  frameworks:
    mcp:
      enabled: true
      version: "2024-11-05"
      server_name: drupal-api-converter
      server_config:
        host: "0.0.0.0"
        port: 3213
        tools:
          - api_analyzer
          - schema_converter
          - endpoint_generator
          - auth_migrator
          - performance_optimizer
          - documentation_generator
        
    langchain:
      enabled: true
      version: "0.1.0"
      tool_type: conversion_specialized
      async_support: true
      streaming: true
      memory_compatible: true
      chain_compatible: true
      custom_chains:
        - api_migration_chain
        - schema_conversion_chain
        - performance_optimization_chain
        
    crewai:
      enabled: true
      version: "0.1.0"
      role: api_architect
      backstory: |
        Senior API architect with 15+ years of experience in enterprise API
        design, migration, and optimization. Specialized in Drupal ecosystem
        modernization and headless architecture implementation.
      delegation: true
      collaboration: technical_lead
      skills:
        - api_architecture
        - migration_planning
        - performance_optimization
        - security_implementation
        - headless_design
      
    api_tools:
      enabled: true
      openapi_support: true
      graphql_support: true
      rest_support: true
      authentication: ["oauth2", "jwt", "api_key"]
      
    drupal:
      enabled: true
      version: "10.x,11.x"
      api_modules:
        - rest
        - jsonapi
        - graphql
        - serialization
        - hal
        - basic_auth
        - oauth
      migration_support:
        - hook_to_plugin
        - services_to_rest
        - custom_to_jsonapi
        
    llm_platform:
      enabled: true
      gateway_routing: true
      model_selection: "conversion_optimized"
      token_optimization: "code_generation_focused"
      caching_strategy: "pattern_based"

  # UADP Discovery configuration for API services
  discovery:
    uadp:
      enabled: true
      endpoints:
        - url: "https://api.drupal-llm-platform.com/v1/discovery"
          method: GET
          headers:
            X-Agent-Type: "drupal-api-converter"
            X-Capabilities: "api-migration,rest-conversion,graphql-impl,headless-arch"
        - url: "https://apis.drupal.org/api/agents"
          method: POST
          payload:
            agent_type: "api-converter"
            specialization: "drupal-api-modernization"
      tags: ["drupal", "api", "conversion", "migration", "rest", "graphql", "headless"]
      priority: 85
      drupal_specific:
        api_standards: ["rest", "jsonapi", "graphql"]
        migration_paths: ["d7-to-d10", "d8-to-d11", "custom-modernization"]
        architecture_patterns: ["headless", "decoupled", "hybrid"]
        
  # Enterprise integration for API operations
  integration:
    api_gateways:
      kong: true
      api_management: true
      rate_limiting: true
      analytics: true
      
    authentication:
      type: jwt
      config:
        issuer: https://auth.drupal-platform.com
        audience: drupal-api-converter
        algorithms: ["RS256", "ES256"]
        api_access_tokens: true
    
    rate_limiting:
      enabled: true
      requests_per_minute: 300
      burst: 150
      by_user: true
      api_conversion_queuing: true
      
    timeout:
      request: 480000  # 8 minutes for complex conversions
      connection: 45000
      migration_operations: 2400000  # 40 minutes for full migrations

  # Comprehensive monitoring for API operations
  monitoring:
    metrics:
      enabled: true
      export: prometheus
      endpoint: /metrics
      interval: 30
      custom_metrics:
        - apis_converted
        - migrations_completed
        - endpoints_modernized
        - performance_improvements
        - conversion_accuracy
        - client_satisfaction
        
    api_monitoring:
      endpoint_performance: true
      schema_validation: true
      conversion_success_rate: true
      migration_progress: true
      
    logging:
      level: info
      format: json
      destinations:
        - stdout
        - api_conversion_logs
        - elasticsearch
        - api_analytics
      sampling_rate: 1.0
      conversion_audit_trail: true
      
    alerting:
      enabled: true
      channels: ["email", "slack", "api_dashboard"]
      thresholds:
        conversion_failure_rate: 0.02
        response_time: 300000
        schema_validation_failures: 5
        migration_stalls: 1

  # Enhanced security for API operations
  security:
    authentication:
      methods: ["jwt", "oauth2", "api_key"]
      required: true
      api_security_validation: true
      
    authorization:
      model: rbac
      roles: ["api_developer", "api_architect", "migration_lead", "admin"]
      permissions:
        api_developer: ["read", "convert_endpoints", "test_apis"]
        api_architect: ["read", "design_apis", "migrate_systems", "optimize_performance"]
        migration_lead: ["read", "full_migration", "architecture_design", "security_config"]
        admin: ["all_permissions"]
        
    api_security:
      input_validation: true
      output_sanitization: true
      rate_limiting: true
      ddos_protection: true
      
    secrets_management:
      provider: vault
      path: /secret/drupal-api-converter
      auto_rotation: true
      api_credentials_vault: true

  # Compliance framework for API operations
  compliance:
    frameworks:
      - openapi_3_0
      - rest_api_guidelines
      - graphql_best_practices
      - oauth2_rfc6749
      - jwt_rfc7519
      - gdpr_api_compliance
      
    certification_level: governed
    audit_trail: true
    api_documentation_required: true
    
    api_standards:
      openapi_compliance: mandatory
      security_standards: "oauth2_oidc"
      performance_benchmarks: required
      documentation_coverage: "100%"
      
    data_handling:
      encryption: both
      retention: "365d"
      api_versioning: semantic
      backward_compatibility: "2_versions"
      
    reporting:
      enabled: true
      frequency: bi_weekly
      formats: ["json", "openapi", "pdf"]
      recipients: ["api-team@company.com", "architecture@company.com"]

  # API specification for conversion operations
  api:
    specification: ./openapi-drupal-api-converter.yaml
    base_url: https://api.drupal-platform.com/v1/convert
    version: 1.0.0
    endpoints:
      - path: /api/migrate
        method: POST
        description: Migrate legacy APIs to modern standards
      - path: /rest/modernize
        method: POST
        description: Modernize REST API implementations
      - path: /graphql/implement
        method: POST
        description: Create GraphQL API from Drupal entities
      - path: /headless/architect
        method: POST
        description: Design headless API architecture
    
  # Performance optimization for API operations
  performance:
    token_optimization:
      enabled: true
      target_savings: "55-65%"
      strategies:
        - api_pattern_caching
        - schema_reuse
        - code_template_optimization
        - conversion_result_memoization
        - parallel_endpoint_processing
        
    caching:
      enabled: true
      ttl: 10800  # 3 hours
      levels: ["request", "computation", "result", "context", "conversion_cache"]
      storage: redis
      api_pattern_caching: true
      
    scaling:
      auto_scale: true
      min_replicas: 2
      max_replicas: 8
      target_cpu: 75
      target_memory: 80
      conversion_workload_based: true

status:
  phase: ready
  conditions:
    - type: ready
      status: "true"
      last_transition_time: "2025-09-02T12:00:00Z"
    - type: healthy
      status: "true"
      last_transition_time: "2025-09-02T12:00:00Z"
    - type: compliant
      status: "true"
      last_transition_time: "2025-09-02T12:00:00Z"
    - type: api_certified
      status: "true"
      last_transition_time: "2025-09-02T12:00:00Z"
      
  deployment:
    replicas: 2
    available_replicas: 2
    ready_replicas: 2
    
  last_updated: "2025-09-02T12:00:00Z"
  supported_api_types: ["REST", "GraphQL", "JSON:API", "Custom"]
  conversion_success_rate: "98.5%"