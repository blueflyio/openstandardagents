#!/usr/bin/env node

/**
 * OSSA Validate All
 * Validates all OSSA manifests in examples directory
 */

#!/usr/bin/env node

/**
 * OSSA Validate All
 * Validates all OSSA manifests in examples directory
 */

import { execSync } from 'child_process';
import { glob } from 'glob';
import { resolve, dirname } from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
const root = resolve(__dirname, '..');

async function main() {
  const examples = await glob('examples/**/*.ossa.{yaml,yml}', { cwd: root });
  
  if (examples.length === 0) {
    console.log('No OSSA manifests found in examples/');
    process.exit(0);
  }
  
  console.log(`Found ${examples.length} OSSA manifests to validate\n`);
  
  let passed = 0;
  let failed = 0;
  
  for (const file of examples) {
    try {
      execSync(`node bin/ossa validate ${file}`, { 
        cwd: root, 
        stdio: 'inherit' 
      });
      passed++;
    } catch (error) {
      failed++;
    }
  }
  
  console.log(`\nâœ… Passed: ${passed}`);
  console.log(`âŒ Failed: ${failed}`);
  process.exit(failed > 0 ? 1 : 0);
}

main();

