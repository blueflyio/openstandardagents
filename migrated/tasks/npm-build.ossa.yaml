# OSSA v0.3.0 Task: NPM Build
# Deterministic task - no LLM required
apiVersion: ossa/v0.3.0
kind: Task

metadata:
  name: npm-build
  version: 1.0.0
  description: Build NPM package with TypeScript compilation
  labels:
    domain: typescript
    tier: build
    category: compile
  annotations:
    ossa.io/created-date: "2025-12-09"

spec:
  execution:
    type: deterministic
    runtime: node
    entrypoint: npm run build
    timeout_seconds: 300

  capabilities:
    - typescript_compile
    - bundle_assets

  input:
    type: object
    properties:
      working_directory:
        type: string
        description: Directory containing package.json
      production:
        type: boolean
        description: Build for production
    required:
      - working_directory

  output:
    type: object
    properties:
      success:
        type: boolean
        description: Whether build completed successfully
      output_directory:
        type: string
        description: Path to build output
      duration_ms:
        type: integer
        description: Build duration in milliseconds

  dependencies:
    - ref: npm-install
      kind: Task
      optional: false

  error_handling:
    on_error: fail
    error_mapping:
      TYPESCRIPT_ERROR: fail
      OUT_OF_MEMORY: retry

  observability:
    logging:
      level: info
    metrics:
      enabled: true
      custom_labels:
        stage: build
    tracing:
      enabled: true
