# OSSA v0.3.0 Task: Git Commit
# Deterministic task - no LLM required
apiVersion: ossa/v0.3.0
kind: Task

metadata:
  name: git-commit
  version: 1.0.0
  description: Create a structured git commit with conventional commit format
  labels:
    domain: git
    tier: vcs
    category: commit
  annotations:
    ossa.io/created-date: "2025-12-09"

spec:
  execution:
    type: transactional
    runtime: any
    entrypoint: git commit
    timeout_seconds: 60

  capabilities:
    - git_commit
    - conventional_commits

  input:
    type: object
    properties:
      type:
        type: string
        description: Commit type (feat, fix, chore, etc.)
      scope:
        type: string
        description: Commit scope
      subject:
        type: string
        description: Commit subject line
      body:
        type: string
        description: Commit body
      issue_ref:
        type: string
        description: GitLab issue reference (e.g., #123)
      files:
        type: array
        items:
          type: string
        description: Files to stage and commit
    required:
      - type
      - subject

  output:
    type: object
    properties:
      commit_sha:
        type: string
        description: SHA of the created commit
      success:
        type: boolean
        description: Whether commit was created

  preconditions:
    - expression: "${{ input.type != '' }}"
      error_message: Commit type is required
    - expression: "${{ input.subject != '' }}"
      error_message: Commit subject is required

  error_handling:
    on_error: fail
    error_mapping:
      NOTHING_TO_COMMIT: ignore
      PRE_COMMIT_FAILED: fail

  observability:
    logging:
      level: info
    metrics:
      enabled: true
    tracing:
      enabled: true
