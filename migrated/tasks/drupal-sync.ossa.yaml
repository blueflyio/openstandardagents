# OSSA v0.3.0 Task: Drupal Sync
# Deterministic task - no LLM required
apiVersion: ossa/v0.3.0
kind: Task

metadata:
  name: drupal-sync
  version: 1.0.0
  description: Sync all_drupal_custom to llm-platform web directory
  labels:
    domain: drupal
    tier: build
    category: sync
  annotations:
    ossa.io/created-date: "2025-12-09"

spec:
  execution:
    type: idempotent
    runtime: drupal
    entrypoint: buildkit drupal sync
    timeout_seconds: 300

  capabilities:
    - file_sync
    - composer_install

  input:
    type: object
    properties:
      modules:
        type: boolean
        description: Sync modules
      themes:
        type: boolean
        description: Sync themes
      recipes:
        type: boolean
        description: Sync recipes
      dry_run:
        type: boolean
        description: Preview changes without applying

  output:
    type: object
    properties:
      synced_files:
        type: integer
        description: Number of files synced
      success:
        type: boolean
        description: Whether sync completed successfully

  batch:
    enabled: false

  error_handling:
    on_error: retry
    error_mapping:
      PERMISSION_DENIED: fail
      FILE_NOT_FOUND: retry

  observability:
    logging:
      level: info
      include_input: false
      include_output: true
    metrics:
      enabled: true
      custom_labels:
        operation: drupal-sync
    tracing:
      enabled: true
      sample_rate: 1
