# OSSA v0.3.0 Task: PHPCBF Fix
# Deterministic task - no LLM required
apiVersion: ossa/v0.3.0
kind: Task

metadata:
  name: phpcbf-fix
  version: 1.0.0
  description: Run PHP Code Beautifier and Fixer to auto-fix coding standard violations
  labels:
    domain: drupal
    tier: lint
    category: fix
  annotations:
    ossa.io/created-date: "2025-12-09"

spec:
  execution:
    type: idempotent
    runtime: drupal
    entrypoint: vendor/bin/phpcbf
    timeout_seconds: 180

  capabilities:
    - fix_php
    - auto_format

  input:
    type: object
    properties:
      path:
        type: string
        description: Path to fix
      standard:
        type: string
        description: Coding standard to use
    required:
      - path

  output:
    type: object
    properties:
      files_fixed:
        type: integer
        description: Number of files fixed
      success:
        type: boolean
        description: Whether fixes were applied

  batch:
    enabled: true
    parallelism: 2
    retry:
      max_attempts: 3
      backoff_strategy: exponential
      initial_delay_ms: 1000
    on_item_error: retry

  preconditions:
    - expression: "${{ input.path != '' }}"
      error_message: Path is required

  error_handling:
    on_error: retry

  observability:
    logging:
      level: info
    metrics:
      enabled: true
    tracing:
      enabled: true
