# OSSA Project Rules for Cursor Agent

This file contains project-specific rules for Cursor Agent. Additional detailed rules are in `.cursor/rules/`.

## Core Principles
- OpenAPI-First: All APIs must be defined in OpenAPI 3.1 specs
- TDD-Centric: Write tests first, then implement, then refactor
- Schema-Driven: OSSA schema is the source of truth
- No Vendor Lock-in: OSSA is a standard, not a framework

## Critical Workflows

### Version Management
**NEVER manually update version numbers in any file.**
- Single source of truth: `.version.json`
- Use `npm run version:bump <type>` to change versions (rc, patch, minor, major, release)
- Use `{{VERSION}}` placeholders in documentation
- Versions auto-sync before every build
- See `.gitlab/docs/development/VERSIONING.md` for complete guide

### Before Config Work
**ALWAYS** run `ddev drush cst` before working with Drupal config. This is CRITICAL.

### Schema Updates
1. Update schema JSON in `spec/v0.2.5-RC/`
2. Run `npm run gen:types` to generate TypeScript types
3. Run `npm run gen:zod` to generate Zod validators
4. Run `npm run validate:schema` to validate schema
5. Update examples and tests

### OSSA Manifest Validation
- All `.ossa.yaml` and `agent.yml` files must validate
- Run `ossa validate` before committing
- Examples in `examples/` must all validate

### Testing Requirements
- Unit tests for service logic and utilities
- Integration tests for CLI commands and workflows
- E2E tests for full validation workflows
- 95%+ test coverage required

## Prohibited Operations
- ❌ Direct commits to `main` or `development` branches
- ❌ Skipping tests
- ❌ Breaking schema without migration
- ❌ Hardcoded secrets
- ❌ Bypassing hooks (`LEFTHOOK=0`)
- ❌ Creating `.md` files (use GitLab Wiki)
- ❌ Creating `.sh` files (use TypeScript/Node scripts)
- ❌ Deleting critical files (use `__DELETE_LATER/` folder)

## File Organization
- `spec/` - OSSA schema definitions
- `src/` - Source code (TypeScript)
- `tests/` - Test files (unit, integration, e2e)
- `examples/` - Example OSSA manifests
- `openapi/` - OpenAPI specifications
- `docs/` - Documentation

## Custom Commands
Use these custom commands for OSSA workflows:
- `/ossa-validate` - Validate OSSA manifests
- `/ossa-generate` - Generate OSSA agents
- `/ossa-migrate` - Migrate between versions
- `/ossa-test` - Run test suite
- `/ossa-openapi` - Work with OpenAPI specs
- `/ossa-schema` - Work with schema
- `/ossa-release` - Manage releases
- `/ossa-refactor` - Refactor code
- `/ossa-debug` - Debug issues

## Git Workflow
- Feature branches branch off `development`
- No direct commits to `main` or `development`
- Merge requests required
- CI must pass before merge

## Release Process
Releases require:
- Milestone 100% complete and closed
- `ENABLE_RELEASE=true` CI variable set

See `.cursor/rules/ossa-development.md` for detailed rules.

