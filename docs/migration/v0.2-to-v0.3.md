# OSSA v0.2.x to v0.3.0 Migration Guide

**Last Updated:** 2025-12-12
**Target Audience:** Developers upgrading from OSSA v0.2.x to v0.3.0
**Estimated Migration Time:** 15-60 minutes per agent

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Breaking Changes](#breaking-changes)
3. [New Features](#new-features)
4. [Deprecations](#deprecations)
5. [Step-by-Step Migration](#step-by-step-migration)
6. [Automated Migration](#automated-migration)
7. [Common Issues](#common-issues)
8. [Validation](#validation)
9. [Enterprise Considerations](#enterprise-considerations)
10. [Rollback Strategy](#rollback-strategy)

---

## Executive Summary

OSSA v0.3.0 is a **major feature release** that introduces:

- **NEW:** `kind: Task` - Deterministic, non-agentic workflow steps
- **NEW:** `kind: Workflow` - Compose Agents and Tasks into pipelines
- **NEW:** Agent-to-Agent (A2A) messaging with pub/sub and commands
- **NEW:** Enhanced safety features (content filtering, PII detection, guardrails)
- **NEW:** Execution profiles (fast/balanced/deep/safe presets)
- **NEW:** Compliance extension (SOC2, ISO 27001, GDPR, HIPAA, FedRAMP)
- **ENHANCED:** LLM config with 20+ providers, fallback models, cost tracking
- **CHANGED:** `kind: Agent` is now one of THREE resource types

**Good News:** v0.3.0 is **backward compatible** with v0.2.x Agent manifests. Existing `kind: Agent` manifests will continue to work with minimal changes.

**Action Required:**
- Update `apiVersion` from `ossa/v0.2.9` to `ossa/v0.3.0`
- Optionally migrate to new features (Tasks, Workflows, A2A messaging)
- Review and adopt enhanced safety features for production deployments

---

## Breaking Changes

### 1. API Version String

**Change:** The `apiVersion` pattern now supports v0.3.0+.

**Before (v0.2.9):**
```yaml
apiVersion: ossa/v0.2.9
```

**After (v0.3.0):**
```yaml
apiVersion: ossa/v0.3.0
```

**Impact:** LOW - Simple string replacement.

**Migration:** Update all manifest files:
```bash
# Automated find/replace
sed -i 's/ossa\/v0\.2\.[0-9]/ossa\/v0.3.0/g' **/*.ossa.yaml
```

---

### 2. LLM Provider Enum Expanded

**Change:** The `llm.provider` enum now supports 20+ providers (was 6 in v0.2.9).

**Before (v0.2.9):**
```yaml
spec:
  llm:
    provider: openai | anthropic | google | azure | ollama | custom
```

**After (v0.3.0):**
```yaml
spec:
  llm:
    provider: openai | anthropic | google | google-vertex | azure |
              azure-openai | aws-bedrock | groq | together | fireworks |
              anyscale | ollama | openrouter | deepseek | mistral | cohere |
              huggingface | replicate | perplexity | cerebras | sambanova | custom
```

**Impact:** LOW - Existing providers still work. New providers available.

**Migration:** No action required unless adopting new providers.

---

### 3. Tool Type Enum Expanded

**Change:** The `tools[].type` enum now includes A2A messaging and CI/CD triggers.

**Before (v0.2.9):**
```yaml
tools:
  - type: mcp | kubernetes | http | grpc | function | a2a | custom
```

**After (v0.3.0):**
```yaml
tools:
  - type: mcp | kubernetes | http | api | grpc | function | a2a |
           webhook | schedule | pipeline | workflow | artifact |
           git-commit | ci-status | comment | library | custom
```

**Impact:** LOW - Existing tool types still work.

**Migration:** No action required unless adopting new tool types.

---

### 4. `spec.security` Renamed to `spec.safety`

**Change:** The `security` section has been renamed to `safety` for clarity.

**Before (v0.2.9):**
```yaml
spec:
  security:
    content_filtering:
      enabled: true
```

**After (v0.3.0):**
```yaml
spec:
  safety:
    content_filtering:
      enabled: true
```

**Impact:** MEDIUM - Breaking change if you use `spec.security`.

**Migration:**
```bash
# Find all files using spec.security
grep -r "spec:" . | grep -A 50 "security:" | grep -v "safety:"

# Manual rename required
```

**Automated Fix:**
```bash
# Replace security: with safety: in spec section
sed -i '/^spec:/,/^[^ ]/ s/  security:/  safety:/g' **/*.ossa.yaml
```

---

### 5. Extensions Namespace Changes

**Change:** Several extensions moved to top-level `extensions` block.

**Before (v0.2.9):**
```yaml
extensions:
  agents_md: {...}
  kagent: {...}
  buildkit: {...}
  drupal: {...}
  librechat: {...}
  mcp: {...}
  # ... 10+ framework extensions
```

**After (v0.3.0):**
```yaml
extensions:
  mcp: {...}   # Only MCP remains in v0.3.0
  # Other extensions deprecated or moved
```

**Impact:** MEDIUM - If you use framework-specific extensions.

**Migration:**
- **MCP Extension:** Remains at `extensions.mcp` - no changes needed
- **Other Extensions:** Check if your runtime still supports them
- **New A2A Messaging:** Use `spec.messaging` instead of `extensions.a2a`

---

## New Features

### 1. `kind: Task` - Deterministic Workflow Steps

**What it is:** A new resource type for non-agentic, deterministic operations (batch processing, data transforms, API calls).

**Why use it:** Tasks are faster, cheaper, and more predictable than Agents for deterministic work.

**Example:**
```yaml
apiVersion: ossa/v0.3.0
kind: Task   # NEW in v0.3.0
metadata:
  name: publish-content
  version: 1.0.0

spec:
  execution:
    type: deterministic   # pure function, no side effects
    runtime: any          # portable across runtimes
    timeout_seconds: 60

  capabilities:
    - publish_content     # abstract capability
    - send_notification

  input:
    type: object
    properties:
      content_id: { type: string }
      notify_author: { type: boolean, default: true }
    required: [content_id]

  output:
    type: object
    properties:
      published: { type: boolean }
      url: { type: string }
      published_at: { type: string, format: date-time }

  error_handling:
    on_error: retry
    error_mapping:
      CONTENT_NOT_FOUND: fail
      NETWORK_ERROR: retry

# Runtime-specific bindings (separate from portable task)
runtime:
  type: drupal
  bindings:
    publish_content:
      handler: "Drupal\\node\\Entity\\Node::setPublished"
    send_notification:
      handler: "Drupal\\ai_agents\\Service\\NotificationService::notify"
```

**Migration Path:**
1. Identify agents that do deterministic work (no LLM reasoning)
2. Convert them to `kind: Task`
3. Define abstract `capabilities` instead of `tools`
4. Bind capabilities to runtime handlers in `runtime.bindings`

**When to use Task vs Agent:**
- **Task:** Data transforms, API calls, batch jobs, triggers
- **Agent:** Natural language, reasoning, dynamic tool selection

---

### 2. `kind: Workflow` - Orchestrate Agents and Tasks

**What it is:** A new resource type for composing Agents and Tasks into executable pipelines.

**Why use it:** Build complex, multi-step processes with branching, loops, and error handling.

**Example:**
```yaml
apiVersion: ossa/v0.3.0
kind: Workflow   # NEW in v0.3.0
metadata:
  name: content-review-publish
  version: 1.0.0

spec:
  triggers:
    - type: event
      source: drupal
      event: node.submitted_for_review
    - type: webhook
      path: /api/workflows/content-review

  inputs:
    type: object
    properties:
      content_id: { type: string }
      auto_publish: { type: boolean, default: false }
    required: [content_id]

  steps:
    # Step 1: Fetch content (Task)
    - id: fetch-content
      kind: Task
      ref: ./tasks/fetch-content.yaml
      input:
        content_id: ${{ workflow.input.content_id }}

    # Step 2: AI review (Agent)
    - id: ai-review
      kind: Agent
      ref: ./agents/content-reviewer.yaml
      input:
        content: ${{ steps.fetch-content.output.content }}
      timeout_seconds: 120

    # Step 3: Conditional publish
    - id: conditional-publish
      kind: Conditional
      branches:
        - condition: ${{ steps.ai-review.output.approved && workflow.input.auto_publish }}
          steps:
            - id: publish
              kind: Task
              ref: ./tasks/publish-content.yaml
              input:
                content_id: ${{ workflow.input.content_id }}
      else:
        - id: request-revision
          kind: Task
          ref: ./tasks/request-revision.yaml
          input:
            feedback: ${{ steps.ai-review.output.feedback }}

  error_handling:
    on_failure: rollback
    compensation_steps:
      - id: rollback
        kind: Task
        ref: ./tasks/rollback.yaml

  timeout_seconds: 600
```

**Migration Path:**
1. Identify multi-agent systems or pipelines
2. Extract steps into separate Agent/Task manifests
3. Compose them in a Workflow manifest
4. Add triggers, error handling, and observability

---

### 3. Agent-to-Agent (A2A) Messaging

**What it is:** Native pub/sub and command messaging between agents (Google A2A compatible).

**Why use it:** Build event-driven, loosely-coupled agent systems.

**Example:**
```yaml
apiVersion: ossa/v0.3.0
kind: Agent
metadata:
  name: security-scanner

spec:
  role: "You scan code repositories for vulnerabilities."
  llm:
    provider: anthropic
    model: claude-sonnet-4-20250514

  # NEW in v0.3.0: Agent-to-Agent messaging
  messaging:
    # Publish security findings
    publishes:
      - channel: security.vulnerabilities
        description: Critical vulnerabilities found during scan
        schema:
          type: object
          properties:
            severity: { enum: [critical, high, medium, low] }
            cve_id: { type: string }
            affected_file: { type: string }
            remediation: { type: string }
        examples:
          - severity: critical
            cve_id: CVE-2024-1234
            affected_file: package.json
            remediation: "Upgrade lodash to 4.17.21+"

    # Subscribe to dependency updates
    subscribes:
      - channel: dependency.updates
        handler: on_dependency_update
        filter:
          severity: { $in: [critical, high] }
        maxConcurrency: 5

    # Accept RPC-style commands
    commands:
      - name: scan_repository
        description: Trigger a security scan on a repository
        inputSchema:
          type: object
          properties:
            repo_url: { type: string, format: uri }
            branch: { type: string, default: main }
          required: [repo_url]
        outputSchema:
          type: object
          properties:
            vulnerabilities_found: { type: integer }
            scan_id: { type: string }
        timeoutSeconds: 300
        idempotent: true

    # Delivery guarantees
    reliability:
      deliveryGuarantee: at-least-once
      retry:
        maxAttempts: 3
        backoff:
          strategy: exponential
          initialDelayMs: 1000
          maxDelayMs: 30000
      dlq:
        enabled: true
        retentionDays: 30
```

**Migration Path:**
1. **Before (v0.2.9):** Used `extensions.a2a` (vendor-specific)
2. **After (v0.3.0):** Use `spec.messaging` (standardized)

**Conversion:**
```yaml
# Before (v0.2.9)
extensions:
  a2a:
    publishes: [...]
    subscribes: [...]

# After (v0.3.0)
spec:
  messaging:
    publishes: [...]
    subscribes: [...]
    commands: [...]    # NEW: RPC-style commands
    reliability: {...} # NEW: Delivery guarantees
```

---

### 4. Enhanced Safety Features

**What's new:**
- **Content Filtering:** Block harmful/inappropriate content
- **PII Detection:** Redact emails, SSNs, API keys, credit cards
- **Rate Limiting:** Prevent abuse and cost overruns
- **Guardrails:** Max tool calls, execution time, behavioral policies
- **Human-in-Loop:** Require approval for high-risk actions

**Example:**
```yaml
spec:
  safety:   # was 'security' in v0.2.9
    # Filter harmful content
    content_filtering:
      enabled: true
      categories: [hate_speech, violence, self_harm, sexual_content, pii, credentials]
      threshold: medium    # low | medium | high
      action: block        # warn | block | redact

    # Detect and redact PII
    pii_detection:
      enabled: true
      types: [email, phone, ssn, credit_card, api_key, passport, drivers_license]
      action: redact       # warn | block | redact

    # Rate limiting
    rate_limiting:
      enabled: true
      requests_per_minute: 60
      burst_limit: 10

    # Behavioral guardrails
    guardrails:
      enabled: true
      max_tool_calls: 50
      max_execution_time_seconds: 300
      policies:
        - name: no_destructive_actions
          condition: ${{ tool.name not in ['delete_file', 'drop_table', 'force_push'] }}
          action: block
        - name: require_approval_for_production
          condition: ${{ context.environment == 'production' }}
          action: require_approval

    # Human-in-the-loop
    human_in_loop:
      enabled: true
      triggers:
        - destructive_actions
        - external_api_calls
        - cost_exceeds_threshold
```

**Migration Path:**
1. Rename `spec.security` to `spec.safety`
2. Add new safety features (content filtering, PII detection)
3. Configure rate limiting for production
4. Define guardrails for high-risk operations

---

### 5. Execution Profiles

**What it is:** Presets for different use cases (fast/balanced/deep/safe).

**Why use it:** Quickly switch between performance and quality tradeoffs.

**Example:**
```yaml
spec:
  llm:
    provider: anthropic
    model: claude-sonnet-4-20250514

  # NEW in v0.3.0: Execution profiles
  execution_profiles:
    default: ${EXECUTION_PROFILE:-balanced}
    profiles:
      fast:
        description: "Low latency, minimal reasoning"
        maxTokens: 1000
        temperature: 0.3
        reasoning_enabled: false
        validation_required: false

      balanced:
        description: "Good balance of speed and quality"
        maxTokens: 4000
        temperature: 0.7
        reasoning_enabled: false
        validation_required: true

      deep:
        description: "Extended thinking for complex problems"
        maxTokens: 8000
        temperature: 0.5
        reasoning_enabled: true   # Claude extended thinking
        validation_required: true
        model_override: claude-opus-4-20250514  # Use Opus for deep thinking

      safe:
        description: "Maximum safety and compliance"
        maxTokens: 4000
        temperature: 0.3
        reasoning_enabled: false
        validation_required: true
        audit_log: true
```

**Usage:**
```bash
# Run with different profiles
EXECUTION_PROFILE=fast ossa run my-agent.yaml       # Quick responses
EXECUTION_PROFILE=balanced ossa run my-agent.yaml   # Default
EXECUTION_PROFILE=deep ossa run my-agent.yaml       # Complex reasoning
EXECUTION_PROFILE=safe ossa run my-agent.yaml       # Compliance mode
```

---

### 6. Compliance Extension

**What it is:** Enterprise-grade compliance features (SOC2, ISO 27001, GDPR, HIPAA, FedRAMP).

**Example:**
```yaml
extensions:
  compliance:
    frameworks:
      - soc2-type2
      - iso27001
      - iso42001      # AI-specific compliance
      - gdpr
      - hipaa
      - fedramp-moderate

    data_residency:
      region: us-east-1
      allowed_regions: [us-east-1, us-west-2]
      blocked_regions: [cn-*, ru-*]

    audit_logging:
      enabled: true
      retention_days: 2555  # 7 years for SOC2
      immutable: true
      destination: cloudwatch

    access_controls:
      require_mfa: true
      allowed_roles: [admin, operator, auditor]
      ip_allowlist: [10.0.0.0/8, 192.168.0.0/16]
      session_timeout_minutes: 30

    data_classification: restricted   # public | internal | confidential | restricted

    certifications:
      - name: SOC2 Type II
        expiry: "2025-12-31"
        certificate_url: https://example.com/soc2.pdf
```

---

## Deprecations

### 1. Framework-Specific Extensions (DEPRECATED)

**Deprecated in v0.3.0:**
- `extensions.agents_md` - Use standard metadata instead
- `extensions.kagent` - Use standard runtime bindings
- `extensions.buildkit` - Use standard observability
- `extensions.drupal` - Use runtime bindings
- `extensions.librechat` - Use standard LLM config
- `extensions.langchain` - Use standard tool definitions
- `extensions.crewai` - Use workflows
- `extensions.openai_agents` - Use standard spec
- `extensions.cursor` - Use standard runtimes
- `extensions.langflow` - Use workflows
- `extensions.autogen` - Use A2A messaging
- `extensions.vercel_ai` - Use standard LLM config
- `extensions.llamaindex` - Use standard tools
- `extensions.langgraph` - Use workflows
- `extensions.anthropic` - Use standard LLM config
- `extensions.google_adk` - Use standard A2A messaging

**What replaces them:**
- **Runtime-specific handlers:** Use `runtime.bindings` for Task/Workflow
- **A2A messaging:** Use `spec.messaging` for inter-agent communication
- **Standard LLM config:** Use `spec.llm` with vendor-neutral syntax

**Migration Path:**
1. Identify which extensions you're using
2. Convert to standard OSSA features:
   - MCP tools â†’ `tools[].type: mcp`
   - A2A â†’ `spec.messaging`
   - Runtime-specific â†’ `runtime.bindings`
3. Test thoroughly before removing extensions

**Timeline:**
- **v0.3.x:** Extensions still work but deprecated (warnings)
- **v0.4.0:** Extensions removed entirely

---

### 2. `spec.runtimes` (DEPRECATED)

**Deprecated:** The `spec.runtimes` section is deprecated in favor of top-level `runtime`.

**Before (v0.2.9):**
```yaml
spec:
  runtimes:
    gitlab-duo:
      enabled: true
      endpoint: http://gdk.test:5052
    claude-code:
      enabled: true
      model: opus
```

**After (v0.3.0):**
```yaml
runtime:
  type: unified   # or specific runtime
  supports: [gitlab-duo, claude-code, ossa-mesh]
  scheduling:
    strategy: fair
    priority: normal
  resource_limits:
    memory_mb: 2048
    cpu_millicores: 1000
```

---

## Step-by-Step Migration

### Phase 1: Preparation (Day 0)

1. **Backup all manifests:**
   ```bash
   git add -A
   git commit -m "Backup before OSSA v0.3.0 migration"
   git tag v0.2.9-backup
   ```

2. **Install OSSA CLI v0.3.0:**
   ```bash
   npm install -g @bluefly/ossa-cli@0.3.0
   ossa version  # Should show 0.3.0
   ```

3. **Audit current manifests:**
   ```bash
   # Find all OSSA manifests
   find . -name "*.ossa.yaml" -o -name "*.ossa.yml" > manifests.txt

   # Count them
   wc -l manifests.txt

   # Validate with v0.2.9 schema (current state)
   ossa validate --schema v0.2.9 **/*.ossa.yaml
   ```

4. **Identify high-risk agents:**
   ```bash
   # Find agents using deprecated features
   grep -r "extensions:" . --include="*.ossa.yaml" | grep -v "mcp:"
   grep -r "spec.runtimes" . --include="*.ossa.yaml"
   grep -r "spec.security" . --include="*.ossa.yaml"
   ```

---

### Phase 2: Automated Migration (Day 1)

1. **Run automated migration tool:**
   ```bash
   # Dry run (preview changes)
   ossa migrate . --from v0.2.9 --to v0.3.0 --dry-run

   # Review the changes
   git diff

   # Apply migration
   ossa migrate . --from v0.2.9 --to v0.3.0

   # Commit
   git add -A
   git commit -m "Automated migration to OSSA v0.3.0"
   ```

2. **What the tool does:**
   - âœ… Updates `apiVersion: ossa/v0.2.9` â†’ `ossa/v0.3.0`
   - âœ… Renames `spec.security` â†’ `spec.safety`
   - âœ… Moves `extensions.a2a` â†’ `spec.messaging`
   - âœ… Converts `spec.runtimes` â†’ `runtime`
   - âš ï¸ Flags deprecated extensions for manual review

---

### Phase 3: Manual Migration (Day 1-2)

For each deprecated feature:

#### 3.1 Migrate `spec.security` â†’ `spec.safety`

```bash
# Find all agents using security
grep -rn "security:" . --include="*.ossa.yaml"

# Manual edit each file
# Replace:
spec:
  security:
    content_filtering: {...}

# With:
spec:
  safety:
    content_filtering: {...}
```

#### 3.2 Migrate A2A Messaging

```bash
# Find agents using extensions.a2a
grep -rn "extensions:" . -A 10 --include="*.ossa.yaml" | grep "a2a:"

# Manual conversion
```

**Before:**
```yaml
extensions:
  a2a:
    publishes:
      - channel: security.alerts
        schema: {...}
```

**After:**
```yaml
spec:
  messaging:
    publishes:
      - channel: security.alerts
        schema: {...}
        contentType: application/json
```

#### 3.3 Migrate Runtime Bindings

**Before (v0.2.9):**
```yaml
spec:
  runtimes:
    drupal:
      enabled: true
```

**After (v0.3.0):**
```yaml
runtime:
  type: drupal
  supports: [drupal, symfony]
```

---

### Phase 4: Validation (Day 2-3)

1. **Validate all migrated manifests:**
   ```bash
   # Strict validation (catches all issues)
   ossa validate --strict **/*.ossa.yaml

   # Expected output:
   # âœ“ my-agent.ossa.yaml (valid)
   # âœ— old-agent.ossa.yaml (3 errors)
   ```

2. **Fix validation errors:**
   ```bash
   # Show detailed errors
   ossa validate --strict --verbose my-agent.ossa.yaml
   ```

   Common errors:
   ```
   âŒ Error: Unknown field 'spec.security'
      â†’ Fix: Rename to 'spec.safety'

   âŒ Error: Invalid apiVersion 'ossa/v0.2.9'
      â†’ Fix: Update to 'ossa/v0.3.0'

   âŒ Error: Deprecated extension 'extensions.langchain'
      â†’ Fix: Convert to standard tools
   ```

3. **Test agents in development:**
   ```bash
   # Test each agent interactively
   ossa run my-agent.ossa.yaml --interactive

   # Test with sample input
   echo '{"content_id": "123"}' | ossa run my-agent.ossa.yaml --input -

   # Test with specific profile
   EXECUTION_PROFILE=fast ossa run my-agent.ossa.yaml
   ```

---

### Phase 5: Adopt New Features (Day 3-7)

#### 5.1 Convert Deterministic Agents to Tasks

Identify candidates:
```bash
# Find agents that don't use LLM reasoning
grep -L "llm:" **/*.ossa.yaml
```

Convert:
```yaml
# Before: kind: Agent (overkill for deterministic work)
apiVersion: ossa/v0.2.9
kind: Agent
spec:
  role: "Publish content to the live site"
  llm:
    provider: anthropic
    model: claude-sonnet-4-20250514  # Unused!

# After: kind: Task (faster, cheaper, more appropriate)
apiVersion: ossa/v0.3.0
kind: Task
spec:
  execution:
    type: deterministic
    runtime: drupal
  capabilities:
    - publish_content
```

#### 5.2 Create Workflows for Multi-Agent Systems

Identify candidates:
```bash
# Find agent orchestration code
grep -r "agent.run\|agent.execute" . --include="*.py" --include="*.js"
```

Extract into workflow:
```yaml
apiVersion: ossa/v0.3.0
kind: Workflow
metadata:
  name: my-pipeline
spec:
  steps:
    - id: step1
      kind: Agent
      ref: ./agents/agent1.yaml
    - id: step2
      kind: Task
      ref: ./tasks/task1.yaml
      depends_on: [step1]
```

#### 5.3 Add Safety Features

```yaml
spec:
  safety:
    content_filtering:
      enabled: true
      categories: [hate_speech, violence, pii]
      threshold: medium
      action: block

    pii_detection:
      enabled: true
      types: [email, phone, ssn, credit_card]
      action: redact

    rate_limiting:
      enabled: true
      requests_per_minute: 60
```

#### 5.4 Configure A2A Messaging

```yaml
spec:
  messaging:
    publishes:
      - channel: security.vulnerabilities
        schema:
          type: object
          properties:
            severity: {enum: [critical, high, medium, low]}
    subscribes:
      - channel: dependency.updates
        handler: on_dependency_update
```

---

### Phase 6: Staging Deployment (Day 7-10)

1. **Deploy to staging:**
   ```bash
   # Deploy all v0.3.0 agents to staging
   ossa deploy --env staging **/*.ossa.yaml

   # Monitor for errors
   ossa logs --env staging --follow
   ```

2. **Run integration tests:**
   ```bash
   # Test workflows end-to-end
   ossa test --env staging workflows/*.yaml

   # Test A2A messaging
   ossa test --env staging messaging/*.yaml
   ```

3. **Load testing:**
   ```bash
   # Simulate production load
   ossa load-test --env staging --duration 1h --rps 100
   ```

---

### Phase 7: Production Deployment (Day 10-14)

1. **Blue-Green Deployment:**
   ```bash
   # Deploy to green environment
   ossa deploy --env production-green **/*.ossa.yaml

   # Smoke test
   ossa test --env production-green smoke-tests.yaml

   # Switch traffic 10% â†’ 50% â†’ 100%
   ossa traffic --env production-green --weight 10
   # Monitor for 1 hour
   ossa traffic --env production-green --weight 50
   # Monitor for 2 hours
   ossa traffic --env production-green --weight 100

   # Promote green to blue
   ossa promote --from production-green --to production
   ```

2. **Rollback if needed:**
   ```bash
   # Immediate rollback
   ossa rollback --env production --to v0.2.9-backup
   ```

---

## Automated Migration

### Using the OSSA CLI Migration Tool

```bash
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STEP 1: Dry run (preview changes)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ossa migrate ./my-agent.ossa.yaml --from v0.2.9 --to v0.3.0 --dry-run

# Expected output:
# ğŸ“ Migration Preview (my-agent.ossa.yaml)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# âœ“ Update apiVersion: ossa/v0.2.9 â†’ ossa/v0.3.0
# âœ“ Rename spec.security â†’ spec.safety
# âš  Warning: extensions.langchain is deprecated
# âš  Warning: spec.runtimes is deprecated
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2 changes, 2 warnings, 0 errors

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STEP 2: Review diff
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ossa migrate ./my-agent.ossa.yaml --from v0.2.9 --to v0.3.0 --diff

# Shows side-by-side diff of changes

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STEP 3: Apply migration
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ossa migrate ./my-agent.ossa.yaml --from v0.2.9 --to v0.3.0

# Expected output:
# âœ“ Migrated my-agent.ossa.yaml
# âœ“ Backup created: my-agent.ossa.yaml.bak
# âœ“ Validation passed

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STEP 4: Migrate entire directory
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ossa migrate ./agents/ --from v0.2.9 --to v0.3.0 --recursive

# Migrates all *.ossa.yaml files in directory tree

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STEP 5: Batch migration with parallelism
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
find . -name "*.ossa.yaml" | xargs -P 8 -I {} \
  ossa migrate {} --from v0.2.9 --to v0.3.0

# Processes 8 files in parallel

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STEP 6: Validation after migration
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ossa validate --strict **/*.ossa.yaml

# Ensures all migrated files are valid
```

### Migration Tool Features

- âœ… **Automatic backups** - Creates `.bak` files before modifying
- âœ… **Dry run mode** - Preview changes without modifying files
- âœ… **Validation** - Ensures output is valid v0.3.0
- âœ… **Batch processing** - Migrate entire directories
- âœ… **Rollback support** - Restore from backups if needed
- âœ… **Git integration** - Works with version control
- âš ï¸ **Manual review required** - Complex migrations need human oversight

### What the Tool Can't Migrate

**Manual intervention required for:**

1. **Custom extensions** - Framework-specific code
2. **Complex runtime bindings** - Requires understanding of target runtime
3. **Multi-agent orchestration** - May need workflow refactoring
4. **Custom tool integrations** - May need MCP server updates

---

## Common Issues

### Issue 1: Validation Error - Unknown Field `spec.security`

**Error:**
```
âŒ ValidationError: Unknown field 'spec.security'
   File: my-agent.ossa.yaml:15
   Line: spec.security.content_filtering
```

**Root Cause:** `spec.security` was renamed to `spec.safety` in v0.3.0.

**Fix:**
```yaml
# Before (v0.2.9)
spec:
  security:
    content_filtering:
      enabled: true

# After (v0.3.0)
spec:
  safety:
    content_filtering:
      enabled: true
```

**Automated Fix:**
```bash
sed -i 's/  security:/  safety:/g' my-agent.ossa.yaml
ossa validate my-agent.ossa.yaml
```

---

### Issue 2: Deprecated Extension Warning

**Warning:**
```
âš  Warning: extensions.langchain is deprecated in v0.3.0
   File: my-agent.ossa.yaml:42
   Line: extensions.langchain
   Suggestion: Use standard tool definitions or workflows
```

**Root Cause:** Framework-specific extensions are deprecated.

**Fix:**
```yaml
# Before (v0.2.9) - LangChain extension
extensions:
  langchain:
    chain_type: RetrievalQA
    retriever:
      type: vector_store
      config:
        embeddings: openai
        store: pinecone

# After (v0.3.0) - Standard tools + workflow
spec:
  tools:
    - type: mcp
      name: vector-search
      server: pinecone-mcp

  # Or use a workflow if complex orchestration needed
```

---

### Issue 3: A2A Messaging Not Working

**Error:**
```
âŒ RuntimeError: No messaging transport configured
   Agent: security-scanner
   Channel: security.vulnerabilities
```

**Root Cause:** A2A messaging requires runtime support.

**Fix:**
```yaml
# 1. Configure messaging in agent
spec:
  messaging:
    publishes:
      - channel: security.vulnerabilities
        schema: {...}

# 2. Configure runtime transport
runtime:
  type: ossa-mesh   # or gitlab-duo, google-a2a
  transport: amqp   # or redis, kafka
  bindings:
    messaging_broker:
      endpoint: amqp://rabbitmq:5672
```

**Verify:**
```bash
# Test message publishing
ossa test messaging --channel security.vulnerabilities
```

---

### Issue 4: Task Capabilities Not Bound

**Error:**
```
âŒ RuntimeError: Capability 'publish_content' not bound to runtime handler
   Task: publish-content
   Runtime: drupal
```

**Root Cause:** Task capabilities must be bound to runtime-specific handlers.

**Fix:**
```yaml
# Task definition (portable)
apiVersion: ossa/v0.3.0
kind: Task
spec:
  capabilities:
    - publish_content   # Abstract capability

# Runtime binding (runtime-specific)
runtime:
  type: drupal
  bindings:
    publish_content:
      handler: "Drupal\\node\\Entity\\Node::setPublished"
      config:
        validate_permissions: true
```

**Verify:**
```bash
# Test task with runtime binding
ossa run publish-content.yaml --runtime drupal --input '{"content_id":"123"}'
```

---

### Issue 5: Workflow Step Dependency Error

**Error:**
```
âŒ WorkflowError: Circular dependency detected
   Workflow: content-pipeline
   Steps: fetch-content â†’ ai-review â†’ fetch-content
```

**Root Cause:** Invalid `depends_on` configuration.

**Fix:**
```yaml
# Before (circular)
steps:
  - id: fetch-content
    depends_on: [ai-review]  # âŒ Creates cycle
  - id: ai-review
    depends_on: [fetch-content]

# After (correct)
steps:
  - id: fetch-content
    # No dependencies - runs first
  - id: ai-review
    depends_on: [fetch-content]  # âœ“ Linear dependency
```

**Verify:**
```bash
# Validate workflow DAG
ossa validate --workflow content-pipeline.yaml --check-dependencies
```

---

### Issue 6: LLM Provider Not Supported

**Error:**
```
âŒ LLMConfigError: Provider 'claude' not recognized
   Expected: anthropic | openai | google | ...
```

**Root Cause:** v0.3.0 renamed some providers for consistency.

**Fix:**
```yaml
# Before (v0.2.9) - informal names
llm:
  provider: claude    # âŒ Not standard

# After (v0.3.0) - official names
llm:
  provider: anthropic # âœ“ Use official provider name
  model: claude-sonnet-4-20250514
```

**Provider Name Changes:**
- `claude` â†’ `anthropic`
- `chatgpt` â†’ `openai`
- `bard` â†’ `google`

---

## Validation

### Strict Validation

```bash
# Validate with strict mode (recommended for production)
ossa validate --strict my-agent.ossa.yaml

# What strict mode checks:
# âœ“ Schema compliance (v0.3.0)
# âœ“ Required fields present
# âœ“ Enum values valid
# âœ“ References resolvable
# âœ“ No deprecated features
# âœ“ Security best practices
```

### Validation Output

```
âœ… SUCCESS: my-agent.ossa.yaml is valid
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Schema: v0.3.0 (valid)
âœ“ Kind: Agent (valid)
âœ“ Metadata: All required fields present
âœ“ LLM Config: anthropic/claude-sonnet-4-20250514 (valid)
âœ“ Tools: 3 tools (all valid)
âœ“ Safety: Content filtering + PII detection enabled
âœ“ Messaging: 2 channels published, 1 subscribed

â„¹ INFO: No warnings or recommendations
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### Common Validation Errors

#### 1. Missing Required Field

```
âŒ ValidationError: Missing required field 'metadata.name'
   File: agent.ossa.yaml:1
   Required by: v0.3.0 schema
```

**Fix:** Add the required field:
```yaml
metadata:
  name: my-agent  # Required
  version: 1.0.0
```

#### 2. Invalid Enum Value

```
âŒ ValidationError: Invalid value 'claude' for field 'llm.provider'
   File: agent.ossa.yaml:15
   Expected: anthropic | openai | google | ...
```

**Fix:** Use valid enum value:
```yaml
llm:
  provider: anthropic  # Not 'claude'
```

#### 3. Schema Mismatch

```
âŒ ValidationError: Field 'spec.security' not defined in v0.3.0 schema
   File: agent.ossa.yaml:20
   Suggestion: Did you mean 'spec.safety'?
```

**Fix:** Rename to correct field:
```yaml
spec:
  safety:  # Not 'security'
    content_filtering: {...}
```

### Pre-Production Validation Checklist

Before deploying to production:

- [ ] **Schema validation passes:** `ossa validate --strict`
- [ ] **No deprecated features:** Check for warnings
- [ ] **LLM config valid:** Test with actual provider
- [ ] **Tools/capabilities bound:** Verify runtime bindings
- [ ] **Safety features enabled:** Content filtering, PII detection, rate limiting
- [ ] **Observability configured:** Logging, metrics, tracing
- [ ] **Error handling tested:** Retry logic, fallbacks, DLQ
- [ ] **A2A messaging works:** Test pub/sub and commands
- [ ] **Workflows execute:** End-to-end workflow tests
- [ ] **Performance acceptable:** Load testing completed
- [ ] **Security audit passed:** No hardcoded secrets, proper auth
- [ ] **Compliance verified:** Meet regulatory requirements
- [ ] **Documentation updated:** README, runbooks, diagrams
- [ ] **Rollback plan ready:** Tested rollback procedure

---

## Enterprise Considerations

### Multi-Environment Migration

```bash
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STRATEGY 1: Blue-Green Deployment (Zero Downtime)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Step 1: Deploy v0.3.0 to green environment
ossa deploy --env production-green **/*.ossa.yaml

# Step 2: Run smoke tests
ossa test --env production-green smoke-tests/

# Step 3: Gradually shift traffic (10% â†’ 50% â†’ 100%)
ossa traffic --env production-green --weight 10
# Monitor for 30 minutes
ossa traffic --env production-green --weight 50
# Monitor for 1 hour
ossa traffic --env production-green --weight 100

# Step 4: Promote green to blue (atomic swap)
ossa promote --from production-green --to production

# Step 5: Keep old version for 24h (quick rollback)
ossa retain --env production-blue --duration 24h

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STRATEGY 2: Canary Deployment (Gradual Rollout)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Step 1: Deploy to 1% of traffic
ossa deploy --env production --canary 1 **/*.ossa.yaml

# Step 2: Monitor error rates for 1 hour
ossa metrics --env production --duration 1h

# Step 3: Gradually increase (1% â†’ 10% â†’ 50% â†’ 100%)
ossa canary --env production --weight 10
ossa canary --env production --weight 50
ossa canary --env production --weight 100

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STRATEGY 3: Feature Flag (Progressive Delivery)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Enable v0.3.0 features for specific users/tenants
ossa feature-flag enable v0.3.0-tasks --users=beta-testers
ossa feature-flag enable v0.3.0-workflows --tenants=acme-corp
ossa feature-flag enable v0.3.0-messaging --percentage=25
```

### Compliance and Audit

```yaml
# Enable compliance features for regulated industries
extensions:
  compliance:
    frameworks:
      - soc2-type2
      - iso27001
      - hipaa         # Healthcare
      - pci-dss       # Payment processing
      - fedramp-high  # Government

    audit_logging:
      enabled: true
      retention_days: 2555  # 7 years
      immutable: true
      destination: cloudwatch
      encryption:
        enabled: true
        algorithm: aes-256-gcm

    data_residency:
      region: us-east-1
      allowed_regions: [us-east-1, us-west-2]
      blocked_regions: [cn-*, ru-*]

    access_controls:
      require_mfa: true
      allowed_roles: [admin, operator, auditor]
      ip_allowlist: [10.0.0.0/8]
      session_timeout_minutes: 15
```

### Cost Management

```yaml
spec:
  llm:
    provider: anthropic
    model: claude-sonnet-4-20250514

    # Cost tracking
    cost_tracking:
      enabled: true
      budget_alert_threshold: 1000.00  # Alert at $1000/day
      cost_allocation_tags:
        team: platform
        project: agent-v2
        environment: production
        cost_center: engineering

  constraints:
    cost:
      maxCostPerDay: 5000.00   # Hard limit
      maxTokensPerDay: 10000000
      maxTokensPerRequest: 100000
      currency: USD
```

### Disaster Recovery

```yaml
# Backup and restore strategy
spec:
  state:
    mode: persistent
    storage:
      type: rdbms
      config:
        provider: postgres
        endpoint: ${DB_ENDPOINT}

        # Backup configuration
        backup:
          enabled: true
          frequency: hourly
          retention_days: 30
          storage: s3://backups/ossa/

        # Disaster recovery
        disaster_recovery:
          enabled: true
          rpo_minutes: 60   # Recovery Point Objective
          rto_minutes: 15   # Recovery Time Objective
          replica_regions: [us-west-2, eu-west-1]
```

---

## Rollback Strategy

### When to Rollback

Rollback to v0.2.9 if:

- âŒ Validation errors prevent deployment
- âŒ Runtime errors in production (>5% error rate)
- âŒ Performance degradation (>50% latency increase)
- âŒ A2A messaging failures (messages lost)
- âŒ Security vulnerabilities discovered
- âŒ Compliance violations detected

### Immediate Rollback (< 5 minutes)

```bash
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# OPTION 1: Git-based rollback (fastest)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
git revert HEAD~1
git push
ossa deploy --env production

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# OPTION 2: CLI rollback
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ossa rollback --env production --to v0.2.9-backup

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# OPTION 3: Traffic shift (zero downtime)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ossa traffic --env production-green --weight 0    # Stop v0.3.0 traffic
ossa traffic --env production-blue --weight 100   # Route to v0.2.9
```

### Manual Rollback (< 15 minutes)

```bash
# Step 1: Restore backup manifests
cp -r manifests-v0.2.9-backup/* manifests/

# Step 2: Validate backups
ossa validate --schema v0.2.9 **/*.ossa.yaml

# Step 3: Deploy to production
ossa deploy --env production --force **/*.ossa.yaml

# Step 4: Verify health
ossa health --env production
```

### Post-Rollback Checklist

- [ ] Verify all agents running on v0.2.9
- [ ] Check error rates (should return to baseline)
- [ ] Verify A2A messaging works (if used)
- [ ] Check observability dashboards
- [ ] Notify stakeholders of rollback
- [ ] Create postmortem issue
- [ ] Schedule retrospective meeting
- [ ] Update migration plan with lessons learned

---

## FAQ

### Q: Is v0.3.0 backward compatible with v0.2.9?

**A:** Yes, `kind: Agent` manifests from v0.2.9 will work in v0.3.0 with minimal changes. The only required change is updating `apiVersion` to `ossa/v0.3.0`. However, you should also:
- Rename `spec.security` â†’ `spec.safety` (if used)
- Migrate `extensions.a2a` â†’ `spec.messaging` (if used)

### Q: Do I need to migrate all agents at once?

**A:** No. You can migrate incrementally:
1. Update `apiVersion` on all agents (non-breaking)
2. Migrate deprecated features one agent at a time
3. Adopt new features (Tasks, Workflows, A2A) gradually

### Q: Will v0.2.9 agents work in a v0.3.0 runtime?

**A:** Yes, with one caveat: Update `apiVersion` to `ossa/v0.3.0`. The runtime will handle backward compatibility automatically.

### Q: How long does migration typically take?

**A:**
- **Small projects** (1-10 agents): 1-2 hours
- **Medium projects** (10-50 agents): 1 day
- **Large projects** (50+ agents): 3-7 days
- **Enterprise** (100+ agents, compliance): 2-4 weeks

### Q: What if I use a deprecated extension?

**A:** Deprecated extensions still work in v0.3.0 but will be removed in v0.4.0. You should migrate to standard OSSA features:
- Use `runtime.bindings` for runtime-specific code
- Use `spec.messaging` for A2A communication
- Use standard `tools` for integrations

### Q: Can I use Tasks and Workflows with v0.2.9 agents?

**A:** No. Tasks and Workflows require v0.3.0. However, you can run v0.3.0 agents, tasks, and workflows in the same runtime - they interoperate seamlessly.

### Q: Do I need to update my CI/CD pipelines?

**A:** Yes, if you validate manifests in CI. Update validation commands:
```bash
# Before
ossa validate --schema v0.2.9 **/*.ossa.yaml

# After
ossa validate --schema v0.3.0 **/*.ossa.yaml
```

### Q: How do I test A2A messaging locally?

**A:**
```bash
# Start local message broker (RabbitMQ)
docker run -d -p 5672:5672 rabbitmq:3-management

# Configure agent with local broker
runtime:
  transport: amqp
  bindings:
    messaging_broker:
      endpoint: amqp://localhost:5672

# Test message publishing
ossa test messaging --channel test.messages
```

---

## Support and Resources

### Documentation
- **Main Docs:** https://openstandardagents.org/docs
- **API Reference:** https://openstandardagents.org/docs/api
- **Examples:** https://github.com/blueflyio/openstandardagents/tree/main/examples
- **Schema:** https://openstandardagents.org/schemas/v0.3.0/manifest.json

### Community
- **GitLab Issues:** https://gitlab.com/blueflyio/openstandardagents/-/issues
- **Discord:** https://discord.gg/ossa (coming soon)
- **Discussions:** https://gitlab.com/blueflyio/openstandardagents/-/discussions

### Enterprise Support
- **Email:** support@openstandardagents.org
- **Slack Connect:** Request access via email
- **SLA:** 24-hour response for production issues
- **Migration Assistance:** Available for enterprise customers

---

## Appendix A: Complete Migration Checklist

Copy this checklist for each agent:

```markdown
# Agent Migration Checklist: <agent-name>

## Pre-Migration
- [ ] Backup agent manifest (git commit + tag)
- [ ] Validate with v0.2.9 schema
- [ ] Test agent in v0.2.9 runtime (baseline)
- [ ] Document current behavior (expected output)

## Automated Migration
- [ ] Run `ossa migrate --dry-run` (preview)
- [ ] Review changes
- [ ] Run `ossa migrate` (apply)
- [ ] Commit changes

## Manual Migration
- [ ] Update `apiVersion` to `ossa/v0.3.0`
- [ ] Rename `spec.security` â†’ `spec.safety`
- [ ] Migrate `extensions.a2a` â†’ `spec.messaging`
- [ ] Convert `spec.runtimes` â†’ `runtime`
- [ ] Remove deprecated extensions
- [ ] Add safety features (content filtering, PII, rate limiting)

## Validation
- [ ] Run `ossa validate --strict`
- [ ] Fix validation errors
- [ ] Test in development environment
- [ ] Compare output to baseline (behavior unchanged)

## New Features (Optional)
- [ ] Convert to `kind: Task` (if deterministic)
- [ ] Extract into `kind: Workflow` (if multi-step)
- [ ] Add A2A messaging (if event-driven)
- [ ] Configure execution profiles
- [ ] Enable compliance features

## Deployment
- [ ] Deploy to staging environment
- [ ] Run integration tests
- [ ] Load test (performance validation)
- [ ] Security scan
- [ ] Deploy to production (canary/blue-green)
- [ ] Monitor for 24 hours
- [ ] Update documentation

## Post-Migration
- [ ] Remove backup files
- [ ] Update README/documentation
- [ ] Notify team of completion
- [ ] Archive v0.2.9 code
```

---

## Appendix B: API Version Compatibility Matrix

| OSSA Version | Release Date | Agent | Task | Workflow | A2A | Status |
|--------------|--------------|-------|------|----------|-----|--------|
| v0.1.9 | 2024-06-01 | âœ… | âŒ | âŒ | âŒ | Deprecated |
| v0.2.0 | 2024-08-01 | âœ… | âŒ | âŒ | âš ï¸ | Deprecated |
| v0.2.9 | 2024-11-01 | âœ… | âŒ | âŒ | âš ï¸ | Supported until 2025-06-01 |
| **v0.3.0** | **2025-01-01** | âœ… | âœ… | âœ… | âœ… | **Current** |
| v0.4.0 | 2025-Q2 | âœ… | âœ… | âœ… | âœ… | Planned |
| v1.0.0 | 2025-Q4 | âœ… | âœ… | âœ… | âœ… | Roadmap |

**Legend:**
- âœ… Fully supported
- âš ï¸ Partial support (via extensions)
- âŒ Not supported

---

## Appendix C: Schema Field Mapping (v0.2.9 â†’ v0.3.0)

| v0.2.9 Field | v0.3.0 Field | Change Type | Notes |
|--------------|--------------|-------------|-------|
| `apiVersion: ossa/v0.2.9` | `apiVersion: ossa/v0.3.0` | **Required** | Update version string |
| `kind: Agent` | `kind: Agent \| Task \| Workflow` | **Enhanced** | Two new kinds added |
| `spec.security` | `spec.safety` | **Breaking** | Renamed for clarity |
| `spec.runtimes` | `runtime` | **Deprecated** | Moved to top-level |
| `extensions.a2a` | `spec.messaging` | **Breaking** | Standardized A2A |
| `llm.provider: [6 options]` | `llm.provider: [20+ options]` | **Enhanced** | Many new providers |
| `tools[].type: [7 options]` | `tools[].type: [17 options]` | **Enhanced** | Many new tool types |
| N/A | `spec.messaging` | **New** | A2A pub/sub + commands |
| N/A | `execution_profiles` | **New** | Performance presets |
| N/A | `extensions.compliance` | **New** | Enterprise compliance |
| N/A | `runtime.scheduling` | **New** | Advanced scheduling |
| N/A | `runtime.resource_limits` | **New** | Resource constraints |

---

**End of Migration Guide**

**Last Updated:** 2025-12-12
**Document Version:** 1.0.0
**Target OSSA Version:** v0.3.0

For the latest version of this guide, visit:
https://openstandardagents.org/docs/migration/v0.2-to-v0.3

---
